<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>A Big Boy Blog -  Tech Articls &amp; Notes</title>
  
  <subtitle>Python Java Android Django Web -&gt; sulang357159@gmail.com</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://sulangsss.github.io/"/>
  <updated>2019-03-16T07:19:57.878Z</updated>
  <id>https://sulangsss.github.io/</id>
  
  <author>
    <name>Jason - sulang357159@163.com</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Influxdb Command</title>
    <link href="https://sulangsss.github.io/2019/03/16/DB/Influxdb/Influxdb-Command/"/>
    <id>https://sulangsss.github.io/2019/03/16/DB/Influxdb/Influxdb-Command/</id>
    <published>2019-03-16T07:00:27.000Z</published>
    <updated>2019-03-16T07:19:57.878Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basic-Command"><a href="#Basic-Command" class="headerlink" title="Basic Command"></a>Basic Command</h3><h4 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">influx -precision rfc3339</span><br><span class="line"></span><br><span class="line"><span class="comment"># The -precision argument specifies the format/precision of any returned timestamps</span></span><br><span class="line"><span class="comment"># rfc3339 tells InfluxDB to return timestamps in RFC3339 format (YYYY-MM-DDTHH:MM:SS.nnnnnnnnnZ)</span></span><br></pre></td></tr></table></figure><h4 id="Auth"><a href="#Auth" class="headerlink" title="Auth"></a>Auth</h4><ol><li><p>Auth User</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth</span><br></pre></td></tr></table></figure></li><li><p>Authenticate Telegraf requests to InfluxDB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Write timeout (for the InfluxDB client), formatted as a string.</span></span><br><span class="line"><span class="comment">## If not provided, will default to 5s. 0s means no timeout (not recommended).</span></span><br><span class="line">timeout = <span class="string">"5s"</span></span><br><span class="line">username = <span class="string">"telegraf"</span> <span class="comment">#ğŸ’¥</span></span><br><span class="line">password = <span class="string">"metricsmetricsmetricsmetrics"</span> <span class="comment">#ğŸ’¥</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Basic-Command&quot;&gt;&lt;a href=&quot;#Basic-Command&quot; class=&quot;headerlink&quot; title=&quot;Basic Command&quot;&gt;&lt;/a&gt;Basic Command&lt;/h3&gt;&lt;h4 id=&quot;Connect&quot;&gt;&lt;a href=&quot;#Co
      
    
    </summary>
    
      <category term="DB" scheme="https://sulangsss.github.io/categories/DB/"/>
    
      <category term="Influxdb" scheme="https://sulangsss.github.io/categories/DB/Influxdb/"/>
    
    
      <category term="Influxdb" scheme="https://sulangsss.github.io/tags/Influxdb/"/>
    
      <category term="Command" scheme="https://sulangsss.github.io/tags/Command/"/>
    
  </entry>
  
  <entry>
    <title>Multi-container pods and container communication in Kubernetes</title>
    <link href="https://sulangsss.github.io/2019/03/16/Kubenetes/MultipleContainerOnDeployment/"/>
    <id>https://sulangsss.github.io/2019/03/16/Kubenetes/MultipleContainerOnDeployment/</id>
    <published>2019-03-16T06:00:27.000Z</published>
    <updated>2019-03-16T06:36:03.265Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://www.mirantis.com/blog/multi-container-pods-and-container-communication-in-kubernetes/" target="_blank" rel="noopener">https://www.mirantis.com/blog/multi-container-pods-and-container-communication-in-kubernetes/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.mirantis.com/bl
      
    
    </summary>
    
      <category term="Kubernetes" scheme="https://sulangsss.github.io/categories/Kubernetes/"/>
    
    
      <category term="Kubernetes" scheme="https://sulangsss.github.io/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://sulangsss.github.io/2019/02/13/Security/Web/DDoS/"/>
    <id>https://sulangsss.github.io/2019/02/13/Security/Web/DDoS/</id>
    <published>2019-02-13T04:29:10.326Z</published>
    <updated>2019-02-13T04:29:10.326Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://sulangsss.github.io/2019/02/13/Security/Web/SQL-Injection/"/>
    <id>https://sulangsss.github.io/2019/02/13/Security/Web/SQL-Injection/</id>
    <published>2019-02-13T04:28:48.591Z</published>
    <updated>2019-02-13T04:28:48.591Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://sulangsss.github.io/2019/02/13/Security/Web/XSS/"/>
    <id>https://sulangsss.github.io/2019/02/13/Security/Web/XSS/</id>
    <published>2019-02-13T04:28:36.344Z</published>
    <updated>2019-02-13T04:28:36.344Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://sulangsss.github.io/2019/02/13/Security/Web/CSRF/"/>
    <id>https://sulangsss.github.io/2019/02/13/Security/Web/CSRF/</id>
    <published>2019-02-13T04:28:23.056Z</published>
    <updated>2019-02-13T04:28:23.056Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Technology Stack On Java</title>
    <link href="https://sulangsss.github.io/2019/02/13/Java/TechStack/"/>
    <id>https://sulangsss.github.io/2019/02/13/Java/TechStack/</id>
    <published>2019-02-13T02:00:22.000Z</published>
    <updated>2019-03-12T03:00:00.652Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><h4 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h4><ul><li>Skywalking</li><li>Zipkin</li></ul><h4 id="Register-Center"><a href="#Register-Center" class="headerlink" title="Register Center"></a>Register Center</h4><ul><li>Eureke</li><li>Consul</li></ul><hr><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><ul><li>jibï¼šJib builds optimized Docker and OCI images for your Java applications without a Docker daemon - and without deep mastery of Docker best-practices. It is available as plugins for Maven and Gradle and as a Java library.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Spring-Boot&quot;&gt;&lt;a href=&quot;#Spring-Boot&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot&quot;&gt;&lt;/a&gt;Spring Boot&lt;/h3&gt;&lt;h4 id=&quot;Trace&quot;&gt;&lt;a href=&quot;#Trace&quot; class
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
    
      <category term="TechStack" scheme="https://sulangsss.github.io/tags/TechStack/"/>
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>RSIæ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="https://sulangsss.github.io/2019/02/01/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%A1%8C%E4%B8%9A/%E9%87%91%E8%9E%8D/RSI/"/>
    <id>https://sulangsss.github.io/2019/02/01/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/RSI/</id>
    <published>2019-02-01T03:24:07.000Z</published>
    <updated>2019-02-11T02:56:41.201Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>ç›¸å¯¹å¼ºå¼±æŒ‡æ•°RSIæœ€æ—©è¢«ç”¨äºæœŸè´§äº¤æ˜“ä¸­ï¼Œåæ¥å‘ç°ç”¨è¯¥æŒ‡æ ‡æ¥æŒ‡å¯¼è‚¡ç¥¨å¸‚åœºæŠ•èµ„æ•ˆæœä¹Ÿååˆ†ä¸é”™ï¼Œå¹¶å¯¹è¯¥æŒ‡æ ‡çš„ç‰¹ç‚¹ä¸æ–­è¿›è¡Œå½’çº³å’Œæ€»ç»“ã€‚ç°åœ¨ï¼ŒRSIå·²ç»æˆä¸ºè¢«æŠ•èµ„è€…åº”ç”¨æœ€å¹¿æ³›çš„æŠ€æœ¯æŒ‡æ ‡ä¹‹ä¸€ï¼Œä»Šå¤©å°±æ¥ä¸ºå¤§å®¶ç®€å•ä»‹ç»ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡ï¼Œè¿˜æœ‰åˆ°åº•åº”è¯¥å¦‚ä½•è®¡ç®—å‘¢ï¼Ÿ</p><p><strong>ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡(Relative Strength Index)ç®€ç§°ä¸ºRSIï¼Œæ˜¯ä¸€ç§ç”¨æ¥è¯„ä¼°ã€Œä¹°å–ç›˜åŒæ–¹åŠ›é“å¼ºå¼±ã€æƒ…å†µçš„æŠ€æœ¯æŒ‡æ ‡ï¼Œä¹°å®¶æ˜¯ä»£è¡¨é‡‘é’±çš„åŠ›é‡ï¼Œå–å®¶æ˜¯ä»£è¡¨æŒè´§çš„åŠ›é‡ã€‚</strong>å½“ä¹°æ–¹åŠ›é‡ç¨é€Šï¼Œä»·æ ¼å°±ä¼šå‘ä¸‹å‘å±•ï¼›ç›¸åï¼Œå½“å–æ–¹åŠ›é‡ä¸è¶³ï¼Œä»·æ ¼å°±ä¼šå‘ä¸Šå‘å±•ã€‚</p><hr><h3 id="RSIè®¡ç®—æ–¹å¼"><a href="#RSIè®¡ç®—æ–¹å¼" class="headerlink" title="RSIè®¡ç®—æ–¹å¼"></a>RSIè®¡ç®—æ–¹å¼</h3><p>è¿™é¡¹æŠ€æœ¯æŒ‡æ ‡æ˜¯ç”±æŠ€æœ¯åˆ†æå¤§å¸ˆä¸ºéŸ¦å°”æ–¯â€§æ€€å¾·(Wells Wilder) æ‰€å‘æ˜çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç›®å‰æµä¼ æœ€å¹¿ä¸”æœ€å¸¸è¢«äººä½¿ç”¨çš„æŠ€æœ¯æŒ‡æ ‡ä¹‹ä¸€ã€‚</p><p>å¼ºå¼±æŒ‡æ ‡(RSI)ä»¥è®¡ç®—ä»·æ ¼çš„æ¶¨è·Œä¸ºåŸºç¡€ï¼Œè€ƒè™‘äº†è‚¡ä»·å˜åŠ¨çš„å››ä¸ªå› ç´ ï¼šä¸Šæ¶¨å’Œä¸‹è·Œçš„å¤©æ•°ã€ä¸Šæ¶¨å’Œä¸‹è·Œçš„å¹…åº¦ã€‚åœ¨è‚¡ä»·è¶‹åŠ¿é¢„æµ‹æ–¹é¢ï¼Œå…¶å‡†ç¡®åº¦ç›¸å½“é«˜ã€‚</p><h4 id="ä¸¾ä¾‹è¯´æ˜"><a href="#ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜"></a>ä¸¾ä¾‹è¯´æ˜</h4><p>å‡è®¾æ¯å¤©æ¶¨å¹…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>è®¡ç®—RSIçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>å°†6å¤©ä¸Šå‡çš„æ•°ç›®ç›¸åŠ ï¼Œé™¤ä»¥6ï¼Œä¸Šä¾‹ä¸­æ€»å…±ä¸Šå‡10å…ƒé™¤ä»¥6å¾—1.667</p><p>å°†6å¤©ä¸‹è·Œçš„æ•°ç›®ç›¸åŠ ï¼Œé™¤ä»¥6ï¼Œä¸Šä¾‹ä¸­æ€»å…±ä¸‹è·Œ4å…ƒé™¤ä»¥6å¾—0.667</p><p>æ±‚å‡ºç›¸å¯¹å¼ºåº¦RSï¼Œå³RS=1.667/0.6â€‹â€‹67=2.4993ï¼Œå†å°†ç»“æœå¥—å…¥å…¬å¼äºŒå³å¯æ±‚è§£ï¼š14å¤©çš„å¼ºå¼±æŒ‡æ ‡RS1ä¸º71.423</p><h4 id="è§£è¯»RSI"><a href="#è§£è¯»RSI" class="headerlink" title="è§£è¯»RSI"></a>è§£è¯»RSI</h4><p>RSIæŠŠç›¸å¯¹å¼ºåº¦çš„æ•°å€¼å®šä¹‰åœ¨ 0~100ä¹‹é—´ï¼Œå¦‚æ­¤æ›´èƒ½æ–¹ä¾¿å‚è€ƒä½¿ç”¨ã€‚è€Œå¤šå¤©æœŸçš„RSI (å³nå€¼è¾ƒå¤§) å…¶è®¯å·å°†æ›´å…·å‚è€ƒæ€§ã€‚</p><p>RSIæ•°å€¼è¶Šå¤§ä»£è¡¨ä¹°æ–¹åŠ›é“è¶Šå¼ºï¼Œä½†å¼ºå¼©ä¹‹æœ«æ€»ä¼šè¡°ç«­ï¼Œå› æ­¤å½“RSIå¤§åˆ°æŸä¸€ç¨‹åº¦æ—¶é€šå¸¸å¼€å§‹ä»£è¡¨ä¹°è¶…ç°è±¡ï¼Œéœ€æ³¨æ„åè½¬ã€‚åŒç†ï¼Œå½“RSIä½åˆ°æŸä¸€ç¨‹åº¦æ—¶ï¼Œé€šå¸¸ä»£è¡¨å¸‚åœºå‡ºç°éç†æ€§çš„å–è¶…ç°è±¡ï¼Œè¡¨ç¤ºåº•éƒ¨åŒºå·²è¿‘ ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒRSIæœ‰ä»¥ä¸‹ç ”åˆ¤åŠŸèƒ½ï¼š</p><ul><li>ä¹°è¶…ã€å–è¶…ã€æŒå¹³</li><li>åè½¬è®¯å·</li><li>èƒŒç¦»è®¯å·</li><li>ä¹°å…¥å–å‡ºè®¯å·</li></ul><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li><p>RSIæŒ‡æ ‡åœ¨é«˜æ¡£æˆ–ä½æ¡£æœ‰æ—¶ä¼šæœ‰é’åŒ–çš„ç°è±¡ï¼Œå› æ­¤ä¼šå‘ç”Ÿè¿‡æ—©å–å‡ºæˆ–ä¹°è¿›ã€‚</p></li><li><p>RSIåªèƒ½ä½œä¸ºä¸€ä¸ªè­¦å‘Šè®¯å·ï¼Œå¹¶ä¸æ„å‘³ç€å¸‚åŠ¿å¿…ç„¶æœè¿™ä¸ªæ–¹å‘å‘å±•ï¼Œå°¤å…¶åœ¨å¸‚åœºå‰§çƒˆéœ‡è¡æ—¶ï¼Œè¶…å–è¿˜æœ‰è¶…å–ï¼Œè¶…ä¹°è¿˜æœ‰è¶…ä¹°ï¼Œè¿™æ—¶é¡»å‚è€ƒå…¶ä»–æŒ‡æ ‡ç»¼åˆåˆ†æï¼Œåƒæ˜¯åˆ©ç”¨é•¿å¤©æœŸçš„RSIå‡çº¿ä¸RSIçº¿çš„å…³ç³»æ¥ä½œä¹°å–è®¯å·åˆ¤æ–­ï¼Œä¸èƒ½å•ç‹¬ä¾èµ–RSIçš„è®¯å·è€Œä½œå‡ºä¹°å–å†³å®šã€‚</p></li><li><p>èƒŒç¦»èµ°åŠ¿çš„è®¯å·é€šå¸¸è€…éƒ½æ˜¯äº‹åå†å²ï¼Œè€Œä¸”æœ‰èƒŒç¦»èµ°åŠ¿å‘ç”Ÿä¹‹åï¼Œè¡Œæƒ…å¹¶æ— åè½¬çš„ç°è±¡ã€‚æœ‰æ—¶èƒŒç¦»ä¸€ï¼ŒäºŒæ¬¡æ‰çœŸæ­£åè½¬ï¼Œå› æ­¤è¿™æ–¹é¢ç ”åˆ¤é¡»ä¸æ–­åˆ†æå†å²èµ„æ–™ä»¥æé«˜ç»éªŒã€‚</p></li><li><p>ç”±äºRSIæ˜¯ä¸€ç§æ¯”ç‡çš„æŒ‡æ ‡ï¼Œå› æ­¤åœ¨è¶‹åŠ¿åˆ†æçš„èƒ½åŠ›ä¸Šä¼šè¾ƒå¼±ã€‚</p></li><li><p>ç›˜åŠ¿è¿›å…¥æ¨ªç›˜æ•´ç†æ—¶ï¼Œé•¿çŸ­å¤©æœŸçš„RSIä¹Ÿå®¹æ˜“å½¢æˆé‡å¤äº¤å‰çš„æƒ…å½¢ã€‚</p></li></ol><hr><h3 id="Refference"><a href="#Refference" class="headerlink" title="Refference"></a>Refference</h3><blockquote><p><a href="https://wiki.mbalib.com/wiki/%E7%9B%B8%E5%AF%B9%E5%BC%BA%E5%BC%B1%E6%8C%87%E6%A0%87" target="_blank" rel="noopener">https://wiki.mbalib.com/wiki/%E7%9B%B8%E5%AF%B9%E5%BC%BA%E5%BC%B1%E6%8C%87%E6%A0%87</a><br><a href="https://journal.eyeprophet.com/%E6%95%99%E4%BD%A0%E7%9C%8B%E6%87%82-rsi-%E7%9B%B8%E5%B0%8D%E5%BC%B7%E5%BC%B1%E6%8C%87%E6%A8%99/" target="_blank" rel="noopener">https://journal.eyeprophet.com/%E6%95%99%E4%BD%A0%E7%9C%8B%E6%87%82-rsi-%E7%9B%B8%E5%B0%8D%E5%BC%B7%E5%BC%B1%E6%8C%87%E6%A8%99/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;ç›¸å¯¹å¼ºå¼±æŒ‡æ•°RSIæœ€æ—©è¢«ç”¨äºæœŸè´§äº¤æ˜“ä¸­ï¼Œåæ¥å‘ç°ç”¨è¯¥æŒ‡æ ‡æ¥æŒ‡
      
    
    </summary>
    
      <category term="Finance" scheme="https://sulangsss.github.io/categories/Finance/"/>
    
    
      <category term="Finance" scheme="https://sulangsss.github.io/tags/Finance/"/>
    
      <category term="é‡‘è" scheme="https://sulangsss.github.io/tags/%E9%87%91%E8%9E%8D/"/>
    
      <category term="RSI" scheme="https://sulangsss.github.io/tags/RSI/"/>
    
  </entry>
  
  <entry>
    <title>Java AtomicLong å’Œ LongAdder</title>
    <link href="https://sulangsss.github.io/2019/02/01/Java/Advance/AtomicLong%E5%92%8CLongAddr/"/>
    <id>https://sulangsss.github.io/2019/02/01/Java/Advance/AtomicLongå’ŒLongAddr/</id>
    <published>2019-02-01T03:01:22.000Z</published>
    <updated>2019-02-11T02:55:47.632Z</updated>
    
    <content type="html"><![CDATA[<h3 id="AtomicLong"><a href="#AtomicLong" class="headerlink" title="AtomicLong"></a>AtomicLong</h3><p>AtomicLongæ˜¯JUCåŒ…æä¾›çš„åŸå­æ€§æ“ä½œç±»ï¼Œå…¶å†…éƒ¨é€šè¿‡CASä¿è¯äº†å¯¹è®¡æ•°çš„åŸå­æ€§æ›´æ–°æ“ä½œã€‚</p><blockquote><p>java.util.concurrent.atomi</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, <span class="number">1L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…éƒ¨æ˜¯é€šè¿‡UnSafe(rt.jar)è¿™ä¸ªç±»çš„CASæ“ä½œæ¥ä¿è¯å¯¹å†…éƒ¨çš„è®¡æ•°å™¨å˜é‡long valueè¿›è¡ŒåŸå­æ€§æ›´æ–°çš„ã€‚å…¶ä¸­unsafe.getAndAddLongçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> <span class="title">getAndAddLong</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">long</span> var4)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> var6;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        var6 = <span class="keyword">this</span>.getLongVolatile(var1, var2);    <span class="comment">//(1)</span></span><br><span class="line">    &#125; <span class="keyword">while</span>(!<span class="keyword">this</span>.compareAndSwapLong(var1, var2, var6, var6 + var4)); <span class="comment">//(2)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯çŸ¥æœ€ç»ˆè°ƒç”¨çš„æ˜¯nativeæ–¹æ³•compareAndSwapLongåŸå­æ€§æ“ä½œã€‚</p><p>å‡å¦‚å¤šä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªAtomicLongå¯¹è±¡è¿›è¡Œæ›´æ–°æ“ä½œ(getAndIncrement)ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p><p>å¤šä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œåˆ°unsafe.getAndAddLongæ–¹æ³•ï¼Œç„¶åå¤šä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œåˆ°ä»£ç (1)å¤„è·å–è®¡æ•°å™¨çš„å€¼ã€‚æ¥ç€å¤šä¸ªçº¿ç¨‹å†å»(2)å°è¯•æ›´æ–°å€¼ï¼Œç”±äºCASå…·æœ‰åŸå­æ€§ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæ›´æ–°æˆåŠŸï¼Œç„¶åè¿”å›trueä»è€Œé€€å‡ºå¾ªç¯ï¼Œæ•´ä¸ªæ›´æ–°æ“ä½œå°±å®Œæˆäº†ã€‚å…¶ä»–çº¿ç¨‹åˆ™CASå¤±è´¥åè¿”å›falseï¼Œåˆ™å¾ªç¯ä¸€æ¬¡åœ¨æ¬¡ä»(1)å¤„è·å–å½“å‰è®¡æ•°å™¨çš„å€¼ï¼Œç„¶ååœ¨å°è¯•æ‰§è¡Œ(2)ï¼Œè¿™å«åšCASçš„è‡ªæ—‹æ“ä½œï¼Œæœ¬è´¨æ˜¯ä½¿ç”¨CPUèµ„æºæ¢å–ä½¿ç”¨é”å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰å¼€é”€ã€‚</p><hr><h3 id="LongAdder"><a href="#LongAdder" class="headerlink" title="LongAdder"></a>LongAdder</h3><p>AtomicLongç±»ä¸ºå¼€å‘äººå‘˜ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨æä¾›äº†æ–¹ä¾¿ï¼Œä½†æ˜¯AtomicLongåœ¨é«˜å¹¶å‘ä¸‹å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå½“å¤§é‡çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªAtomicLongçš„å®ä¾‹çš„æ–¹æ³•æ—¶å€™ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šCASè®¡æ•°å™¨çš„å€¼æˆåŠŸï¼Œå¤±è´¥çš„çº¿ç¨‹åˆ™ä¼šåŸåœ°å ç”¨cpuè¿›è¡Œè‡ªæ—‹è½¬é‡è¯•ï¼Œè¿™å›é€ æˆå¤§é‡çº¿ç¨‹ç™½ç™½æµªè´¹CPUåŸåœ°è‡ªæ—‹è½¬ã€‚</p><p>åœ¨JDK8ä¸­æ–°å¢äº†ä¸€ä¸ªLongAdderç±»ï¼Œå…¶é‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„ç­–ç•¥æ¥å‡å°‘åŒä¸€ä¸ªå˜é‡çš„å¹¶å‘ç«äº‰åº¦ï¼Œ<strong>LongAdderçš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠä¸€ä¸ªåŸå­å˜é‡åˆ†è§£ä¸ºå¤šä¸ªå˜é‡ï¼Œè®©åŒæ ·å¤šçš„çº¿ç¨‹å»ç«äº‰å¤šä¸ªèµ„æºï¼Œè¿™æ ·ç«äº‰æ¯ä¸ªèµ„æºçš„çº¿ç¨‹æ•°å°±è¢«åˆ†æ‹…äº†ä¸‹æ¥ã€‚</strong></p><img src="/2019/02/01/Java/Advance/AtomicLongå’ŒLongAddr/LongAddr-CAS.png"><p>åœ¨LongAdderçš„åº•å±‚å®ç°ä¸­ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªbaseå€¼ï¼Œåˆšå¼€å§‹å¤šçº¿ç¨‹æ¥ä¸åœçš„ç´¯åŠ æ•°å€¼ï¼Œéƒ½æ˜¯å¯¹baseè¿›è¡Œç´¯åŠ çš„ï¼Œæ¯”å¦‚åˆšå¼€å§‹ç´¯åŠ æˆäº†base = 5ã€‚æ¥ç€å¦‚æœå‘ç°å¹¶å‘æ›´æ–°çš„çº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œå°±ä¼šå¼€å§‹æ–½è¡Œåˆ†æ®µCASçš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨ä¼šæä¸€ä¸ªCellæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªæ•°å€¼åˆ†æ®µã€‚</p><p>è¿™æ—¶ï¼Œè®©å¤§é‡çš„çº¿ç¨‹åˆ†åˆ«å»å¯¹ä¸åŒCellå†…éƒ¨çš„valueå€¼è¿›è¡ŒCASç´¯åŠ æ“ä½œï¼Œè¿™æ ·å°±æŠŠCASè®¡ç®—å‹åŠ›åˆ†æ•£åˆ°äº†ä¸åŒçš„Cellåˆ†æ®µæ•°å€¼ä¸­äº†ã€‚è¿™æ ·å°±å¯ä»¥å¤§å¹…åº¦çš„é™ä½å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°åŒä¸€ä¸ªæ•°å€¼æ—¶å‡ºç°çš„æ— é™å¾ªç¯çš„é—®é¢˜ï¼Œå¤§å¹…åº¦æå‡äº†å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°æ•°å€¼çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p><p>è€Œä¸”LongAdderå†…éƒ¨å®ç°äº†è‡ªåŠ¨åˆ†æ®µè¿ç§»çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæŸä¸ªCellçš„valueæ‰§è¡ŒCASå¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨å»æ‰¾å¦å¤–ä¸€ä¸ªCellåˆ†æ®µå†…çš„valueå€¼è¿›è¡ŒCASæ“ä½œã€‚è¿™æ ·ä¹Ÿè§£å†³äº†çº¿ç¨‹ç©ºæ—‹è½¬ã€è‡ªæ—‹ä¸åœç­‰å¾…æ‰§è¡ŒCASæ“ä½œçš„é—®é¢˜ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‰§è¡ŒCASæ—¶å¯ä»¥å°½å¿«çš„å®Œæˆè¿™ä¸ªæ“ä½œã€‚</p><p>æœ€åï¼Œå¦‚æœä½ è¦ä»LongAdderä¸­è·å–å½“å‰ç´¯åŠ çš„æ€»å€¼ï¼Œå°±ä¼šæŠŠbaseå€¼å’Œæ‰€æœ‰Cellåˆ†æ®µæ•°å€¼åŠ èµ·æ¥è¿”å›ç»™ä½ ã€‚</p><h4 id="Analyze-Source-Code"><a href="#Analyze-Source-Code" class="headerlink" title="Analyze Source Code"></a>Analyze Source Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Number of CPUS, to place bound on table size */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NCPU = Runtime.getRuntime().availableProcessors();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Table of cells. When non-null, size is a power of 2.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">volatile</span> Cell[] cells;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Base value, used mainly when there is no contention, but also as</span></span><br><span class="line"><span class="comment">* a fallback during table initialization races. Updated via CAS.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">long</span> base;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Spinlock (locked via CAS) used when resizing and/or creating Cells.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> cellsBusy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Cell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line">    Cell(<span class="keyword">long</span> x) &#123; value = x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">cas</span><span class="params">(<span class="keyword">long</span> cmp, <span class="keyword">long</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="keyword">this</span>, valueOffset, cmp, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unsafe mechanics</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> valueOffset;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">            Class&lt;?&gt; ak = Cell.class;</span><br><span class="line">            valueOffset = UNSAFE.objectFieldOffset(ak.getDeclaredField(<span class="string">"value"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LongAdderç»´æŠ¤äº†ä¸€ä¸ªå»¶è¿Ÿåˆå§‹åŒ–çš„åŸå­æ€§æ›´æ–°æ•°ç»„ï¼ˆé»˜è®¤æƒ…å†µä¸‹Cellæ•°ç»„æ˜¯nullï¼‰å’Œä¸€ä¸ªåŸºå€¼å˜é‡baseï¼Œç”±äºCellså ç”¨å†…å­˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å¹¶ä¸åˆ›å»ºï¼Œè€Œæ˜¯åœ¨éœ€è¦æ—¶å€™åœ¨åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§åˆ›å»ºã€‚</p><p>å½“ä¸€å¼€å§‹åˆ¤æ–­cellæ•°ç»„æ˜¯nullå¹¶ä¸”å¹¶å‘çº¿ç¨‹è¾ƒå°‘æ—¶å€™æ‰€æœ‰çš„ç´¯åŠ æ“ä½œéƒ½æ˜¯å¯¹baseå˜é‡è¿›è¡Œçš„ï¼Œè¿™æ—¶å€™å°±é€€åŒ–ä¸ºäº†AtomicLongã€‚cellæ•°ç»„çš„å¤§å°ä¿æŒæ˜¯2çš„Næ¬¡æ–¹å¤§å°ï¼Œåˆå§‹åŒ–æ—¶å€™Cellæ•°ç»„çš„ä¸­Cellçš„å…ƒç´ ä¸ªæ•°ä¸º2ï¼Œæ•°ç»„é‡Œé¢çš„å˜é‡å®ä½“æ˜¯Cellç±»å‹ã€‚</p><p>å½“å¤šä¸ªçº¿ç¨‹åœ¨äº‰å¤ºåŒä¸€ä¸ªCellåŸå­å˜é‡æ—¶å€™å¦‚æœå¤±è´¥å¹¶ä¸æ˜¯åœ¨å½“å‰cellå˜é‡ä¸Šä¸€ç›´è‡ªæ—‹CASé‡è¯•ï¼Œè€Œæ˜¯ä¼šå°è¯•åœ¨å…¶å®ƒCellçš„å˜é‡ä¸Šè¿›è¡ŒCASå°è¯•ï¼Œè¿™ä¸ªæ”¹å˜å¢åŠ äº†å½“å‰çº¿ç¨‹é‡è¯•æ—¶å€™CASæˆåŠŸçš„å¯èƒ½æ€§ã€‚</p><p>LongAdderè¿”å›çš„å€¼æ˜¯æŠŠæ‰€æœ‰Cellå˜é‡çš„valueå€¼ç´¯åŠ åå†åŠ ä¸Šbaseå€¼ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Cell[] as = cells; Cell a;</span><br><span class="line">    <span class="keyword">long</span> sum = base;</span><br><span class="line">    <span class="keyword">if</span> (as != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((a = as[i]) != <span class="keyword">null</span>)</span><br><span class="line">                sum += a.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h4><ul><li>ä½•æ—¶åˆå§‹åŒ–cellæ•°ç»„?</li><li>å½“å‰çº¿ç¨‹å¦‚ä½•é€‰æ‹©cellä¸­çš„å…ƒç´ è¿›è¡Œè®¿é—®?</li><li>å¦‚æœä¿è¯cellä¸­å…ƒç´ æ›´æ–°çš„çº¿ç¨‹å®‰å…¨?</li><li>cellæ•°ç»„ä½•æ—¶è¿›è¡Œæ‰©å®¹ï¼Œcellå…ƒç´ ä¸ªæ•°å¯ä»¥æ— é™æ‰©å¼ ?</li></ul><hr><h3 id="Refference"><a href="#Refference" class="headerlink" title="Refference"></a>Refference</h3><blockquote><p><a href="http://ifeve.com/juc1/" target="_blank" rel="noopener">http://ifeve.com/juc1/</a><br><a href="https://juejin.im/post/5c062c87e51d451dbc21801b" target="_blank" rel="noopener">https://juejin.im/post/5c062c87e51d451dbc21801b</a><br><a href="http://blog.palominolabs.com/2014/02/10/java-8-performance-improvements-longadder-vs-atomiclong/" target="_blank" rel="noopener">http://blog.palominolabs.com/2014/02/10/java-8-performance-improvements-longadder-vs-atomiclong/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;AtomicLong&quot;&gt;&lt;a href=&quot;#AtomicLong&quot; class=&quot;headerlink&quot; title=&quot;AtomicLong&quot;&gt;&lt;/a&gt;AtomicLong&lt;/h3&gt;&lt;p&gt;AtomicLongæ˜¯JUCåŒ…æä¾›çš„åŸå­æ€§æ“ä½œç±»ï¼Œå…¶å†…éƒ¨é€šè¿‡CASä¿è¯äº†å¯¹è®¡
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Advance" scheme="https://sulangsss.github.io/categories/Java/Advance/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="LongAdder" scheme="https://sulangsss.github.io/tags/LongAdder/"/>
    
      <category term="AtomicLong" scheme="https://sulangsss.github.io/tags/AtomicLong/"/>
    
      <category term="CAS" scheme="https://sulangsss.github.io/tags/CAS/"/>
    
  </entry>
  
  <entry>
    <title>FireFox DNS over HTTPS</title>
    <link href="https://sulangsss.github.io/2019/01/30/Firefox/FirefoxDNS/"/>
    <id>https://sulangsss.github.io/2019/01/30/Firefox/FirefoxDNS/</id>
    <published>2019-01-30T02:13:06.000Z</published>
    <updated>2019-01-30T02:23:32.250Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><ol><li>åœ¨åœ°å€æ ä¸­æ‰§è¡Œabout:configæ‰“å¼€æµè§ˆå™¨é…ç½®é€‰é¡¹ï¼Œè®¾ç½®network.trr.modeä¸º2ï¼Œè®¾ç½®ä¸º2è¡¨ç¤ºä½¿ç”¨DNS over HTTPSä½œä¸ºæµè§ˆå™¨çš„DNSæŸ¥è¯¢é¦–é€‰é¡¹ï¼Œä½†ä¹Ÿå°†å¸¸è§„DNSæŸ¥è¯¢ä½œä¸ºåå¤‡ï¼Œ2æ˜¯å…¼å®¹æ€§æœ€ä½³è®¾ç½®ã€‚æ‚¨å¯ä»¥å°†å…¶è®¾ç½®ä¸º1ï¼Œè®©Firefoxé€‰æ‹©æ›´å¿«çš„æ¨¡å¼ï¼›3ä½¿ç”¨TRR onlyæ¨¡å¼ï¼Œæˆ–è€…ä½¿ç”¨ 0 æ¥ç¦ç”¨è¯¥åŠŸèƒ½ã€‚</li><li>network.trr.uriï¼Œè¯¥é¦–é€‰é¡¹è®¾ç½®è¦ä½¿ç”¨çš„ DNS over HTTPS æœåŠ¡å™¨ã€‚é»˜è®¤çš„æ˜¯<a href="https://mozilla.cloudflare-dns.com/dns-queryï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹é¢çš„æœåŠ¡å•†ï¼š" target="_blank" rel="noopener">https://mozilla.cloudflare-dns.com/dns-queryï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹é¢çš„æœåŠ¡å•†ï¼š</a></li></ol><ul><li><a href="https://cloudflare-dns.com/dns-query" target="_blank" rel="noopener">https://cloudflare-dns.com/dns-query</a></li><li><a href="https://dns.google.com/experimental" target="_blank" rel="noopener">https://dns.google.com/experimental</a></li></ul><ol start="3"><li>å¦‚æœä½ é€‰æ‹©äº†cloudflareï¼Œå¯ä»¥æŠŠnetwork.trr.bootstrapAddressè®¾ç½®ä¸º1.1.1.1 / 1.0.0.1</li></ol><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://www.sysgeek.cn/configure-dns-over-https-in-firefox/" target="_blank" rel="noopener">https://www.sysgeek.cn/configure-dns-over-https-in-firefox/</a><br><a href="https://zhuanlan.zhihu.com/p/42468805" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/42468805</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Usage&quot;&gt;&lt;a href=&quot;#Usage&quot; class=&quot;headerlink&quot; title=&quot;Usage&quot;&gt;&lt;/a&gt;Usage&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åœ¨åœ°å€æ ä¸­æ‰§è¡Œabout:configæ‰“å¼€æµè§ˆå™¨é…ç½®é€‰é¡¹ï¼Œè®¾ç½®network.trr.modeä¸º2ï¼Œè®¾ç½®
      
    
    </summary>
    
      <category term="Firefox" scheme="https://sulangsss.github.io/categories/Firefox/"/>
    
    
      <category term="FireFox" scheme="https://sulangsss.github.io/tags/FireFox/"/>
    
      <category term="DNS" scheme="https://sulangsss.github.io/tags/DNS/"/>
    
      <category term="HTTPS" scheme="https://sulangsss.github.io/tags/HTTPS/"/>
    
  </entry>
  
  <entry>
    <title>False Sharing</title>
    <link href="https://sulangsss.github.io/2019/01/28/Java/Advance/Memory/FalseSharing/"/>
    <id>https://sulangsss.github.io/2019/01/28/Java/Advance/Memory/FalseSharing/</id>
    <published>2019-01-28T08:13:06.000Z</published>
    <updated>2019-02-01T03:16:02.024Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>ç¼“å­˜ç³»ç»Ÿä¸­æ˜¯ä»¥ç¼“å­˜è¡Œï¼ˆcache lineï¼‰ä¸ºå•ä½å­˜å‚¨çš„ã€‚ç¼“å­˜è¡Œæ˜¯2çš„æ•´æ•°å¹‚ä¸ªè¿ç»­å­—èŠ‚ï¼Œä¸€èˆ¬ä¸º32-256ä¸ªå­—èŠ‚ã€‚æœ€å¸¸è§çš„ç¼“å­˜è¡Œå¤§å°æ˜¯64ä¸ªå­—èŠ‚ã€‚å½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«ã€‚ç¼“å­˜è¡Œä¸Šçš„å†™ç«äº‰æ˜¯è¿è¡Œåœ¨SMPç³»ç»Ÿä¸­å¹¶è¡Œçº¿ç¨‹å®ç°å¯ä¼¸ç¼©æ€§æœ€é‡è¦çš„é™åˆ¶å› ç´ ã€‚æœ‰äººå°†ä¼ªå…±äº«æè¿°æˆæ— å£°çš„æ€§èƒ½æ€æ‰‹ï¼Œå› ä¸ºä»ä»£ç ä¸­å¾ˆéš¾çœ‹æ¸…æ¥šæ˜¯å¦ä¼šå‡ºç°ä¼ªå…±äº«ã€‚ </p><p>ä¸ºäº†è®©å¯ä¼¸ç¼©æ€§ä¸çº¿ç¨‹æ•°å‘ˆçº¿æ€§å…³ç³»ï¼Œå°±å¿…é¡»ç¡®ä¿ä¸ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹å¾€åŒä¸€ä¸ªå˜é‡æˆ–ç¼“å­˜è¡Œä¸­å†™ã€‚ä¸¤ä¸ªçº¿ç¨‹å†™åŒä¸€ä¸ªå˜é‡å¯ä»¥åœ¨ä»£ç ä¸­å‘ç°ã€‚ä¸ºäº†ç¡®å®šäº’ç›¸ç‹¬ç«‹çš„å˜é‡æ˜¯å¦å…±äº«äº†åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±éœ€è¦äº†è§£å†…å­˜å¸ƒå±€ã€‚</p><hr><img src="/2019/01/28/Java/Advance/Memory/FalseSharing/cache-line.png"><p>åœ¨æ ¸å¿ƒ1ä¸Šè¿è¡Œçš„çº¿ç¨‹æƒ³æ›´æ–°å˜é‡Xï¼ŒåŒæ—¶æ ¸å¿ƒ2ä¸Šçš„çº¿ç¨‹æƒ³è¦æ›´æ–°å˜é‡Yã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½è¦å»ç«äº‰ç¼“å­˜è¡Œçš„æ‰€æœ‰æƒæ¥æ›´æ–°å˜é‡ã€‚å¦‚æœæ ¸å¿ƒ1è·å¾—äº†æ‰€æœ‰æƒï¼Œç¼“å­˜å­ç³»ç»Ÿå°†ä¼šä½¿æ ¸å¿ƒ2ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œå¤±æ•ˆã€‚å½“æ ¸å¿ƒ2è·å¾—äº†æ‰€æœ‰æƒç„¶åæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒ1å°±è¦ä½¿è‡ªå·±å¯¹åº”çš„ç¼“å­˜è¡Œå¤±æ•ˆã€‚è¿™ä¼šæ¥æ¥å›å›çš„ç»è¿‡L3ç¼“å­˜ï¼Œå¤§å¤§å½±å“äº†æ€§èƒ½ã€‚å¦‚æœäº’ç›¸ç«äº‰çš„æ ¸å¿ƒä½äºä¸åŒçš„æ’æ§½ï¼Œå°±è¦é¢å¤–æ¨ªè·¨æ’æ§½è¿æ¥ï¼Œé—®é¢˜å¯èƒ½æ›´åŠ ä¸¥é‡ã€‚ </p><hr><h3 id="Java-Memory-Layout"><a href="#Java-Memory-Layout" class="headerlink" title="Java Memory Layout"></a>Java Memory Layout</h3><p>å¯¹äºHotSpot JVM(32ä½)ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æœ‰ä¸¤ä¸ªå­—(32ä½ + 32ä½)çš„å¯¹è±¡å¤´ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå­—æ˜¯ç”±24ä½å“ˆå¸Œç å’Œ8ä½æ ‡å¿—ä½ï¼ˆå¦‚é”çš„çŠ¶æ€æˆ–ä½œä¸ºé”å¯¹è±¡ï¼‰ç»„æˆçš„Mark Wordã€‚</li><li>ç¬¬äºŒä¸ªå­—æ˜¯å¯¹è±¡æ‰€å±ç±»çš„å¼•ç”¨(å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡è¿˜éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—æ¥å­˜å‚¨æ•°ç»„çš„é•¿åº¦)ã€‚</li></ul><p>æ¯ä¸ªå¯¹è±¡çš„èµ·å§‹åœ°å€éƒ½å¯¹é½äº8å­—èŠ‚ä»¥æé«˜æ€§èƒ½ã€‚å› æ­¤å½“å°è£…å¯¹è±¡çš„æ—¶å€™ä¸ºäº†é«˜æ•ˆç‡ï¼Œå¯¹è±¡å­—æ®µå£°æ˜çš„é¡ºåºä¼šè¢«é‡æ’åºæˆä¸‹åˆ—åŸºäºå­—èŠ‚å¤§å°çš„é¡ºåºï¼š</p><ul><li>doubles (8) å’Œ longs (8)</li><li>ints (4) å’Œ floats (4)</li><li>shorts (2) å’Œ chars (2)</li><li>booleans (1) å’Œ bytes (1)</li><li>references (4/8)</li></ul><hr><h3 id="Performance-Testing"><a href="#Performance-Testing" class="headerlink" title="Performance Testing"></a>Performance Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileLong</span>(</span></span><br><span class="line"><span class="class">    @<span class="title">Volatile</span></span></span><br><span class="line">    var value: Long = 0</span><br><span class="line">) &#123;</span><br><span class="line">   <span class="comment">// if comment below code, happen false sharing</span></span><br><span class="line">   var p1: Long = <span class="number">0</span></span><br><span class="line">   var p2: Long = <span class="number">0</span></span><br><span class="line">   var p3: Long = <span class="number">0</span></span><br><span class="line">   var p4: Long = <span class="number">0</span></span><br><span class="line">   var p5: Long = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FalseSharing</span>(</span></span><br><span class="line">    private val threadCount: Int = 4,</span><br><span class="line">    <span class="keyword">private</span> val loopTimes: Long = <span class="number">500</span> * <span class="number">1000L</span> * <span class="number">1000L</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">private</span> val vlongs: Array&lt;VolatileLong&gt; = Array(threadCount) &#123; VolatileLong() &#125;</span><br><span class="line">    <span class="keyword">private</span> val threads = arrayListOf&lt;Thread&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="function">fun <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (index in <span class="number">0</span> until threadCount) &#123;</span><br><span class="line">            threads.add(thread &#123;</span><br><span class="line">                <span class="comment">//  println("Thread $&#123;Thread.currentThread().id&#125; start")</span></span><br><span class="line">                var end = loopTimes + index</span><br><span class="line">                <span class="keyword">while</span> (end != <span class="number">0L</span>) &#123;</span><br><span class="line">                    vlongs[index].value = end</span><br><span class="line">                    end -= <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//  println("Thread $&#123;Thread.currentThread().id&#125; stop")</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (thread in threads) &#123;</span><br><span class="line">            thread.join()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  50äº¿</span></span><br><span class="line">    val times = <span class="number">500</span> * <span class="number">1000L</span> * <span class="number">1000L</span></span><br><span class="line">    val begin = System.currentTimeMillis()</span><br><span class="line">    FalseSharing(loopTimes = times).start()</span><br><span class="line">    val end = System.currentTimeMillis()</span><br><span class="line">    println(<span class="string">"consume time ($times): $&#123;end - begin&#125;"</span>)</span><br><span class="line">    <span class="comment">//  no false sharing: consume time (500000000): 3278 ms</span></span><br><span class="line">    <span class="comment">//  false sharing: consume time (500000000): 44364</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Code-Tools-jol"><a href="#Code-Tools-jol" class="headerlink" title="Code Tools: jol"></a>Code Tools: jol</h3><p>JOL (Java Object Layout) is the tiny toolbox to analyze object layout schemes in JVMs.</p><h4 id="Command-Line-Tool"><a href="#Command-Line-Tool" class="headerlink" title="Command Line Tool"></a>Command Line Tool</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java -jar jol-cli-0.9-full.jar internals java.lang.Long</span><br><span class="line"></span><br><span class="line"><span class="comment"># Running 64-bit HotSpot VM.</span></span><br><span class="line"><span class="comment"># Using compressed oop with 3-bit shift.</span></span><br><span class="line"><span class="comment"># Using compressed klass with 3-bit shift.</span></span><br><span class="line"><span class="comment"># WARNING | Compressed references base/shifts are guessed by the experiment!</span></span><br><span class="line"><span class="comment"># WARNING | Therefore, computed addresses are just guesses, and ARE NOT RELIABLE.</span></span><br><span class="line"><span class="comment"># WARNING | Make sure to attach Serviceability Agent to get the reliable addresses.</span></span><br><span class="line"><span class="comment"># Objects are 8 bytes aligned.</span></span><br><span class="line"><span class="comment"># Field sizes by type: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]</span></span><br><span class="line"><span class="comment"># Array element sizes: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]</span></span><br><span class="line"></span><br><span class="line">Instantiated the sample instance via public java.lang.Long(long)</span><br><span class="line"></span><br><span class="line">java.lang.Long object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)</span><br><span class="line">      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">      8     4        (object header)                           f4 22 00 f8 (11110100 00100010 00000000 11111000) (-134208780)</span><br><span class="line">     12     4        (alignment/padding gap)                  </span><br><span class="line">     16     8   long Long.value                                0</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 4 bytes internal + 0 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jol<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jol-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileLong</span>(</span></span><br><span class="line"><span class="class">    @<span class="title">Volatile</span></span></span><br><span class="line">    var value: Long = 0</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    var p1: Long = 0</span></span><br><span class="line"><span class="comment">    var p2: Long = 0</span></span><br><span class="line"><span class="comment">    var p3: Long = 0</span></span><br><span class="line"><span class="comment">    var p4: Long = 0</span></span><br><span class="line"><span class="comment">    var p5: Long = 0</span></span><br><span class="line"><span class="comment">    var p6: Long = 0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(VM.current().details())</span><br><span class="line">    println(ClassLayout.parseClass(VolatileLong::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">toPrintable</span>())</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: Unable to attach Serviceability Agent. You can try again with escalated privileges. Two options: a) use -Djol.tryWithSudo=true to try with sudo; b) echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope</span></span><br><span class="line"><span class="comment"># Running 64-bit HotSpot VM.</span></span><br><span class="line"><span class="comment"># Using compressed oop with 3-bit shift.</span></span><br><span class="line"><span class="comment"># Using compressed klass with 3-bit shift.</span></span><br><span class="line"><span class="comment"># WARNING | Compressed references base/shifts are guessed by the experiment!</span></span><br><span class="line"><span class="comment"># WARNING | Therefore, computed addresses are just guesses, and ARE NOT RELIABLE.</span></span><br><span class="line"><span class="comment"># WARNING | Make sure to attach Serviceability Agent to get the reliable addresses.</span></span><br><span class="line"><span class="comment"># Objects are 8 bytes aligned.</span></span><br><span class="line"><span class="comment"># Field sizes by type: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]</span></span><br><span class="line"><span class="comment"># Array element sizes: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]</span></span><br><span class="line"></span><br><span class="line">com.demo.falsesharing.VolatileLong object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0    12        (object header)                           N/A</span><br><span class="line">     12     4        (alignment/padding gap)                  </span><br><span class="line">     16     8   long VolatileLong.value                        N/A</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 4 bytes internal + 0 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›VolatileLongåœ¨ä¸€ä¸ªcache lineä¸Šï¼Œå¯ä»¥ä¿®æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileLong</span>(</span></span><br><span class="line"><span class="class">    @<span class="title">Volatile</span></span></span><br><span class="line">    var value: Long = 0</span><br><span class="line">) &#123;</span><br><span class="line">    var p1: Long = <span class="number">0</span></span><br><span class="line">    var p2: Long = <span class="number">0</span></span><br><span class="line">    var p3: Long = <span class="number">0</span></span><br><span class="line">    var p4: Long = <span class="number">0</span></span><br><span class="line">    var p5: Long = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(VM.current().details())</span><br><span class="line">    println(ClassLayout.parseClass(VolatileLong::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">toPrintable</span>())</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">com.demo.falsesharing.VolatileLong object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0    12        (object header)                           N/A</span><br><span class="line">     12     4        (alignment/padding gap)                  </span><br><span class="line">     16     8   long VolatileLong.p1                           N/A</span><br><span class="line">     24     8   long VolatileLong.p2                           N/A</span><br><span class="line">     32     8   long VolatileLong.p3                           N/A</span><br><span class="line">     40     8   long VolatileLong.p4                           N/A</span><br><span class="line">     48     8   long VolatileLong.p5                           N/A</span><br><span class="line">     56     8   long VolatileLong.value                        N/A</span><br><span class="line">Instance size: 64 bytes</span><br><span class="line">Space losses: 4 bytes internal + 0 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html" target="_blank" rel="noopener">https://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html</a><br><a href="http://openjdk.java.net/projects/code-tools/jol/" target="_blank" rel="noopener">http://openjdk.java.net/projects/code-tools/jol/</a><br><a href="http://ifeve.com/falsesharing/" target="_blank" rel="noopener">http://ifeve.com/falsesharing/</a><br><a href="http://hg.openjdk.java.net/code-tools/jol/file/tip/jol-samples/src/main/java/org/openjdk/jol/samples/" target="_blank" rel="noopener">http://hg.openjdk.java.net/code-tools/jol/file/tip/jol-samples/src/main/java/org/openjdk/jol/samples/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;ç¼“å­˜ç³»ç»Ÿä¸­æ˜¯ä»¥ç¼“å­˜è¡Œï¼ˆcache lineï¼‰ä¸ºå•ä½å­˜å‚¨çš„ã€‚ç¼“
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Advance" scheme="https://sulangsss.github.io/categories/Java/Advance/"/>
    
      <category term="Memory" scheme="https://sulangsss.github.io/categories/Java/Advance/Memory/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="FalseSharing" scheme="https://sulangsss.github.io/tags/FalseSharing/"/>
    
      <category term="Memory" scheme="https://sulangsss.github.io/tags/Memory/"/>
    
  </entry>
  
  <entry>
    <title>Technology Stack On Testing</title>
    <link href="https://sulangsss.github.io/2019/01/28/Testing/TechStack/"/>
    <id>https://sulangsss.github.io/2019/01/28/Testing/TechStack/</id>
    <published>2019-01-28T02:49:22.000Z</published>
    <updated>2019-03-17T06:16:20.160Z</updated>
    
    <content type="html"><![CDATA[<hr><h3 id="Performance-Metric"><a href="#Performance-Metric" class="headerlink" title="Performance Metric"></a>Performance Metric</h3><h4 id="ä¸šåŠ¡æŒ‡æ ‡"><a href="#ä¸šåŠ¡æŒ‡æ ‡" class="headerlink" title="ä¸šåŠ¡æŒ‡æ ‡"></a>ä¸šåŠ¡æŒ‡æ ‡</h4><ul><li><p>Response Timeï¼šä¸šåŠ¡å“åº”æ—¶é—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸åŒç³»ç»Ÿçš„ä¸šåŠ¡å“åº”æ—¶é—´æœŸæœ›å€¼æ˜¯ä¸åŒçš„ï¼Œï¼‘ç§’ä»¥å†…æœ€ä½³ï¼›</p><ul><li><blockquote><p>å¹³å‡å“åº”æ—¶é—´ï¼šä¸€æ®µæ—¶é—´å†…å“åº”æ—¶é—´çš„å¹³å‡å€¼ã€‚æ— æ³•ä½“ç°å“åº”æ—¶é—´çš„æ³¢åŠ¨æƒ…å†µã€‚</p></blockquote></li><li><blockquote><p>ä¸­é—´å“åº”æ—¶é—´ï¼šä¸€æ®µæ—¶é—´å†…å“åº”æ—¶é—´çš„ä¸­é—´å€¼ï¼Œ50%å“åº”æ—¶é—´ï¼Œæœ‰ä¸€åŠçš„æœåŠ¡å™¨å“åº”æ—¶é—´ä½äºè¯¥å€¼è€Œå¦ä¸€åŠé«˜äºè¯¥å€¼ã€‚</p></blockquote></li><li><blockquote><p>90%å“åº”æ—¶é—´ï¼šä¸€æ®µæ—¶é—´å†…90%çš„äº‹åŠ¡å“åº”æ—¶é—´æ¯”æ­¤æ•°å€¼è¦å°ã€‚ååº”æ€»ä½“å“åº”é€Ÿåº¦ï¼Œå’Œé«˜äºè¯¥å€¼çš„10%è¶…æ—¶ç‡ã€‚æ˜¯ç”¨æ¥è¯„ä¼°ç³»ç»Ÿå®¹é‡çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p></blockquote></li><li><blockquote><p>æœ€å°å“åº”æ—¶é—´ï¼šå“åº”æ—¶é—´çš„æœ€å°å€¼ã€‚åæ˜ æœåŠ¡æœ€å¿«å¤„ç†èƒ½åŠ›ã€‚</p></blockquote></li><li><blockquote><p>æœ€å¤§å“åº”æ—¶é—´ï¼šå“åº”æ—¶é—´çš„æœ€å¤§å€¼ã€‚åæ˜ æœåŠ¡å™¨æœ€æ…¢å¤„ç†èƒ½åŠ›ã€‚</p></blockquote></li></ul></li><li><p>Transaction Per Second(ååé‡)ï¼šä¸šåŠ¡å¤„ç†èƒ½åŠ›ï¼Œè¿™ä¸ªæŒ‡æ ‡æ˜¯è¡¡é‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æŒ‡æ ‡ï¼ŒTPSå¯ä»¥å‚ç…§åŒè¡Œä¸šç³»ç»Ÿå’Œç»“åˆå…·ä½“ä¸šåŠ¡ï¼Œä¸­å°ä¼ä¸šTPSå€¼ä¸º50~1000ç¬”/ç§’ï¼Œé“¶è¡ŒTPSå€¼ä¸º1000~50000ç¬”/ç§’ï¼Œæ·˜å®TPSå€¼ä¸º30000~300000ç¬”/ç§’ã€‚</p><ul><li><blockquote><p>å¹³å‡ååé‡ï¼šä¸€æ®µæ—¶é—´å†…ååé‡çš„å¹³å‡å€¼ã€‚æ— æ³•ä½“ç°ååé‡çš„ç¬é—´å˜åŒ–ã€‚</p></blockquote></li><li><blockquote><p>å³°å€¼ååé‡ï¼šä¸€æ®µæ—¶é—´å†…ååé‡çš„æœ€å¤§å€¼ã€‚æ˜¯ç”¨æ¥è¯„ä¼°ç³»ç»Ÿå®¹é‡çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p></blockquote></li><li><blockquote><p>æœ€ä½ååé‡ï¼šä¸€æ®µæ—¶é—´å†…ååé‡çš„æœ€å°å€¼ã€‚å¦‚æœæœ€å°å€¼æ¥è¿‘0ï¼Œè¯´æ˜ç³»ç»Ÿæœ‰â€œå¡â€çš„ç°è±¡ã€‚</p></blockquote></li><li><blockquote><p>70%çš„ååé‡é›†ä¸­åŒºé—´ï¼šé€šè¿‡ç»Ÿè®¡15%å’Œ85%çš„ååé‡è¾¹ç•Œå€¼ï¼Œè®¡ç®—å‡º70%çš„ååé‡é›†ä¸­åŒºé—´ã€‚åŒºé—´è¶Šé›†ä¸­ï¼Œååé‡è¶Šç¨³å®šã€‚</p></blockquote></li></ul></li><li><p>æˆåŠŸç‡ï¼šè¿™ä¸ªæŒ‡æ ‡æ˜¯è¡¡é‡ç³»ç»Ÿå¤„äºå‹åŠ›ä¸‹ï¼Œä¸šåŠ¡çš„æˆåŠŸç‡ï¼Œä¸€èˆ¬ä¸šç•ŒæˆåŠŸç‡è¦å¤§äº99.6%ã€‚</p></li></ul><hr><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><ul><li>Runningï¼šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚</li><li>Waitingï¼šå·²å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…è¿è¡Œçš„è¿›ç¨‹ã€‚</li><li>Blockedï¼šå› ä¸ºç­‰å¾…æŸäº›äº‹ä»¶å®Œæˆè€Œé˜»å¡çš„è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯åœ¨ç­‰å¾…I/Oï¼Œå¦‚Disk I/Oï¼ŒNetwork I/Oç­‰ã€‚</li></ul><p>è¿™é‡Œçš„Runningå’ŒWaitingå…±åŒæ„æˆLinuxè¿›ç¨‹çŠ¶æ€ä¸­çš„å¯è¿è¡ŒçŠ¶æ€(task_running)ï¼Œè€ŒBlockedçŠ¶æ€å¯ä»¥å¯¹åº”Linuxè¿›ç¨‹çŠ¶æ€ä¸­çš„ä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€(task_uninterruptible)ã€‚</p><p>Linuxå‘½ä»¤<strong>vmstat 1</strong>(1ç§’é‡‡é›†1æ¬¡)å¯ä»¥è¯»å–ç›¸å…³çŠ¶æ€æ•°æ®ï¼Œä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache      si   so    bi    bo   <span class="keyword">in</span>   cs    us  sy  id   wa st</span><br><span class="line"> 2  0     0   142064 374032 1951676    0    0     0     0    351  670    0  0   100   0  0</span><br></pre></td></tr></table></figure><ul><li>usï¼šç”¨æˆ·å ç”¨CPUçš„ç™¾åˆ†æ¯”</li><li>syï¼šç³»ç»Ÿ(å†…æ ¸å’Œä¸­æ–­)å ç”¨CPUçš„ç™¾åˆ†æ¯”</li><li>idï¼šCPUç©ºé—²çš„ç™¾åˆ†æ¯”</li><li>rï¼šè¡¨ç¤ºè¿è¡Œé˜Ÿåˆ—(å°±æ˜¯è¯´å¤šå°‘ä¸ªè¿›ç¨‹çœŸçš„åˆ†é…åˆ°CPU)ï¼Œå½“è¿™ä¸ªå€¼è¶…è¿‡äº†CPUæ•°ç›®ï¼Œå°±ä¼šå‡ºç°CPUç“¶é¢ˆäº†ã€‚</li><li>inï¼šæ¯ç§’CPUçš„ä¸­æ–­æ¬¡æ•°ï¼ŒåŒ…æ‹¬æ—¶é—´ä¸­æ–­ã€‚</li><li>csï¼šç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚</li><li>bï¼šè¡¨ç¤ºé˜»å¡çš„è¿›ç¨‹ã€‚</li><li>siï¼šæ¯ç§’ä»ç£ç›˜è¯»å…¥è™šæ‹Ÿå†…å­˜çš„å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äº0ï¼Œè¡¨ç¤ºç‰©ç†å†…å­˜ä¸å¤Ÿç”¨æˆ–è€…å†…å­˜æ³„éœ²äº†ï¼Œè¦æŸ¥æ‰¾è€—å†…å­˜è¿›ç¨‹è§£å†³æ‰ã€‚</li><li>soï¼šæ¯ç§’è™šæ‹Ÿå†…å­˜å†™å…¥ç£ç›˜çš„å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äº0ï¼ŒåŒä¸Šã€‚</li><li>biï¼šå—è®¾å¤‡æ¯ç§’æ¥æ”¶çš„å—æ•°é‡ï¼Œè¿™é‡Œçš„å—è®¾å¤‡æ˜¯æŒ‡ç³»ç»Ÿä¸Šæ‰€æœ‰çš„ç£ç›˜å’Œå…¶ä»–å—è®¾å¤‡ï¼Œé»˜è®¤å—å¤§å°æ˜¯1024byteã€‚</li><li>boï¼šå—è®¾å¤‡æ¯ç§’å‘é€çš„å—æ•°é‡ï¼Œä¾‹å¦‚æˆ‘ä»¬è¯»å–æ–‡ä»¶ï¼Œboå°±è¦å¤§äº0ã€‚</li><li>wtï¼šç­‰å¾…IO</li></ul><p>æ€§èƒ½æµ‹è¯•æŒ‡æ ‡ä¸­ï¼ŒCPUä½¿ç”¨ç‡é€šå¸¸ç”¨<strong>us + sy</strong>æ¥è®¡ç®—ï¼Œå…¶å¯æ¥å—ä¸Šé™é€šå¸¸åœ¨70%~80%ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœsyçš„å€¼é•¿æœŸå¤§äº25%ï¼Œåº”è¯¥å…³æ³¨in(ç³»ç»Ÿä¸­æ–­)å’Œcs(ä¸Šä¸‹æ–‡åˆ‡æ¢)çš„æ•°å€¼ï¼Œå¹¶æ ¹æ®è¢«æµ‹åº”ç”¨çš„å®ç°é€»è¾‘æ¥åˆ†ææ˜¯å¦åˆç†ã€‚</p><hr><ul><li><p>CPU Utilization Percentages(CPUä½¿ç”¨ç‡)ï¼šæœ‰è¿›ç¨‹å¤„äºRunningçŠ¶æ€çš„æ—¶é—´/æ€»æ—¶é—´ã€‚</p><blockquote><p>åœ¨vmstatä¸»è¦é€šè¿‡usã€syså’Œidä¸‰åˆ—æ•°æ®æ¥ä½“ç°ã€‚</p></blockquote></li><li><p>Processes on run queue(è¿è¡Œé˜Ÿåˆ—è¿›ç¨‹æ•°)ï¼šRunningçŠ¶æ€ + WaitingçŠ¶æ€çš„è¿›ç¨‹æ•°ï¼Œå±•ç¤ºäº†æ­£åœ¨è¿è¡Œå’Œç­‰å¾…CPUèµ„æºçš„ä»»åŠ¡æ•°ï¼Œå¯ä»¥çœ‹ä½œCPUçš„å·¥ä½œæ¸…å•ï¼Œæ˜¯åˆ¤æ–­CPUèµ„æºæ˜¯å¦æˆä¸ºç“¶é¢ˆçš„é‡è¦ä¾æ®ã€‚vmstaté€šè¿‡rçš„å€¼æ¥ä½“ç°ã€‚</p><blockquote><p>å¦‚æœrçš„å€¼ç­‰äºç³»ç»ŸCPUæ€»æ ¸æ•°ï¼Œåˆ™è¯´æ˜CPUå·²ç»æ»¡è´Ÿè·ã€‚åœ¨è´Ÿè½½æµ‹è¯•ä¸­ï¼Œå…¶å¯æ¥å—ä¸Šé™é€šå¸¸ä¸è¶…è¿‡CPUæ ¸æ•°çš„2å€ã€‚</p></blockquote></li><li><p>Context Switches(ä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼šç®€å•æ¥è¯´ï¼ŒcontextæŒ‡CPUå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨åœ¨æŸæ—¶é—´ç‚¹çš„å†…å®¹ï¼Œ(è¿›ç¨‹)ä¸Šä¸‹æ–‡åˆ‡æ¢å³kernelæŒ‚èµ·ä¸€ä¸ªè¿›ç¨‹å¹¶å°†è¯¥è¿›ç¨‹æ­¤æ—¶çš„çŠ¶æ€å­˜å‚¨åˆ°å†…å­˜ï¼Œç„¶åä»å†…å­˜ä¸­æ¢å¤ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„è¿›ç¨‹åŸæ¥çš„çŠ¶æ€åˆ°å¯„å­˜å™¨ï¼Œä»å…¶ä¸Šæ¬¡æš‚åœçš„æ‰§è¡Œä»£ç å¼€å§‹ç»§ç»­æ‰§è¡Œè‡³é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°†å¯¼è‡´syå€¼å¢é•¿ã€‚vmstaté€šè¿‡csçš„å€¼æ¥ä½“ç°</p></li><li><p>Load Average(å¹³å‡è´Ÿè½½)ï¼šåœ¨UNIXç³»ç»Ÿä¸­ï¼ŒLoadæ˜¯å¯¹ç³»ç»Ÿå·¥ä½œé‡çš„åº¦é‡ã€‚Loadå–å€¼æœ‰ä¸¤ç§æƒ…å†µï¼Œå¤šæ•°UNIXç³»ç»Ÿå–è¿è¡Œé˜Ÿåˆ—çš„å€¼(vmstatè¾“å‡ºçš„r)ï¼Œè€ŒLinuxç³»ç»Ÿå–è¿è¡Œé˜Ÿåˆ—çš„å€¼ + å¤„äºtask_uninterruptibleçŠ¶æ€çš„è¿›ç¨‹æ•°(vmstatè¾“å‡ºçš„b)ï¼Œæ‰€ä»¥ä¼šå‡ºç°CPUä½¿ç”¨ç‡ä¸é«˜ä½†Loadå€¼å¾ˆé«˜çš„æƒ…å†µã€‚</p><blockquote><p>Load Averageå°±æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…çš„å¹³å‡è´Ÿè½½ï¼Œç³»ç»Ÿå·¥å…·topã€uptimeç­‰æä¾›1åˆ†é’Ÿã€5åˆ†é’Ÿå’Œ15åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½å€¼ã€‚<br>top - 13:38:38 up 42 days,  3:25,  1 user,  load average: 0.80, 0.60, 0.53<br>å½“éœ€è¦äº†è§£å½“å‰ç³»ç»Ÿè´Ÿè½½æƒ…å†µæ—¶ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹Load averageçš„å€¼ï¼Œå¦‚æœç³»ç»ŸæŒç»­å¤„äºé«˜è´Ÿè½½(å¦‚15åˆ†é’Ÿå¹³å‡è´Ÿè½½å¤§äºCPUæ€»æ ¸æ•°çš„ä¸¤å€)ï¼Œåˆ™æŸ¥çœ‹vmstatçš„rå€¼å’Œbå€¼æ¥ç¡®è®¤æ˜¯CPUè´Ÿè·é‡è¿˜æ˜¯ç­‰å¾…I/Oçš„è¿›ç¨‹å¤ªå¤šã€‚</p></blockquote></li></ul><hr><h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><p>Memoryèµ„æºä¹Ÿæœ‰ä¸‰æ–¹é¢éœ€è¦é‡ç‚¹å…³æ³¨ï¼š<strong>Free Memoryã€Swapå’ŒPaging</strong>ã€‚</p><img src="/2019/01/28/Testing/TechStack/virtual-memory.jpg" title="è¿›ç¨‹çŠ¶æ€"><p>ç‰©ç†å†…å­˜å’Œç¡¬ç›˜ä¸Šçš„ä¸€å—ç©ºé—´(SWAP)ç»„åˆèµ·æ¥ä½œä¸ºè™šæ‹Ÿå†…å­˜(Virtual Memory)ä¸ºè¿›ç¨‹çš„è¿è¡Œæä¾›ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯è¿›ç¨‹å¯ç”¨çš„å†…å­˜å˜å¤§äº†ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSWAPçš„è¯»å†™é€Ÿåº¦è¿œä½äºç‰©ç†å†…å­˜ï¼Œå¹¶ä¸”ç‰©ç†å†…å­˜å’Œswapä¹‹é—´çš„æ•°æ®äº¤æ¢ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ã€‚</p><p>è™šæ‹Ÿå†…å­˜è¢«åˆ†æˆé¡µ(x86ç³»ç»Ÿé»˜è®¤é¡µå¤§å°ä¸º4k)ï¼Œå†…æ ¸è¯»å†™è™šæ‹Ÿå†…å­˜ä»¥é¡µä¸ºå•ä½ï¼Œå½“ç‰©ç†å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œå†…å­˜è°ƒåº¦ä¼šå°†ç‰©ç†å†…å­˜ä¸Šä¸å¸¸ä½¿ç”¨çš„å†…å­˜é¡µæ•°æ®å­˜å‚¨åˆ°ç£ç›˜çš„SWAPç©ºé—´ï¼Œç‰©ç†å†…å­˜ä¸swapç©ºé—´ä¹‹é—´çš„æ•°æ®äº¤æ¢è¿‡ç¨‹ç§°ä¸ºé¡µé¢äº¤æ¢(Paging)ã€‚</p><ul><li><p>Free Memory(å¯ç”¨å†…å­˜)ï¼šå†…å­˜å ç”¨çš„ç›´è§‚æ•°æ®ï¼Œvmstatè¾“å‡ºfreeçš„å€¼ï¼Œå¯ç”¨å†…å­˜è¿‡å°å°†å½±å“æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡ï¼Œå¯¹äºç¨³å®šè¿è¡Œçš„ç³»ç»Ÿï¼Œfreeå¯æ¥å—çš„èŒƒå›´é€šå¸¸åº”è¯¥å¤§äºç‰©ç†å†…å­˜çš„20%ï¼Œå³å†…å­˜å ç”¨åº”è¯¥å°äºç‰©ç†å†…å­˜çš„80%ã€‚åœ¨å‹åŠ›æµ‹è¯•æ—¶ï¼Œç³»ç»Ÿå†…å­˜èµ„æºçš„æƒ…å†µåº”è¯¥ç”¨å¯ç”¨å†…å­˜ç»“åˆé¡µé¢äº¤æ¢æƒ…å†µæ¥åˆ¤æ–­ï¼Œå¦‚æœå¯ä»¥å†…å­˜å¾ˆå°‘ï¼Œä½†é¡µé¢äº¤æ¢ä¹Ÿå¾ˆå°‘ï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸ºå†…å­˜èµ„æºè¿˜å¯¹ç³»ç»Ÿæ€§èƒ½æ„æˆä¸¥é‡å½±å“ã€‚</p></li><li><p>Paging(é¡µé¢äº¤æ¢)ï¼šé¡µé¢äº¤æ¢åŒ…æ‹¬ä»SWAPäº¤æ¢åˆ°å†…å­˜å’Œä»å†…å­˜äº¤æ¢åˆ°SWAPï¼Œå¦‚æœç³»ç»Ÿå‡ºç°é¢‘ç¹çš„é¡µé¢äº¤æ¢ï¼Œéœ€è¦å¼•èµ·æ³¨æ„ã€‚å¯ä»¥ä»vmstatçš„siå’Œsoè·å–ã€‚</p><blockquote><p>siï¼šæ¯ç§’ä»SWAPè¯»å–åˆ°å†…å­˜çš„æ•°æ®å¤§å°ï¼›soï¼šæ¯ç§’ä»å†…å­˜å†™å…¥åˆ°SWAPçš„æ•°æ®å¤§å°ã€‚</p></blockquote></li><li><p>Swapï¼šå¯ä»¥ä»vmstatçš„swpdæ¥è·å–å½“å‰SWAPç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œåº”è¯¥å’Œé¡µé¢äº¤æ¢ç»“åˆæ¥åˆ†æï¼Œæ¯”å¦‚å½“swpdä¸ä¸º0ï¼Œä½†siï¼ŒsoæŒç»­ä¿æŒä¸º0æ—¶ï¼Œå†…å­˜èµ„æºå¹¶æ²¡æœ‰æˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚</p></li></ul><hr><h4 id="Disk"><a href="#Disk" class="headerlink" title="Disk"></a>Disk</h4><p>ç£ç›˜IOåˆ†ä¸ºéšæœºIOå’Œé¡ºåºIOä¸¤ç§ç±»å‹ï¼Œåœ¨æ€§èƒ½æµ‹è¯•ä¸­åº”è¯¥å…ˆäº†è§£è¢«æµ‹ç³»ç»Ÿæ˜¯åå‘å“ªç§ç±»å‹ã€‚</p><ul><li>éšæœºIOï¼šéšæœºè¯»å†™æ•°æ®ï¼Œè¯»å†™è¯·æ±‚å¤šï¼Œæ¯æ¬¡è¯»å†™çš„æ•°æ®é‡è¾ƒå°ï¼Œå…¶IOé€Ÿåº¦æ›´ä¾èµ–äºç£ç›˜æ¯ç§’èƒ½IOæ¬¡æ•°(IOPS)ã€‚</li><li>é¡ºåºIOï¼šé¡ºåºè¯·æ±‚å¤§é‡æ•°æ®ï¼Œè¯»å†™è¯·æ±‚ä¸ªæ•°ç›¸å¯¹è¾ƒå°‘ï¼Œæ¯æ¬¡è¯»å†™çš„æ•°æ®é‡è¾ƒå¤§ï¼Œé¡ºåºIOæ›´é‡è§†æ¯æ¬¡IOçš„æ•°æ®ååé‡ã€‚</li></ul><p>å¯¹äºç£ç›˜ï¼Œé¦–è¦å…³æ³¨ä½¿ç”¨ç‡ï¼ŒIOPSå’Œæ•°æ®ååé‡ï¼Œåœ¨LinuxæœåŠ¡åŒºï¼Œå¯ä»¥ä½¿ç”¨iostatæ¥è·å–è¿™äº›æ•°æ®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iostat -dxk 1</span><br><span class="line"><span class="comment"># -d æ˜¾ç¤ºè®¾å¤‡ï¼ˆç£ç›˜ï¼‰ä½¿ç”¨çŠ¶æ€</span></span><br><span class="line"><span class="comment"># -k æŸäº›ä½¿ç”¨blockä¸ºå•ä½çš„åˆ—å¼ºåˆ¶ä½¿ç”¨Kilobytesä¸ºå•ä½</span></span><br><span class="line"><span class="comment"># 1 è¡¨ç¤ºåˆ·æ–°é—´éš”ä¸º1ç§’</span></span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br></pre></td></tr></table></figure><p><strong>é‡ç‚¹æ€§èƒ½æŒ‡æ ‡</strong></p><ul><li><p>%utilï¼šåœ¨ç»Ÿè®¡æ—¶é—´å†…ï¼Œæ‰€æœ‰å¤„ç†IOæ—¶é—´é™¤ä»¥æ€»å…±ç»Ÿè®¡æ—¶é—´ã€‚</p><blockquote><p>ä¾‹å¦‚å¦‚æœç»Ÿè®¡é—´éš”1ç§’ï¼Œè¯¥è®¾å¤‡æœ‰0.8ç§’åœ¨å¤„ç†IOï¼Œè€Œ0.2ç§’é—²ç½®ï¼Œé‚£ä¹ˆè¯¥è®¾å¤‡çš„%util = 0.8/1 = 80%ï¼Œæ‰€ä»¥è¯¥å‚æ•°æš—ç¤ºäº†è®¾å¤‡çš„ç¹å¿™ç¨‹åº¦ã€‚<br>ä¸€èˆ¬åœ°ï¼Œå¦‚æœè¯¥å‚æ•°æ˜¯100%è¡¨ç¤ºè®¾å¤‡å·²ç»æ¥è¿‘æ»¡è´Ÿè·è¿è¡Œäº†ï¼ˆå½“ç„¶å¦‚æœæ˜¯å¤šç£ç›˜ï¼Œå³ä½¿%utilæ˜¯100%ï¼Œå› ä¸ºç£ç›˜çš„å¹¶å‘èƒ½åŠ›ï¼Œæ‰€ä»¥ç£ç›˜ä½¿ç”¨æœªå¿…å°±åˆ°äº†ç“¶é¢ˆï¼‰ã€‚</p></blockquote></li><li><p>awaitï¼šæ¯ä¸€ä¸ªIOè¯·æ±‚çš„å¤„ç†çš„å¹³å‡æ—¶é—´ï¼ˆå•ä½æ˜¯å¾®ç§’æ¯«ç§’ï¼‰ã€‚è¿™é‡Œå¯ä»¥ç†è§£ä¸ºIOçš„å“åº”æ—¶é—´ï¼Œä¸€èˆ¬åœ°ç³»ç»ŸIOå“åº”æ—¶é—´åº”è¯¥ä½äº5msï¼Œå¦‚æœå¤§äº10mså°±æ¯”è¾ƒå¤§äº†ã€‚</p><blockquote><p>è¿™ä¸ªæ—¶é—´åŒ…æ‹¬äº†é˜Ÿåˆ—æ—¶é—´å’ŒæœåŠ¡æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œawaitå¤§äºsvctmï¼Œå®ƒä»¬çš„å·®å€¼è¶Šå°ï¼Œåˆ™è¯´æ˜é˜Ÿåˆ—æ—¶é—´è¶ŠçŸ­ï¼Œåä¹‹å·®å€¼è¶Šå¤§ï¼Œé˜Ÿåˆ—æ—¶é—´è¶Šé•¿ï¼Œè¯´æ˜ç³»ç»Ÿå‡ºäº†é—®é¢˜ã€‚</p></blockquote></li><li>svctmï¼šè¡¨ç¤ºå¹³å‡æ¯æ¬¡è®¾å¤‡I/Oæ“ä½œçš„æœåŠ¡æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚å¦‚æœsvctmçš„å€¼ä¸awaitå¾ˆæ¥è¿‘ï¼Œè¡¨ç¤ºå‡ ä¹æ²¡æœ‰I/Oç­‰å¾…ï¼Œç£ç›˜æ€§èƒ½å¾ˆå¥½ï¼Œå¦‚æœawaitçš„å€¼è¿œé«˜äºsvctmçš„å€¼ï¼Œåˆ™è¡¨ç¤ºI/Oé˜Ÿåˆ—ç­‰å¾…å¤ªé•¿ï¼Œ       ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºå°†å˜æ…¢ã€‚</li></ul><hr><ul><li>kB_read/sï¼šæ¯ç§’ä»è®¾å¤‡è¯»å–çš„æ•°æ®é‡ï¼›</li><li>kB_wrtn/sï¼šæ¯ç§’å‘è®¾å¤‡å†™å…¥çš„æ•°æ®é‡ï¼›</li><li>kB_readï¼šè¯»å–çš„æ€»æ•°æ®é‡ï¼›</li><li>kB_wrtnï¼šå†™å…¥çš„æ€»æ•°é‡æ•°æ®é‡ï¼›<br>-rrqm/sï¼šæ¯ç§’è¿™ä¸ªè®¾å¤‡ç›¸å…³çš„è¯»å–è¯·æ±‚æœ‰å¤šå°‘è¢«Mergeäº†ï¼ˆå½“ç³»ç»Ÿè°ƒç”¨éœ€è¦è¯»å–æ•°æ®çš„æ—¶å€™ï¼ŒVFSå°†è¯·æ±‚å‘åˆ°å„ä¸ªFSï¼Œå¦‚æœFSå‘ç°ä¸åŒçš„è¯»å–è¯·æ±‚è¯»å–çš„æ˜¯ç›¸åŒBlockçš„æ•°æ®ï¼ŒFSä¼šå°†è¿™ä¸ªè¯·æ±‚åˆå¹¶Mergeï¼‰ï¼›wrqm/sï¼šæ¯ç§’è¿™ä¸ªè®¾å¤‡ç›¸å…³çš„å†™å…¥è¯·æ±‚æœ‰å¤šå°‘è¢«Mergeäº†ã€‚</li><li>rsec/sï¼šæ¯ç§’è¯»å–çš„æ‰‡åŒºæ•°ï¼›</li><li>wsec/ï¼šæ¯ç§’å†™å…¥çš„æ‰‡åŒºæ•°ã€‚</li><li>rKB/sï¼šThe number of read requests that were issued to the device per secondï¼›</li><li>wKB/sï¼šThe number of write requests that were issued to the device per secondï¼›</li><li>avgrq-szï¼šå¹³å‡è¯·æ±‚æ‰‡åŒºçš„å¤§å°</li><li>avgqu-szï¼šæ˜¯å¹³å‡è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ã€‚æ¯«æ— ç–‘é—®ï¼Œé˜Ÿåˆ—é•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚    </li></ul><hr><ul><li><p>IOPSï¼šæ¯ç§’å¤„ç†è¯»/å†™è¯·æ±‚çš„æ•°é‡ï¼Œå³iostatè¾“å‡ºä¸­çš„r/så’Œw/sï¼Œä¸ªäººPCçš„æœºæ¢°ç¡¬ç›˜IOPSä¸€èˆ¬åœ¨100å·¦å³ï¼Œè€Œå„ç§å…¬æœ‰äº‘/ç§æœ‰äº‘çš„æ™®é€šæœåŠ¡å™¨ï¼Œä¹Ÿåªåœ¨ç™¾è¿™ä¸ªæ•°é‡çº§ã€‚</p><blockquote><p>é¢„å…ˆè·å–åˆ°æ‰€ç”¨æœåŠ¡åŒºçš„IOPSèƒ½åŠ›ï¼Œç„¶ååœ¨æ€§èƒ½æµ‹è¯•ä¸­ç›‘æ§è¯•è¯•çš„IOPSæ•°æ®ï¼Œæ¥è¡¡é‡å½“å‰çš„ç£ç›˜æ˜¯å¦èƒ½æ»¡è¶³ç³»ç»Ÿçš„IOéœ€æ±‚ã€‚</p></blockquote></li><li><p>æ•°æ®ååé‡ï¼šæ¯ç§’è¯»/å†™çš„æ•°æ®å¤§å°ï¼Œå³iostatè¾“å‡ºä¸­çš„rkB/så’ŒwkB/sï¼Œé€šå¸¸ç£ç›˜çš„æ•°æ®ååé‡ä¸IOç±»å‹æœ‰ç›´æ¥å…³ç³»ï¼Œé¡ºåºIOçš„ååèƒ½åŠ›æ˜æ˜¾ä¼˜ä¸éšæœºè¯»å†™ï¼Œå¯ä»¥é¢„å…ˆæµ‹å¾—ç£ç›˜åœ¨éšæœºIOå’Œé¡ºåºIOä¸‹çš„ååé‡ï¼Œä»¥ä¾¿äºæµ‹è¯•æ—¶ç›‘æ§åˆ°çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒè¡¡é‡ã€‚</p></li></ul><hr><h4 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h4><p>ç½‘ç»œæœ¬èº«æ˜¯ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸å¤æ‚çš„éƒ¨åˆ†ï¼Œä½†å¸¸è§„çš„æœåŠ¡ç«¯æ€§èƒ½æµ‹è¯•é€šå¸¸æ”¾åœ¨ä¸€ä¸ªå±€åŸŸç½‘è¿›è¡Œï¼Œå› ä¸ºæˆ‘ä»¬é¦–å…ˆå…³æ³¨è¢«æµ‹ç³»ç»Ÿè‡ªèº«çš„æ€§èƒ½è¡¨ç°ï¼Œå¹¶ä¸”éœ€è¦ä¿è¯èƒ½åœ¨è¾ƒå°‘çš„æˆæœ¬ä¸‹å‘èµ·è¶³å¤Ÿå¤§çš„å‹åŠ›ã€‚</p><p>å› æ­¤å¯¹äºå¤šæ•°ç³»ç»Ÿçš„æ€§èƒ½æµ‹è¯•ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨<strong>ç½‘ç»œååé‡</strong>å³å¯ï¼Œå¯¹äºç¨³å®šè¿è¡Œçš„ç³»ç»Ÿï¼Œéœ€è¦ä¸ºè¢«æµ‹åœºæ™¯å¤–çš„ä¸šåŠ¡æµå‡ºè¶³å¤Ÿçš„å¸¦å®½ï¼›åœ¨å‹åŠ›æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ç“¶é¢ˆå¯èƒ½æ¥è‡ªäºå¸¦å®½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptraf -d eth0</span><br></pre></td></tr></table></figure><hr><h3 id="Performance-Tools"><a href="#Performance-Tools" class="headerlink" title="Performance Tools"></a>Performance Tools</h3><ul><li>wrk</li><li>ab</li><li>locust</li><li>Jmeter</li></ul><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://testerhome.com/topics/17068" target="_blank" rel="noopener">https://testerhome.com/topics/17068</a><br><a href="https://zhuanlan.zhihu.com/p/22070862" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22070862</a><br><a href="http://www.aloo.me/2016/08/01/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%B3%E9%94%AE%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E6%B5%85%E6%9E%90/" target="_blank" rel="noopener">http://www.aloo.me/2016/08/01/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%AD%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%B3%E9%94%AE%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E6%B5%85%E6%9E%90/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;h3 id=&quot;Performance-Metric&quot;&gt;&lt;a href=&quot;#Performance-Metric&quot; class=&quot;headerlink&quot; title=&quot;Performance Metric&quot;&gt;&lt;/a&gt;Performance Metric&lt;/h3&gt;&lt;h4 
      
    
    </summary>
    
      <category term="Testing" scheme="https://sulangsss.github.io/categories/Testing/"/>
    
    
      <category term="TechStack" scheme="https://sulangsss.github.io/tags/TechStack/"/>
    
      <category term="Testing" scheme="https://sulangsss.github.io/tags/Testing/"/>
    
  </entry>
  
  <entry>
    <title>Inflation é€šè´§è†¨èƒ€ - æœ€å‰å®³çš„å°å·</title>
    <link href="https://sulangsss.github.io/2019/01/28/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%A1%8C%E4%B8%9A/%E9%87%91%E8%9E%8D/%E9%87%91%E8%9E%8D%E6%80%9D%E7%BB%B4/1.2%20Inflation/"/>
    <id>https://sulangsss.github.io/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2 Inflation/</id>
    <published>2019-01-27T16:24:07.000Z</published>
    <updated>2019-02-02T03:27:04.326Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ</h3><p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯äººä»¬æ‰‹é‡Œçš„èµ„é‡‘è´¬å€¼ï¼Œç‰©ä»·ä¸Šæ¶¨ã€‚</p><img src="/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2%20Inflation/inflation-1.png"><p>è¿™å°±æ˜¯æœ€ç®€å•çš„é€šè´§è†¨èƒ€ï¼š<strong>é’±å˜å¾—ä¸å€¼é’±äº†ã€‚</strong></p><p>æˆ‘ä»¬ä¸ªäººçš„å‘½è¿å’Œè´¢å¯Œä¸å›½å®¶çš„ç»æµæ”¿ç­–å…¶å®æ¯æ¯ç›¸å…³ã€‚åªæœ‰äº†è§£ä¸€ä¸ªå¤§ç¯å¢ƒçš„ç»æµèµ°åŠ¿ï¼Œæ‰èƒ½æ›´å¥½åœ°ä¸ºä¸ªäººè´¢å¯Œä¿å€¼ã€å¢å€¼ã€‚</p><hr><h3 id="é€šè´§è†¨èƒ€æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"><a href="#é€šè´§è†¨èƒ€æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ" class="headerlink" title="é€šè´§è†¨èƒ€æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"></a>é€šè´§è†¨èƒ€æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ</h3><img src="/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2%20Inflation/inflation-2.png"><img src="/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2%20Inflation/inflation-3.png"><hr><h3 id="é€šè´§è†¨èƒ€æ˜¯å¥½è¿˜æ˜¯åï¼Ÿ"><a href="#é€šè´§è†¨èƒ€æ˜¯å¥½è¿˜æ˜¯åï¼Ÿ" class="headerlink" title="é€šè´§è†¨èƒ€æ˜¯å¥½è¿˜æ˜¯åï¼Ÿ"></a>é€šè´§è†¨èƒ€æ˜¯å¥½è¿˜æ˜¯åï¼Ÿ</h3><ul><li>æ¸©å’Œçš„é€šè´§è†¨èƒ€æ˜¯åˆç†çš„ï¼šå½“å¸‚åœºä¸Šçš„é’±å¤šäº†ï¼Œè´§å¸å¢åŠ äº†ï¼Œæ„å‘³ç€æ¶ˆ<strong>è´¹çš„éœ€æ±‚ä¹Ÿå¢åŠ äº†</strong>ã€‚ç›¸åº”çš„<strong>ä¼ä¸šç”Ÿäº§æ´»åŠ¨å’Œå°±ä¸šæœºä¼šä¹Ÿä¼šå¢åŠ </strong>ã€‚</li></ul><hr><h3 id="CPIè¡¡é‡é€šè´§è†¨èƒ€çš„ç¨‹åº¦"><a href="#CPIè¡¡é‡é€šè´§è†¨èƒ€çš„ç¨‹åº¦" class="headerlink" title="CPIè¡¡é‡é€šè´§è†¨èƒ€çš„ç¨‹åº¦"></a>CPIè¡¡é‡é€šè´§è†¨èƒ€çš„ç¨‹åº¦</h3><p>CPIï¼šå±…æ°‘æ¶ˆè´¹ä»·æ ¼æŒ‡æ•°ï¼Œååº”é€šè´§è†¨èƒ€çš„ç¨‹åº¦ã€‚</p><p>æˆ‘å›½CPIç»„æˆç±»åˆ«ï¼š</p><ul><li>é£Ÿå“(34%)</li><li>å¨±ä¹æ•™è‚²æ–‡åŒ–ç”¨å“åŠæœåŠ¡(14%)</li><li>å±…ä½ç±»(13%)</li><li>äº¤é€šé€šè®¯(10%)</li><li>åŒ»ç–—ä¿å¥ä¸ªäººç”¨å“(10%)</li><li>ä¾ç€ç±»(9%)</li><li>å®¶åº­è®¾å¤‡åŠç»´ä¿®æœåŠ¡(6%)</li><li>çƒŸé…’åŠç”¨å“(4%)</li></ul><p>å…¶ä¸­ï¼Œé£Ÿå“æ˜¯æ‰€æœ‰ç±»å•†å“ä¸­æƒé‡æœ€å¤§çš„åˆ†ç±»é¡¹ï¼Œè€ŒçŒªè‚‰åˆæ˜¯é£Ÿå“åˆ†ç±»ä¸­æœ€é‡è¦çš„å­é¡¹ç›®ï¼Œçº¦å CPIæ•´ä½“çš„9%çš„æƒé‡ã€‚</p><p>å½“CPI &gt; 3%çš„å¢å¹…æ—¶ï¼Œæˆ‘ä»¬ç§°ä¸ºé€šè´§è†¨èƒ€ï¼›è€Œå½“CPI &gt; 5%çš„å¢å¹…æ—¶ï¼Œç§°ä¸ºä¸¥é‡çš„é€šè´§è†¨èƒ€ã€‚</p><p>å¤§éƒ¨åˆ†çš„ç»æµå­¦å®¶ä»¬è®¤ä¸º2%~4%çš„é€šè´§è†¨èƒ€ç‡å¯¹ä¸€ä¸ªç»æµä½“æ˜¯æœ‰å¥½å¤„çš„ï¼Œå®ƒå¯ä»¥æœ‰æ•ˆåˆºæ¿€ç»æµå¢é•¿ï¼Œæ‹‰åŠ¨ç¤¾ä¼šçš„éœ€æ±‚ã€‚æ—¢ç„¶æ¸©å’Œçš„é€šè´§è†¨èƒ€æ˜¯ä¸€ä¸ªå¸¸æ€ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ”¿åºœè¿½æ±‚çš„ç»æµæŒ‡æ ‡ï¼Œé‚£ä¹ˆè¿™å°±æ„å‘³ç€å¤§å®¶æ‰‹é‡Œçš„é’±éå¸¸å¤§å‡ ç‡çš„ä»Šåæ¯å¹´éƒ½ä¼šä»¥ä¸€å®šçš„æ¯”ç‡(2%~4%)è´¬å€¼ã€‚</p><hr><h3 id="å¦‚ä½•æˆ˜èƒœé€šè´§è†¨èƒ€"><a href="#å¦‚ä½•æˆ˜èƒœé€šè´§è†¨èƒ€" class="headerlink" title="å¦‚ä½•æˆ˜èƒœé€šè´§è†¨èƒ€"></a>å¦‚ä½•æˆ˜èƒœé€šè´§è†¨èƒ€</h3><img src="/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2%20Inflation/inflation-4.png"><hr><h3 id="å¦‚ä½•åº”å¯¹æ¶æ€§é€šè´§è†¨èƒ€"><a href="#å¦‚ä½•åº”å¯¹æ¶æ€§é€šè´§è†¨èƒ€" class="headerlink" title="å¦‚ä½•åº”å¯¹æ¶æ€§é€šè´§è†¨èƒ€"></a>å¦‚ä½•åº”å¯¹æ¶æ€§é€šè´§è†¨èƒ€</h3><img src="/2019/01/28/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.2%20Inflation/inflation-5.png"><p>å¯¹äºä¸ªäººè€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬æ¯å¹´åªæ˜¯è¾›è‹¦çš„å·¥ä½œï¼Œè¢«åŠ¨çš„å­˜é’±ï¼Œè™½ç„¶è¡¨é¢ä¸Šçœ‹é’±æ²¡åŠ¨ï¼Œä½†æ˜¯å®é™…ä»·å€¼å´é­å—åˆ°äº†å¾ˆå¤§çš„æŸå¤±ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯é€šè´§è†¨èƒ€ï¼Ÿ&lt;/h3&gt;&lt;p&gt;ç®€å•åœ°è¯´ï¼Œå°±æ˜¯äººä»¬æ‰‹é‡Œçš„èµ„é‡‘è´¬å€¼ï¼Œç‰©ä»·ä¸Šæ¶¨ã€‚&lt;/p&gt;
&lt;img src=&quot;/2019/01/
      
    
    </summary>
    
      <category term="Finance" scheme="https://sulangsss.github.io/categories/Finance/"/>
    
    
      <category term="Finance" scheme="https://sulangsss.github.io/tags/Finance/"/>
    
      <category term="é‡‘è" scheme="https://sulangsss.github.io/tags/%E9%87%91%E8%9E%8D/"/>
    
      <category term="é‡‘èæ€ç»´" scheme="https://sulangsss.github.io/tags/%E9%87%91%E8%9E%8D%E6%80%9D%E7%BB%B4/"/>
    
      <category term="é€šè´§è†¨èƒ€" scheme="https://sulangsss.github.io/tags/%E9%80%9A%E8%B4%A7%E8%86%A8%E8%83%80/"/>
    
  </entry>
  
  <entry>
    <title>Leverage æ æ† - æ˜¯å¤©ä½¿è¿˜æ˜¯é­”é¬¼</title>
    <link href="https://sulangsss.github.io/2019/01/27/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%A1%8C%E4%B8%9A/%E9%87%91%E8%9E%8D/%E9%87%91%E8%9E%8D%E6%80%9D%E7%BB%B4/1.1%20Leverage/"/>
    <id>https://sulangsss.github.io/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1 Leverage/</id>
    <published>2019-01-27T15:24:07.000Z</published>
    <updated>2019-02-02T03:27:07.835Z</updated>
    
    <content type="html"><![CDATA[<h3 id="â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-1.png"><p>æ æ†çš„æœ¬è´¨å°±æ˜¯è´Ÿå€ºã€‚é€šè¿‡å‘ä¸ªäººæˆ–æœºæ„å€Ÿé’±ï¼Œç”¨å°‘é‡çš„æœ¬é‡‘æ¥æ’¬åŠ¨æ›´å¤§çš„èµ„äº§ã€‚</p><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-2.png"><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-3.png"><hr><h3 id="æ­£ç¡®çœ‹å¾…æ æ†"><a href="#æ­£ç¡®çœ‹å¾…æ æ†" class="headerlink" title="æ­£ç¡®çœ‹å¾…æ æ†"></a>æ­£ç¡®çœ‹å¾…æ æ†</h3><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-4.png"><p>ç®€å•æ¥çœ‹ï¼Œåªè¦å€Ÿé’±çš„æˆæœ¬ä½äºåˆ›é€ çš„ä»·å€¼ï¼Œå°±æ˜¯ä¸€ç¬”åˆ’ç®—çš„è´Ÿå€ºï¼Œå°±æ˜¯ä¸€ä¸ªå¥½çš„é‡‘èæ æ†ã€‚</p><hr><h3 id="ä¸ºä»€ä¹ˆæˆ¿è´·æ˜¯æœ€ä¾¿å®œçš„æ æ†ä¹‹ä¸€"><a href="#ä¸ºä»€ä¹ˆæˆ¿è´·æ˜¯æœ€ä¾¿å®œçš„æ æ†ä¹‹ä¸€" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ¿è´·æ˜¯æœ€ä¾¿å®œçš„æ æ†ä¹‹ä¸€"></a>ä¸ºä»€ä¹ˆæˆ¿è´·æ˜¯æœ€ä¾¿å®œçš„æ æ†ä¹‹ä¸€</h3><p>è´·æ¬¾ä¹°æˆ¿ï¼Œæ„å‘³ç€ç»™è‡ªå·±çš„èµ„äº§åŠ æ æ†ï¼Œæ’¬åŠ¨æ›´å¤šçš„é’±æ¥è¡ç”Ÿæ›´å¤šçš„è´¢åŠ¡æ€§æ”¶å…¥ã€‚</p><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-5.png"><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-6.png"><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-7.png"><hr><h3 id="ä¸ºä»€ä¹ˆç‚’è‚¡ä¸€å®šä¸è¦ç”¨æ æ†"><a href="#ä¸ºä»€ä¹ˆç‚’è‚¡ä¸€å®šä¸è¦ç”¨æ æ†" class="headerlink" title="ä¸ºä»€ä¹ˆç‚’è‚¡ä¸€å®šä¸è¦ç”¨æ æ†"></a>ä¸ºä»€ä¹ˆç‚’è‚¡ä¸€å®šä¸è¦ç”¨æ æ†</h3><img src="/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Leverage/leverage-8.png"><p>æ”¶ç›Šæ¯”ä¾‹çš„å¢é•¿äº†ï¼Œéšä¹‹è€Œæ¥çš„ï¼Œé£é™©ä¹Ÿæˆæ¯”ä¾‹çš„å¢é•¿ã€‚</p><ul><li>è‚¡å¸‚ä¸­ä½¿ç”¨æ æ†ä¼šæ”¾å¤§æˆ‘ä»¬çš„æ”¶ç›Šæ³¢åŠ¨ã€‚</li><li>æ æ†æœ¬èº«ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ï¼Œå¦‚è´·æ¬¾çš„æ‰‹ç»­è´¹å’ŒæœåŠ¡è´¹ã€‚</li><li>ä»å†å²ç»éªŒå’Œæ•°æ®æ¥çœ‹ï¼Œè‚¡å¸‚æ æ†æœ‰éå¸¸å¤šçš„è¡€æ³ªæ•™è®­ã€‚</li></ul><blockquote><p>å·´è²ç‰¹ä¹Ÿéå¸¸ä¸èµæˆåœ¨è‚¡å¸‚æŠ•èµ„ä¸­ä½¿ç”¨è´¢åŠ¡æ æ†ï¼Œä»–è®¤ä¸ºå€Ÿé’±ç‚’è‚¡æ˜¯ä¸å¯ç†å–»çš„äº‹æƒ…ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;â€œæ æ†â€æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;&lt;img src=&quot;/2019/01/27/è¯»ä¹¦ç¬”è®°/è¡Œä¸š/é‡‘è/é‡‘èæ€ç»´/1.1%20Lever
      
    
    </summary>
    
      <category term="Finance" scheme="https://sulangsss.github.io/categories/Finance/"/>
    
    
      <category term="Finance" scheme="https://sulangsss.github.io/tags/Finance/"/>
    
      <category term="é‡‘è" scheme="https://sulangsss.github.io/tags/%E9%87%91%E8%9E%8D/"/>
    
      <category term="é‡‘èæ€ç»´" scheme="https://sulangsss.github.io/tags/%E9%87%91%E8%9E%8D%E6%80%9D%E7%BB%B4/"/>
    
      <category term="æ æ†" scheme="https://sulangsss.github.io/tags/%E6%9D%A0%E6%9D%86/"/>
    
  </entry>
  
  <entry>
    <title>Vim Configuration</title>
    <link href="https://sulangsss.github.io/2019/01/25/Vim/Configuration/"/>
    <id>https://sulangsss.github.io/2019/01/25/Vim/Configuration/</id>
    <published>2019-01-25T13:01:22.000Z</published>
    <updated>2019-01-26T16:00:48.886Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h4 id="Mac-OS"><a href="#Mac-OS" class="headerlink" title="Mac OS"></a>Mac OS</h4><p>æ–¹æ¡ˆä¸€ï¼š</p><ul><li>brew install vim â€“with-lua â€“with-override-system-vi</li><li>GUIï¼šbrew install macvim â€“with-lua â€“with-override-system-vim</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">==&gt; lua</span><br><span class="line">You may also want luarocks:</span><br><span class="line">  brew install luarocks</span><br><span class="line">==&gt; perl</span><br><span class="line">By default non-brewed cpan modules are installed to the Cellar. If you wish</span><br><span class="line"><span class="keyword">for</span> your modules to persist across updates we recommend using `<span class="built_in">local</span>::lib`.</span><br><span class="line"></span><br><span class="line">You can <span class="built_in">set</span> that up like this:</span><br><span class="line">  PERL_MM_OPT=<span class="string">"INSTALL_BASE=<span class="variable">$HOME</span>/perl5"</span> cpan <span class="built_in">local</span>::lib</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'eval "$(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib=$HOME/perl5)"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line">==&gt; readline</span><br><span class="line">readline is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because macOS provides the BSD libedit library, <span class="built_in">which</span> shadows libreadline.</span><br><span class="line">In order to prevent conflicts when programs look <span class="keyword">for</span> libreadline we are</span><br><span class="line">defaulting this GNU Readline installation to keg-only.</span><br><span class="line"></span><br><span class="line">For compilers to find readline you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/readline/lib"</span></span><br><span class="line">  <span class="built_in">export</span> CPPFLAGS=<span class="string">"-I/usr/local/opt/readline/include"</span></span><br><span class="line"></span><br><span class="line">==&gt; sqlite</span><br><span class="line">sqlite is keg-only, <span class="built_in">which</span> means it was not symlinked into /usr/<span class="built_in">local</span>,</span><br><span class="line">because macOS provides an older sqlite3.</span><br><span class="line"></span><br><span class="line">If you need to have sqlite first <span class="keyword">in</span> your PATH run:</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/sqlite/bin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line">For compilers to find sqlite you may need to <span class="built_in">set</span>:</span><br><span class="line">  <span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/opt/sqlite/lib"</span></span><br><span class="line">  <span class="built_in">export</span> CPPFLAGS=<span class="string">"-I/usr/local/opt/sqlite/include"</span></span><br><span class="line"></span><br><span class="line">==&gt; python</span><br><span class="line">Python has been installed as</span><br><span class="line">  /usr/<span class="built_in">local</span>/bin/python3</span><br><span class="line"></span><br><span class="line">Unversioned symlinks `python`, `python-config`, `pip` etc. pointing to</span><br><span class="line">`python3`, `python3-config`, `pip3` etc., respectively, have been installed into</span><br><span class="line">  /usr/<span class="built_in">local</span>/opt/python/libexec/bin</span><br><span class="line"></span><br><span class="line">If you need Homebrew<span class="string">'s Python 2.7 run</span></span><br><span class="line"><span class="string">  brew install python@2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can install Python packages with</span></span><br><span class="line"><span class="string">  pip3 install &lt;package&gt;</span></span><br><span class="line"><span class="string">They will install into the site-package directory</span></span><br><span class="line"><span class="string">  /usr/local/lib/python3.7/site-packages</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">See: https://docs.brew.sh/Homebrew-and-Python</span></span><br><span class="line"><span class="string">==&gt; ruby</span></span><br><span class="line"><span class="string">By default, binaries installed by gem will be placed into:</span></span><br><span class="line"><span class="string">  /usr/local/lib/ruby/gems/2.6.0/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You may want to add this to your PATH.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ruby is keg-only, which means it was not symlinked into /usr/local,</span></span><br><span class="line"><span class="string">because macOS already provides this software and installing another version in</span></span><br><span class="line"><span class="string">parallel can cause all kinds of trouble.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If you need to have ruby first in your PATH run:</span></span><br><span class="line"><span class="string">  echo '</span><span class="built_in">export</span> PATH=<span class="string">"/usr/local/opt/ruby/bin:<span class="variable">$PATH</span>"</span><span class="string">' &gt;&gt; ~/.zshrc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For compilers to find ruby you may need to set:</span></span><br><span class="line"><span class="string">  export LDFLAGS="-L/usr/local/opt/ruby/lib"</span></span><br><span class="line"><span class="string">  export CPPFLAGS="-I/usr/local/opt/ruby/include"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Install&quot;&gt;&lt;a href=&quot;#Install&quot; class=&quot;headerlink&quot; title=&quot;Install&quot;&gt;&lt;/a&gt;Install&lt;/h3&gt;&lt;h4 id=&quot;Mac-OS&quot;&gt;&lt;a href=&quot;#Mac-OS&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
      <category term="Vim" scheme="https://sulangsss.github.io/categories/Vim/"/>
    
    
      <category term="Vim" scheme="https://sulangsss.github.io/tags/Vim/"/>
    
      <category term="Configuration" scheme="https://sulangsss.github.io/tags/Configuration/"/>
    
  </entry>
  
  <entry>
    <title>é‡æ”¾æ”»å‡» Replay Attack</title>
    <link href="https://sulangsss.github.io/2019/01/25/Security/Web/Replay-Attack/"/>
    <id>https://sulangsss.github.io/2019/01/25/Security/Web/Replay-Attack/</id>
    <published>2019-01-25T05:05:06.000Z</published>
    <updated>2019-01-25T13:27:54.748Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><img src="/2019/01/25/Security/Web/Replay-Attack/Replay_attack_on_hash.svg.png"><p>é‡æ”¾æ”»å‡»(Replay attackï¼Œæˆ–é‡é€æ”»å‡»)æ˜¯ä¸€ç§ç½‘ç»œæ”»å‡»ï¼ŒæŒ‡æ”»å‡»è€…å‘é€ä¸€ä¸ªç›®çš„ä¸»æœºå·²æ¥æ”¶è¿‡çš„åŒ…ï¼Œæ¥è¾¾åˆ°æ¬ºéª—ç³»ç»Ÿçš„ç›®çš„ï¼Œä¸»è¦ç”¨äºèº«ä»½è®¤è¯è¿‡ç¨‹ï¼Œç ´åè®¤è¯çš„æ­£ç¡®æ€§ã€‚</p><p>è¿™ç§æ”»å‡»ä¼šä¸æ–­æ¶æ„æˆ–æ¬ºè¯ˆæ€§åœ°é‡å¤ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®ä¼ è¾“ï¼Œé‡æ”¾æ”»å‡»å¯ä»¥ç”±å‘èµ·è€…ï¼Œä¹Ÿå¯ä»¥ç”±æ‹¦æˆªå¹¶é‡å‘è¯¥æ•°æ®çš„æ•Œæ–¹è¿›è¡Œã€‚æ”»å‡»è€…åˆ©ç”¨ç½‘ç»œç›‘å¬æˆ–è€…å…¶ä»–æ–¹å¼ç›—å–è®¤è¯å‡­æ®ï¼Œä¹‹åå†æŠŠå®ƒé‡æ–°å‘ç»™è®¤è¯æœåŠ¡å™¨ã€‚ä»è¿™ä¸ªè§£é‡Šä¸Šç†è§£ï¼ŒåŠ å¯†å¯ä»¥æœ‰æ•ˆé˜²æ­¢ä¼šè¯åŠ«æŒï¼Œä½†æ˜¯å´é˜²æ­¢ä¸äº†é‡æ”¾æ”»å‡»ã€‚é‡æ”¾æ”»å‡»ä»»ä½•ç½‘ç»œé€šè®¯è¿‡ç¨‹ä¸­éƒ½å¯èƒ½å‘ç”Ÿã€‚</p><hr><h3 id="How-to-defend-against-it"><a href="#How-to-defend-against-it" class="headerlink" title="How to defend against it"></a>How to defend against it</h3><h4 id="æ—¶é—´æˆ³"><a href="#æ—¶é—´æˆ³" class="headerlink" title="æ—¶é—´æˆ³"></a>æ—¶é—´æˆ³</h4><p>é¦–å…ˆæˆ‘ä»¬è®¤ä¸ºä¸€æ¬¡HTTPè¯·æ±‚ä»å‘å‡ºåˆ°åˆ°è¾¾æœåŠ¡å™¨çš„æ—¶é—´æ˜¯ä¸ä¼šè¶…è¿‡60sçš„ï¼Œå½“ä½ å‘é€ä¸€ä¸ªè¯·æ±‚æ—¶å¿…é¡»æºå¸¦ä¸€ä¸ªæ—¶é—´æˆ³timestampã€‚å‡è®¾å€¼ä¸º10ï¼Œå½“è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå–å‡ºå½“å‰æ—¶é—´ï¼Œå‡è®¾ä¸ºt2=80,å¾ˆæ˜æ˜¾t2 - timestamp &gt; 60sï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±è®¤ä¸ºè¯·æ±‚ä¸åˆæ³•ã€‚</p><blockquote><p>å‘é€çš„æ•°æ®å¿…é¡»å¸¦ä¸Šsign(æ¯”å¦‚ï¼ŒMD5ç­¾åç”Ÿæˆçš„)ï¼Œé¿å…æ•°æ®è¢«ç¯¡æ”¹ã€‚</p></blockquote><p>å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå¦‚æœé»‘å®¢åœ¨60så†…å‘èµ·æ”»å‡»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŸæ‰‹æ— ç­–äº†ã€‚é‚£æ˜¯ä¸æ˜¯ç¼©å°æ—¶é—´èŒƒå›´å°±å¯ä»¥è§£å†³äº†ï¼Ÿ</p><h4 id="æ—¶é—´æˆ³-éšæœºæ•°nonce"><a href="#æ—¶é—´æˆ³-éšæœºæ•°nonce" class="headerlink" title="æ—¶é—´æˆ³ + éšæœºæ•°nonce"></a>æ—¶é—´æˆ³ + éšæœºæ•°nonce</h4><p>ä¸ºäº†é¿å…ä¸Šé¢æ—¶é—´æˆ³çš„é—®é¢˜ï¼Œå¯ä»¥åŠ å…¥ä¸€ä¸ªéšæœºæ•°nonceï¼Œæ¯æ¬¡æˆåŠŸè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šä¿å­˜å½“å‰æˆåŠŸè¯·æ±‚çš„éšæœºæ•°nonceï¼Œæ¯”å¦‚å­˜æ”¾åœ¨rediså’Œæ•°æ®åº“ä¸­ï¼Œå½“è¯·æ±‚å†æ¬¡è¿›åˆ°æœåŠ¡å™¨ï¼Œå…ˆéªŒè¯æ—¶é—´æˆ³æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆï¼Œå†åˆ¤æ–­æºå¸¦çš„éšæœºæ•°nonceæ˜¯å¦åœ¨ç¼“å­˜æˆ–è€…æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚éæ³•ã€‚</p><p>ä½†ä½ ä¼šå‘ç°ï¼Œå¦‚æœç³»ç»Ÿè¯·æ±‚éå¸¸å¤šï¼Œè¿™ä¸ªå­˜æ”¾nonceçš„redisæˆ–è€…æ•°æ®åº“åŠ¿å¿…ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿å­˜æœåŠ¡å™¨å½“å‰æ—¶é—´60ç§’å†…çš„nonceå€¼å³å¯ã€‚</p><blockquote><p>å‰ææ¡ä»¶ï¼šä¿è¯éšæœºæ•°nonceç»å¯¹å”¯ä¸€ã€‚</p></blockquote><h4 id="åºå·"><a href="#åºå·" class="headerlink" title="åºå·"></a>åºå·</h4><p>é€šä¿¡åŒæ–¹å¿…é¡»äº‹å…ˆåå•†ä¸€ä¸ªåˆå§‹åºåˆ—å·ï¼Œå¹¶åå•†é€’å¢æ–¹æ³•ã€‚ç„¶ååŒæ–¹é€šè¿‡æ¶ˆæ¯ä¸­çš„åºåˆ—å·æ¥åˆ¤æ–­æ¶ˆæ¯çš„æ–°é²œæ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœnonce=1000å·²ç»è¯·æ±‚è¿‡äº†ï¼Œé‚£ä¹ˆnonce&lt;1000çš„è¯·æ±‚éƒ½æ˜¯æ— æ•ˆè¯·æ±‚ã€‚</p><blockquote><p>A single account may have multiple API keys provisioned. In this document, weâ€™ll refer to these as â€œsessionsâ€. All orders will be recorded with the session that created them. The nonce associated with a request needs to be increasing with respect to the session that the nonce is used on.<br>This allows multithreaded or distributed trading systems to place orders independently of each other, without needing to synchronize clocks to avoid race conditions.<br>In addition, some operations (such as Cancel All Session Orders) act on the orders associated with a specific session.</p></blockquote><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiKey = <span class="string">'&lt;Your API key here&gt;'</span></span><br><span class="line"><span class="keyword">const</span> apiSecret = <span class="string">'&lt;Your API secret here&gt;'</span></span><br><span class="line"><span class="keyword">const</span> baseUrl = <span class="string">'https://api.xxx.com'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'/v1/account'</span></span><br><span class="line"><span class="keyword">const</span> nonce = <span class="built_in">Date</span>.now().toString()</span><br><span class="line"><span class="keyword">const</span> completeURL = baseUrl + url</span><br><span class="line"><span class="keyword">const</span> body = &#123;</span><br><span class="line">  request: url,</span><br><span class="line">  nonce</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> payload = <span class="keyword">new</span> Buffer(<span class="built_in">JSON</span>.stringify(body))</span><br><span class="line">.toString(<span class="string">'base64'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> signature = crypto</span><br><span class="line">  .createHmac(<span class="string">'sha384'</span>, apiSecret)</span><br><span class="line">  .update(payload)</span><br><span class="line">  .digest(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  url: completeURL,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">'X-APIKEY'</span>: apiKey,</span><br><span class="line">    <span class="string">'X-PAYLOAD'</span>: payload,</span><br><span class="line">    <span class="string">'X-SIGNATURE'</span>: signature</span><br><span class="line">  &#125;,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> request.post(</span><br><span class="line">  options,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'response:'</span>, <span class="built_in">JSON</span>.stringify(body, <span class="number">0</span>, <span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://blog.csdn.net/heluan123132/article/details/74375304" target="_blank" rel="noopener">https://blog.csdn.net/heluan123132/article/details/74375304</a><br><a href="https://juejin.im/post/5ad43b86f265da239236cedc" target="_blank" rel="noopener">https://juejin.im/post/5ad43b86f265da239236cedc</a><br><a href="https://docs.gemini.com/rest-api/#private-api-invocation" target="_blank" rel="noopener">https://docs.gemini.com/rest-api/#private-api-invocation</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;img src=&quot;/2019/01/25/Security/We
      
    
    </summary>
    
      <category term="Security" scheme="https://sulangsss.github.io/categories/Security/"/>
    
      <category term="Web" scheme="https://sulangsss.github.io/categories/Security/Web/"/>
    
    
      <category term="Security" scheme="https://sulangsss.github.io/tags/Security/"/>
    
      <category term="Replay Attach" scheme="https://sulangsss.github.io/tags/Replay-Attach/"/>
    
      <category term="Web" scheme="https://sulangsss.github.io/tags/Web/"/>
    
      <category term="é‡æ”¾å…±è®¡" scheme="https://sulangsss.github.io/tags/%E9%87%8D%E6%94%BE%E5%85%B1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜é›…å¤„ç†å¼‚å¸¸</title>
    <link href="https://sulangsss.github.io/2019/01/20/SpringBoot/Exception/HandleException/"/>
    <id>https://sulangsss.github.io/2019/01/20/SpringBoot/Exception/HandleException/</id>
    <published>2019-01-20T15:13:06.000Z</published>
    <updated>2019-02-13T03:45:04.517Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>æˆ‘ä»¬å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿ,æˆ–è€…æ˜¯äº§å“,å¸¸å¸¸é¢ä¸´ç€è¿™æ ·çš„é—®é¢˜ï¼š</p><ul><li>ç³»ç»Ÿè¿è¡Œå‡ºé”™,ä½†æ˜¯å®Œå…¨ä¸çŸ¥é“é”™è¯¯å‘ç”Ÿçš„ä½ç½®ï¼›</li><li>æˆ‘ä»¬æ‰¾åˆ°äº†é”™è¯¯çš„ä½ç½®,ä½†æ˜¯å®Œå…¨ä¸çŸ¥é“æ˜¯å› ä¸ºä»€ä¹ˆï¼›</li><li>ç³»ç»Ÿæ˜æ˜å‡ºäº†é”™è¯¯,ä½†æ˜¯å°±æ˜¯çœ‹ä¸åˆ°é”™è¯¯å †æ ˆä¿¡æ¯ã€‚</li></ul><h4 id="ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šå¼‚å¸¸ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šå¼‚å¸¸ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šå¼‚å¸¸ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šå¼‚å¸¸ï¼Ÿ</h4><p>ç»å¸¸çœ‹åˆ°ä¸€äº›é¡¹ç›®ï¼Œåœ¨å…¨å±€å®šä¹‰ä¸€ä¸ª AppExceptionï¼Œç„¶åæ‰€æœ‰åœ°æ–¹éƒ½åªæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸”æŠŠæ•è·çš„å¼‚å¸¸caseåˆ°è¿™ä¸ªAppExceptionä¸­ã€‚</p><p>è¿™æ ·åšä¼šæœ‰å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>æµªè´¹logæ—¥å¿—å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”æ ˆé¡¶å¹¶ä¸æ˜¯æœ€æ¥è¿‘å‘ç”Ÿå¼‚å¸¸çš„ä»£ç ä½ç½®ï¼›</li><li>åªæœ‰ä¸€ç§å¼‚å¸¸ç±»ï¼Œæ— æ³•ç²¾å‡†åŒºåˆ†å¼€å¼‚å¸¸ç±»å‹ï¼›</li><li>å¼‚å¸¸ç±»åæœŸéš¾ä»¥ä¿®æ”¹ä»¥å¢åŠ å…¶æºå¸¦çš„ä¿¡æ¯ã€‚</li></ul><h4 id="ä»€ä¹ˆæƒ…å†µéœ€è¦æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µéœ€è¦æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µéœ€è¦æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µéœ€è¦æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Ÿ</h4><ul><li>ä½ æœ‰èƒ½åŠ›å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”ä½ çŸ¥é“å¦‚ä½•å¤„ç†ï¼›</li><li>ä½ æœ‰è´£ä»»å¤„ç†å¼‚å¸¸ã€‚</li></ul><hr><h3 id="å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸"><a href="#å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸" class="headerlink" title="å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸"></a>å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸</h3><p>é¦–å…ˆï¼Œæœ‰ä¸€ç‚¹æˆ‘ä»¬è¦æ¸…æ¥šï¼šMVCè®¾è®¡æ¨¡å¼å‘Šè¯‰æˆ‘ä»¬ï¼ŒControlleræ˜¯ç”¨æ¥æ¥æ”¶é¡µé¢å‚æ•°ï¼Œå¹¶ä¸”è°ƒç”¨é€»è¾‘å¤„ç†ï¼Œæœ€åç»„ç»‡é¡µé¢å“åº”çš„åœ°æ–¹ã€‚ä¸å»ºè®®åœ¨Controllerè¿›è¡Œé€»è¾‘å¤„ç†ï¼ŒControlleråªåº”è¯¥è´Ÿè´£ç”¨æˆ·APIå…¥å£å’Œå“åº”çš„å¤„ç†ã€‚</p><blockquote><p>æ€è€ƒä¸€ä¸‹å¦‚æœæœ‰ä¸€å¤©Serviceçš„ä»£ç æ‰“åŒ…æˆjaræ”¾åˆ°å¦ä¸€ä¸ªå¹³å°ï¼Œæ²¡æœ‰controlleräº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p></blockquote><h4 id="å®šä¹‰Serviceå¼‚å¸¸"><a href="#å®šä¹‰Serviceå¼‚å¸¸" class="headerlink" title="å®šä¹‰Serviceå¼‚å¸¸"></a>å®šä¹‰Serviceå¼‚å¸¸</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseExp</span></span>(<span class="keyword">val</span> code: <span class="built_in">Int</span>, error: String) : RuntimeException(error)&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceExp</span></span>(code: <span class="built_in">Int</span>, message: String) : BaseExp(code, message) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¼‚å¸¸ç»§æ‰¿è‡ªRuntimeExceptionï¼Œå¹¶ä¸”åŒ…å«ä¸€ä¸ªæ¥å—ä¸€ä¸ªé”™è¯¯åŸå› çš„æ„é€ å™¨ï¼Œè¿™æ ·Controllerå±‚ä¹Ÿä¸éœ€è¦çŸ¥é“å¼‚å¸¸ï¼Œåªè¦å…¨å±€æ•è·åˆ°ServiceExpåšç»Ÿä¸€çš„å¤„ç†å³å¯ã€‚</p><p>è¿™æ— è®ºæ˜¯åœ¨Struct1ã€2æ—¶ä»£ï¼Œè¿˜æ˜¯SpringMVCä¸­ï¼Œç”šè‡³Servletå¹´ä»£ï¼Œéƒ½æ˜¯æä¸ºå®¹æ˜“çš„ã€‚</p><p>æ­¤å¤–ï¼Œå¼‚å¸¸ä¸èƒ½æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œå› ä¸ºç»å¯¹ä¸å…è®¸ä½ æŠ›å‡ºä¸€ä¸ªé€»è¾‘å¤„ç†å¼‚å¸¸ï¼Œä½†æ˜¯ä¸æŒ‡æ˜åŸå› ã€‚</p><hr><h4 id="Controllerå¤„ç†ä¸¾ä¾‹"><a href="#Controllerå¤„ç†ä¸¾ä¾‹" class="headerlink" title="Controllerå¤„ç†ä¸¾ä¾‹"></a>Controllerå¤„ç†ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> userID ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> user ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯è¡¨å•æ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PutMapping</span>(<span class="string">"&#123;userID&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> JSONResult <span class="title">updateUser</span><span class="params">(@PathVariable(<span class="string">"userID"</span>)</span> Integer userID, @RequestBody UpdateUserForm userForm) </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(); <span class="comment">//å‡†å¤‡ä¸šåŠ¡é€»è¾‘å±‚ä½¿ç”¨çš„é¢†åŸŸæ¨¡å‹</span></span><br><span class="line">    BeanUtils.copyProperties(userForm, user); <span class="comment">//æ‹·è´è¦ä¿®æ”¹çš„å€¼</span></span><br><span class="line">    user.setUserId(userID); <span class="comment">//è®¾ç½®ä¸»é”®åˆ°ç”¨æˆ·æ•°æ®ä¸­</span></span><br><span class="line">    userService.updateUser(user); <span class="comment">//è°ƒç”¨æ›´æ–°ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    JSONResult json = <span class="keyword">new</span> JSONResult(); <span class="comment">//å‡†å¤‡è¦å“åº”çš„æ•°æ®</span></span><br><span class="line">    json.put(<span class="string">"user"</span>, user); <span class="comment">//æŠŠä¿®æ”¹åçš„ç”¨æˆ·æ•°æ®è¿˜ç»™é¡µé¢</span></span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®æ ¡éªŒä¸€èˆ¬åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</strong></p><ul><li>æœ‰æ•ˆæ€§ï¼šæ¯”å¦‚ç”¨æˆ·æ‰€åœ¨å²—ä½ï¼Œæ˜¯å¦å±äºæ•°æ®åº“æœ‰è®°å½•çš„å²—ä½IDï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ— æ•ˆã€‚</li><li>åˆæ³•æ€§ï¼šæ¯”å¦‚ç”¨æˆ·ååªå…è®¸è¾“å…¥æœ€å¤š12ä¸ªå­—ç¬¦ï¼Œç”¨æˆ·æäº¤äº†20ä¸ªå­—ç¬¦ï¼Œä¸åˆæ³•ã€‚å»ºè®®ä½¿ç”¨æ ¡éªŒæ¡†æ¶ï¼Œæ¯”å¦‚JSR303</li></ul><p><strong>å‡å¦‚å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼Œå¦‚ä½•é€šçŸ¥ç”¨æˆ·ï¼Ÿ</strong></p><ul><li>è¦ä¿®æ”¹çš„ç”¨æˆ·IDä¸å­˜åœ¨ï¼›</li><li>ç”¨æˆ·è¢«é”å®šï¼Œä¸å…è®¸ä¿®æ”¹ï¼›</li><li>ä¹è§‚é”æœºåˆ¶å‘ç°ç”¨æˆ·å·²ç»è¢«è¢«äººä¿®æ”¹è¿‡ç­‰ç­‰ã€‚</li></ul><p>å¸¸è§çš„å¤„ç†æ–¹å¼æœ‰ï¼š</p><ol><li>åœ¨Controllerè°ƒç”¨UserServiceçš„checkUserExist()æ–¹æ³•ï¼›</li><li>åœ¨Controllerç›´æ¥ä¹¦å†™ä¸šåŠ¡é€»è¾‘ï¼›</li><li>åœ¨Serviceå“åº”ä¸€ä¸ªçŠ¶æ€ç æœºåˆ¶ï¼Œæ¯”å¦‚1 2 3è¡¨ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œ0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚</li></ol><p>æ ¹æ®MVCè®¾è®¡æ¨¡å¼æ¥è¯´ï¼Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§éƒ½ä¸è€ƒè™‘ã€‚è€Œç¬¬ä¸‰ç§ä¼¼ä¹æ˜¯ä¸€ç§å¯é€‰çš„æ–¹å¼ï¼Œå¯æ˜¯å¦‚æ­¤ä¸€æ¥ï¼Œç”¨æˆ·ä¿å­˜é€»è¾‘å˜äº†ï¼Œæ¯”å¦‚å¢åŠ ä¸€ä¸ªæƒ…å†µï¼Œä¸å…è®¸ä¿®æ”¹å·²ç»ç¦»èŒçš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹Controllerçš„ä»£ç ï¼Œä»£ç é‡å¢åŠ ï¼Œç»´æŠ¤æˆæœ¬å¢é«˜ï¼Œå¹¶ä¸”è¿˜è€¦åˆäº†Serviceï¼Œä¸ç¬¦åˆMVCè®¾è®¡æ¨¡å¼ã€‚</p><hr><h4 id="Serviceå¤„ç†ä¸¾ä¾‹"><a href="#Serviceå¤„ç†ä¸¾ä¾‹" class="headerlink" title="Serviceå¤„ç†ä¸¾ä¾‹"></a>Serviceå¤„ç†ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> user è¦ä¿®æ”¹çš„ç”¨æˆ·æ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    User userOrig = userDao.getUserById(user.getUserID());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == userOrig) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceExp(<span class="string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (userOrig.isLocked()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceExp(<span class="string">"ç”¨æˆ·è¢«é”å®š,ä¸å…è®¸ä¿®æ”¹"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!user.getVersion().equals(userOrig.getVersion())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceExp(<span class="string">"ç”¨æˆ·å·²ç»è¢«åˆ«äººä¿®æ”¹è¿‡,è¯·åˆ·æ–°é‡è¯•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// TODO ä¿å­˜ç”¨æˆ·æ•°æ®  ... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬æ£€æŸ¥åˆ°ä¸å…è®¸ä¿å­˜çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥throwä¸€ä¸ªæ–°çš„å¼‚å¸¸ï¼Œå¼‚å¸¸æœºåˆ¶ä¼šå¸®åŠ©æˆ‘ä»¬ä¸­æ–­ä»£ç æ‰§è¡Œã€‚</p><p>Serviceä¸Šå±‚å¤„ç†å¼‚å¸¸çš„æ–¹å¼æœ‰ï¼š</p><ol><li>åœ¨Controllerä½¿ç”¨try-catchè¿›è¡Œå¤„ç†ï¼›</li><li>ç›´æ¥æŠŠå¼‚å¸¸æŠ›ç»™ä¸Šå±‚æ¡†æ¶ç»Ÿä¸€å¤„ç†ã€‚</li></ol><p>ç¬¬ä¸€ç§æ–¹å¼ç›´æ¥passæ‰ï¼Œæ³¨æ„æˆ‘ä»¬æŠ›å‡ºçš„ServiceExpï¼Œå®ƒä»…ä»…é€»è¾‘å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ–¹æ³•å‰é¢ä¹Ÿæ²¡æœ‰å£°æ˜throws ServiceExpï¼Œè¿™è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªéå—æŸ¥å¼‚å¸¸ã€‚</p><p><strong>Qï¼šä¸ºä»€ä¹ˆä¸å®šä¹‰æˆå—æŸ¥å¼‚å¸¸ï¼Ÿ</strong> å¦‚æœæ˜¯ä¸€ä¸ªå—æŸ¥å¼‚å¸¸ï¼Œé‚£ä¹ˆæ„å‘³ç€Controllerå¿…é¡»è¦å¤„ç†ä½ çš„å¼‚å¸¸ã€‚å¹¶ä¸”å¦‚æœæœ‰ä¸€å¤©ä½ çš„ä¸šåŠ¡é€»è¾‘å˜äº†ï¼Œå¯èƒ½å¤šä¸€ç§æ£€æŸ¥é¡¹ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ªå¼‚å¸¸ã€‚åä¹‹éœ€è¦åˆ é™¤ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆä½ çš„æ–¹æ³•ç­¾åä¹Ÿéœ€è¦æ”¹å˜ï¼ŒControllerä¹Ÿéšä¹‹è¦æ”¹å˜ï¼Œè¿™åˆå˜æˆäº†ç´§è€¦åˆã€‚</p><p><strong>Qï¼šå¯ä»¥ä¸ºæ¯ä¸€ç§æ£€æŸ¥é¡¹å®šä¹‰ä¸€ä¸ªå¼‚å¸¸å—ï¼Ÿ</strong>å¯ä»¥ï¼Œä½†æ˜¯é‚£æ ·æ˜¾å¾—å¤ªå¤šä½™äº†ã€‚å› ä¸ºä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥çš„æ—¶å€™ï¼Œæ ¹æ®æˆ‘ä»¬éœ€æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦é€šçŸ¥ç”¨æˆ·å¤±è´¥çš„åŸå› (é€šå¸¸åº”è¯¥æ˜¯ä¸€æ®µå­—ç¬¦ä¸²)ï¼Œä»¥åŠæœåŠ¡å™¨å—ç†å¤±è´¥çš„ä¸€ä¸ªçŠ¶æ€ç ï¼Œè¿™æ ·è¿™éœ€è¦ä¸€ä¸ªåŒ…å«åŸå› å±æ€§çš„å¼‚å¸¸å³å¯æ»¡è¶³æˆ‘ä»¬éœ€æ±‚ã€‚</p><hr><h4 id="ControllerAdviceå¤„ç†ä¸¾ä¾‹"><a href="#ControllerAdviceå¤„ç†ä¸¾ä¾‹" class="headerlink" title="ControllerAdviceå¤„ç†ä¸¾ä¾‹"></a>ControllerAdviceå¤„ç†ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span>(basePackages = &#123; <span class="string">"com.xxx.bussiness.xxx"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleControllerAdvice</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ModuleControllerAdvice.class);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger SERVICE_LOGGER = LoggerFactory.getLogger(ServiceExp.class);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸šåŠ¡å—ç†å¤±è´¥</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(ServiceExp.class)</span><br><span class="line">  <span class="function"><span class="keyword">private</span> JSONResult <span class="title">handleServiceException</span><span class="params">(ServiceExp exception)</span> </span>&#123;</span><br><span class="line">    String message = <span class="string">"ä¸šåŠ¡å—ç†å¤±è´¥,åŸå› :"</span> + exception.getLocalizedMessage();</span><br><span class="line">    SERVICE_LOGGER.info(message);</span><br><span class="line">    JSONResult json = <span class="keyword">new</span> JSONResult();</span><br><span class="line">    json.serCode(<span class="number">500001</span>);</span><br><span class="line">    json.setMessage(message); </span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†2ä¸ªlogå¯¹è±¡ï¼Œåˆ†åˆ«æŒ‡å‘ServiceExp.class å’Œ ControllerAdvice.classï¼Œå¤„ç†ServiceExpçš„æ—¶å€™ä½¿ç”¨äº†infoçº§åˆ«çš„æ—¥å¿—è¾“å‡ºã€‚</p><ul><li>ServiceExpä¸€å®šè¦å’Œå…¶ä»–çš„ä»£ç é”™è¯¯åˆ†ç¦»ï¼Œä¸åº”è¯¥æ··ä¸ºä¸€è°ˆã€‚</li><li>ServiceExpå¹¶ä¸ä¸€å®šè¦è®°å½•æ—¥å¿—ï¼Œæˆ‘ä»¬åº”è¯¥æä¾›ç‹¬ç«‹çš„logå¯¹è±¡ï¼Œæ–¹ä¾¿å¼€å…³ã€‚</li></ul><hr><h3 id="å¼‚å¸¸åˆ†ç±»å»ºè®®"><a href="#å¼‚å¸¸åˆ†ç±»å»ºè®®" class="headerlink" title="å¼‚å¸¸åˆ†ç±»å»ºè®®"></a>å¼‚å¸¸åˆ†ç±»å»ºè®®</h3><ul><li>é€»è¾‘å¼‚å¸¸ç±»ï¼šç”¨äºæè¿°ä¸šåŠ¡æ— æ³•æŒ‰ç…§é¢„æœŸçš„æƒ…å†µå¤„ç†ä¸‹å»ï¼Œå±äºç”¨æˆ·åˆ¶é€ çš„æ„å¤–ã€‚</li><li>ä»£ç é”™è¯¯ç±»ï¼šè¿™ç±»å¼‚å¸¸ç”¨äºæè¿°å¼€å‘çš„ä»£ç é”™è¯¯ï¼Œä¾‹å¦‚NPEã€ILLARGç­‰éƒ½å±äºç¨‹åºå‘˜åˆ¶é€ çš„BUGã€‚</li><li>ä¸“ç”¨å¼‚å¸¸ç±»ï¼šå¤šç”¨äºç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œç”¨äºæè¿°æŒ‡å®šä½œä¸šå‡ºç°æ„å¤–æƒ…å†µæ— æ³•é¢„å…ˆå¤„ç†ã€‚</li></ul><p>å„ç±»å¼‚å¸¸å¿…é¡»è¦æœ‰å•ç‹¬çš„æ—¥å¿—è®°å½•ï¼Œæˆ–è€…åˆ†çº§ï¼Œä¾¿äºæ—¥å¿—ç®¡ç†ã€‚æ¯”å¦‚ï¼Œæœ‰çš„æ—¶å€™ä»…ä»…æƒ³ç»™ä¸‰æ–¹è¿ç»´çœ‹åˆ°é€»è¾‘å¼‚å¸¸ã€‚</p><h4 id="Counter-Example"><a href="#Counter-Example" class="headerlink" title="Counter-Example"></a>Counter-Example</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤„ç†ä¸šåŠ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> message è¦å¤„ç†çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processMessage</span><span class="params">(Message&lt;String&gt; message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ¶ˆæ¯éªŒè¯</span></span><br><span class="line">        <span class="comment">// å¤„ç†æ¶ˆæ¯è§£æ</span></span><br><span class="line">        <span class="comment">// å¤„ç†æ¶ˆæ¯å…¥åº“</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(ValidateException e )&#123;</span><br><span class="line">        <span class="comment">// éªŒè¯å¤±è´¥</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(ParseException e )&#123;</span><br><span class="line">        <span class="comment">// è§£æå¤±è´¥</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(PersistException e )&#123;</span><br><span class="line">        <span class="comment">// å…¥åº“å¤±è´¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤„ç†ä¸šåŠ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> message è¦å¤„ç†çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processMessage</span><span class="params">(Message&lt;String&gt; message)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†æ¶ˆæ¯éªŒè¯</span></span><br><span class="line">    <span class="keyword">if</span>(!message.isValud())&#123;</span><br><span class="line">        MessageLogService.log(<span class="string">"æ¶ˆæ¯æ ¡éªŒå¤±è´¥"</span> + message.errors())</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†æ¶ˆæ¯è§£æ</span></span><br><span class="line">    <span class="keyword">if</span>(!message.parse())&#123;</span><br><span class="line">        MessageLogService.log(<span class="string">"æ¶ˆæ¯è§£æå¤±è´¥"</span> + message.errors())</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// TODO ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://mp.weixin.qq.com/s/GXSZ-3w3Px43fA3XEuyWxw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/GXSZ-3w3Px43fA3XEuyWxw</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿ,æˆ–è€…æ˜¯äº§å“,å¸¸å¸¸é¢ä¸´ç€è¿™æ ·çš„é—®é¢˜ï¼š&lt;/p
      
    
    </summary>
    
      <category term="Spring Boot" scheme="https://sulangsss.github.io/categories/Spring-Boot/"/>
    
      <category term="Exception" scheme="https://sulangsss.github.io/categories/Spring-Boot/Exception/"/>
    
    
      <category term="Exception" scheme="https://sulangsss.github.io/tags/Exception/"/>
    
      <category term="Spring Boot" scheme="https://sulangsss.github.io/tags/Spring-Boot/"/>
    
      <category term="ä¼˜é›…å¤„ç†å¼‚å¸¸" scheme="https://sulangsss.github.io/tags/%E4%BC%98%E9%9B%85%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>Distributed Transaction Solution</title>
    <link href="https://sulangsss.github.io/2019/01/13/DistributedSystem/Transaction/DTP-Solution/"/>
    <id>https://sulangsss.github.io/2019/01/13/DistributedSystem/Transaction/DTP-Solution/</id>
    <published>2019-01-13T15:22:18.000Z</published>
    <updated>2019-01-17T10:45:41.033Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/ms-app-structure-example.png"><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªdatabase per serviceçš„æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å°±æ˜¯æ¯ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªæ•°æ®åº“ã€‚ è¿™æ ·å¯ä»¥ä¿è¯å¾®æœåŠ¡ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹æ¼”è¿›ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œç‹¬ç«‹å›¢é˜Ÿã€‚</p><p>ç”±äºå¯¹å¤–æä¾›çš„æœåŠ¡æ˜¯ç”±ä¸€ç»„ç›¸äº’åä½œçš„å¾®æœåŠ¡æ‰€ç»„æˆï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”±äºå„ä¸ªæœåŠ¡è®¿é—®çš„æ•°æ®æ˜¯ç›¸äº’åˆ†ç¦»çš„ï¼ŒæœåŠ¡ä¹‹é—´ä¸èƒ½é æ•°æ®åº“æ¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚è¿™å°±éœ€è¦åœ¨åº”ç”¨å±‚é¢æä¾›ä¸€ä¸ªåè°ƒæœºåˆ¶ï¼Œæ¥ä¿è¯ä¸€ç»„äº‹åŠ¡æ‰§è¡Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</p><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/2pc-example.png"><p>ç”±äºéš”ç¦»æ€§äº’æ–¥çš„è¦æ±‚ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½æ˜¯è¢«é”å®šçš„ï¼Œè¿™ç§æƒ…å†µåªé€‚åˆæ‰§è¡Œæ—¶é—´ç¡®å®šçš„çŸ­äº‹åŠ¡ã€‚ä½†æ˜¯ä¸ºäº†ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå¤§éƒ½æ˜¯é‡‡ç”¨ä¸²è¡ŒåŒ–çš„éš”ç¦»çº§åˆ«æ¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè¿™æ ·ä¼šé™ä½ç³»ç»Ÿçš„ååã€‚ä½†å› ä¸º2PCåè®®çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œåˆæœ‰å…¨å±€é”çš„é—®é¢˜ï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚ç°åœ¨å¤§å®¶åŸºæœ¬ä¸Šä¸ä¼šé‡‡ç”¨è¿™ç§å¼ºä¸€è‡´è§£å†³æ–¹æ¡ˆã€‚</p><p>å¾®æœåŠ¡äº‹åŠ¡ä¸€è‡´æ€§å»ºè®®ï¼š</p><ul><li>å¾®æœåŠ¡å†…ï¼šèšåˆé€šè¿‡æ•°æ®åº“äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´ã€‚</li><li>å¾®æœåŠ¡é—´ï¼šæœ€ç»ˆä¸€è‡´ã€‚</li></ul><hr><h3 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h3><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/tcc-example.png"><p>TCCåå­—çš„ç”±æ¥æ˜¯å…¶ä¸­åŒ…å«äº†tryï¼Œconfirmï¼Œcancelä¸‰ä¸ªæ“ä½œã€‚</p><p>ä¸2PCç›¸æ¯”ï¼ŒTCCä½äºä¸šåŠ¡æœåŠ¡å±‚ï¼Œæ²¡æœ‰å•ç‹¬çš„å‡†å¤‡é˜¶æ®µï¼ŒTryæ“ä½œå¯ä»¥çµæ´»é€‰æ‹©ä¸šåŠ¡èµ„æºé”çš„ç²’åº¦ã€‚TCCæ˜¯é€šè¿‡æœ€ç»ˆä¸€è‡´æ€§æ¥è§£å†³ç³»ç»Ÿæ€§èƒ½é—®é¢˜çš„è¿™ä¸ªè®¾è®¡ï¼Œå¯¹æˆ‘ä»¬è®¾è®¡æŠ‰æ‹©æœ‰å¾ˆå¤§çš„å¯å‘ã€‚<strong>æœ‰äº›æ—¶å€™ç³»ç»Ÿçš„æŠ€æœ¯é—®é¢˜æ˜¯å¯ä»¥é€šè¿‡ä¸šåŠ¡å»ºæ¨¡çš„æ–¹å¼æ¥è§£å†³çš„ã€‚</strong></p><blockquote><p>æ¨èé˜…è¯»ä¹¦ç±ï¼šé¢†åŸŸé©±åŠ¨è®¾è®¡å’Œå®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡</p></blockquote><h4 id="æ¶ˆæ¯é©±åŠ¨æ–¹å¼"><a href="#æ¶ˆæ¯é©±åŠ¨æ–¹å¼" class="headerlink" title="æ¶ˆæ¯é©±åŠ¨æ–¹å¼"></a>æ¶ˆæ¯é©±åŠ¨æ–¹å¼</h4><p>æ¶ˆæ¯ä¸€è‡´æ€§æ–¹æ¡ˆæ˜¯é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ä¿è¯ä¸Šä¸‹æ¸¸åº”ç”¨æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ã€‚åŸºæœ¬æ€è·¯æ˜¯å°†æœ¬åœ°æ“ä½œå’Œå‘é€æ¶ˆæ¯æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸‹æ¸¸åº”ç”¨å‘æ¶ˆæ¯ç³»ç»Ÿè®¢é˜…è¯¥æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œç›¸åº”æ“ä½œã€‚æœ¬è´¨ä¸Šæ˜¯ä¾é æ¶ˆæ¯çš„é‡è¯•æœºåˆ¶ï¼Œè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>æ¶ˆæ¯é©±åŠ¨çš„ç¼ºç‚¹æ˜¯ï¼šè€¦åˆåº¦é«˜ï¼Œéœ€è¦åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å¼•å…¥MQï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦å¢åŠ ã€‚</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>Aè´¦æˆ·å¾€Bè´¦æˆ·æ±‡æ¬¾100å…ƒï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>æ±‡æ¬¾æœåŠ¡å’Œæ”¶æ¬¾æœåŠ¡åˆ†åˆ«éœ€è¦å®ç°ï¼ŒTry-Confirm-Cancelæ¥å£ï¼Œå¹¶åœ¨ä¸šåŠ¡åˆå§‹åŒ–é˜¶æ®µå°†å…¶æ³¨å…¥åˆ°TCCäº‹åŠ¡ç®¡ç†å™¨ä¸­ã€‚</p><h4 id="æ±‡æ¬¾æœåŠ¡"><a href="#æ±‡æ¬¾æœåŠ¡" class="headerlink" title="æ±‡æ¬¾æœåŠ¡"></a>æ±‡æ¬¾æœåŠ¡</h4><p>Tryï¼š</p><ul><li>æ£€æŸ¥Aè´¦æˆ·æœ‰æ•ˆæ€§ï¼Œå³æŸ¥çœ‹Aè´¦æˆ·çš„çŠ¶æ€æ˜¯å¦ä¸ºâ€œè½¬å¸ä¸­â€æˆ–è€…â€œå†»ç»“â€ï¼›</li><li>æ£€æŸ¥Aè´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³ï¼›</li><li>ä»Aè´¦æˆ·ä¸­æ‰£å‡100å…ƒï¼Œå¹¶å°†çŠ¶æ€ç½®ä¸ºâ€œè½¬è´¦ä¸­â€ï¼›</li><li>é¢„ç•™æ‰£å‡èµ„æºï¼Œå°†ä»Aå¾€Bè´¦æˆ·è½¬è´¦100å…ƒè¿™ä¸ªäº‹ä»¶å­˜å…¥æ¶ˆæ¯æˆ–è€…æ—¥å¿—ä¸­ï¼›</li></ul><p>Confirmï¼šä¸åšä»»ä½•æ“ä½œ</p><p>Cancelï¼š</p><ul><li>Aè´¦æˆ·å¢åŠ 100å…ƒï¼›</li><li>ä»æ—¥å¿—æˆ–è€…æ¶ˆæ¯ä¸­ï¼Œé‡Šæ”¾æ‰£å‡èµ„æºã€‚</li></ul><h4 id="æ”¶æ¬¾æœåŠ¡"><a href="#æ”¶æ¬¾æœåŠ¡" class="headerlink" title="æ”¶æ¬¾æœåŠ¡"></a>æ”¶æ¬¾æœåŠ¡</h4><p>Tryï¼š</p><ul><li>æ£€æŸ¥Bè´¦æˆ·è´¦æˆ·æ˜¯å¦æœ‰æ•ˆï¼›</li></ul><p>Confirmï¼š</p><ul><li>è¯»å–æ—¥å¿—æˆ–è€…æ¶ˆæ¯ï¼ŒBè´¦æˆ·å¢åŠ 100å…ƒï¼›</li><li>ä»æ—¥å¿—æˆ–è€…æ¶ˆæ¯ä¸­ï¼Œé‡Šæ”¾æ‰£å‡èµ„æºï¼›</li></ul><p>Cancelï¼šä¸åšä»»ä½•æ“ä½œã€‚</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒTCCæ¨¡å‹å¯¹ä¸šåŠ¡çš„ä¾µå…¥å¼ºï¼Œæ”¹é€ çš„éš¾åº¦å¤§ã€‚</p><hr><h3 id="Sage"><a href="#Sage" class="headerlink" title="Sage"></a>Sage</h3><p>Sagaå…¶å®æ˜¯30å¹´å‰çš„ä¸€ç¯‡æ•°æ®åº“è®ºæ–‡é‡Œæåˆ°çš„ä¸€ä¸ªæ¦‚å¿µã€‚åœ¨è®ºæ–‡ä¸­ä¸€ä¸ªSagaäº‹åŠ¡å°±æ˜¯ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„äº‹åŠ¡ï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯ç”±å¤šä¸ªæœ¬åœ°äº‹åŠ¡æ‰€ç»„æˆï¼Œæ¯ä¸ªæœ¬åœ°äº‹åŠ¡æœ‰ç›¸åº”çš„æ‰§è¡Œæ¨¡å—å’Œè¡¥å¿æ¨¡å—ï¼Œå½“Sagaäº‹åŠ¡ä¸­çš„ä»»æ„ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡å‡ºé”™äº†ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç›¸å…³äº‹åŠ¡å¯¹åº”çš„è¡¥å¿æ–¹æ³•æ¢å¤ï¼Œè¾¾åˆ°äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”±äºç½‘ç»œè¯·æ±‚å¯èƒ½çš„å»¶æ—¶ï¼Œåœ¨Caitieçš„è®ºæ–‡ä¸­å¯¹è¢«Sagaè°ƒç”¨çš„æœåŠ¡æå‡ºä¸¤ç‚¹è¦æ±‚ï¼š</p><ul><li>è¶…æ—¶é‡è¯•çš„æœºåˆ¶ï¼Œéœ€è¦Sagaè°ƒç”¨çš„æœåŠ¡æ”¯æŒå¹‚ç­‰ã€‚åœ¨æœåŠ¡è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°è¶…æ—¶é‡è¯•çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¹‚ç­‰æ¥é¿å…å¤šæ¬¡è¯·æ±‚æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</li><li>é‡è¯•å–æ¶ˆçš„æœºåˆ¶ï¼Œè¡¥å¿å¯äº¤æ¢åŸåˆ™æ˜¯æŒ‡Sagaå¹¶è¡Œå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿäº†è¶…æ—¶é‡è¯•äº‹ä»¶ä¹‹åï¼Œå¹¶è¿›è¡Œäº†è¡¥å¿çš„æ“ä½œï¼Œé‚£ä¹ˆè¡¥å¿æ“ä½œæ˜¯ç›´æ¥ç”Ÿæ•ˆçš„ã€‚</li></ul><blockquote><p>ä¸»è¦å‚è€ƒäº†Caitie McCaffreyåœ¨åˆ†å¸ƒå¼Sagaè®ºæ–‡ï¼Œä»¥åŠChris Richardsonçš„ç ”ç©¶</p></blockquote><h4 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h4><p>Sagaæ¨¡å‹æŠŠä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ¯ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½æœ‰ç›¸åº”çš„æ‰§è¡Œæ¨¡å—å’Œè¡¥å¿æ¨¡å—ï¼ˆ TCCä¸­çš„Confirmå’ŒCancelï¼‰ã€‚å½“Sagaäº‹åŠ¡ä¸­ä»»æ„ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡å‡ºé”™æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç›¸å…³çš„è¡¥å¿æ–¹æ³•æ¢å¤ä¹‹å‰çš„äº‹åŠ¡ï¼Œè¾¾åˆ°äº‹åŠ¡æœ€ç»ˆçš„ä¸€è‡´æ€§ã€‚</p><p>å½“æ¯ä¸ªSagaå­äº‹åŠ¡ T1, T2, â€¦, Tn éƒ½æœ‰å¯¹åº”çš„è¡¥å¿å®šä¹‰ C1, C2, â€¦, Cn-1,é‚£ä¹ˆSagaç³»ç»Ÿå¯ä»¥ä¿è¯ï¼š</p><ul><li>å­äº‹åŠ¡åºåˆ— T1, T2, â€¦, Tnå¾—ä»¥å®Œæˆ (æœ€ä½³æƒ…å†µ)ï¼›</li><li>æˆ–è€…åºåˆ— T1, T2, â€¦, Tj, Cj, â€¦, C2, C1, 0 &lt; j &lt; n, å¾—ä»¥å®Œæˆã€‚</li></ul><p>ç”±äºSagaæ¨¡å‹ä¸­æ²¡æœ‰Prepareé˜¶æ®µï¼Œå› æ­¤äº‹åŠ¡é—´ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œå½“å¤šä¸ªSagaäº‹åŠ¡æ“ä½œåŒä¸€èµ„æºæ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ›´æ–°ä¸¢å¤±ã€è„æ•°æ®è¯»å–ç­‰é—®é¢˜ï¼Œè¿™æ—¶éœ€è¦åœ¨ä¸šåŠ¡å±‚æ§åˆ¶å¹¶å‘ï¼Œä¾‹å¦‚ï¼š</p><ul><li>åœ¨åº”ç”¨å±‚é¢åŠ é”ï¼›</li><li>åº”ç”¨å±‚é¢é¢„å…ˆå†»ç»“èµ„æºã€‚</li></ul><p>Sagaæ¢å¤æ–¹å¼ï¼š</p><ul><li>å‘åæ¢å¤ï¼šè¡¥å¿æ‰€æœ‰å·²å®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœä»»ä¸€å­äº‹åŠ¡å¤±è´¥ï¼›</li><li>å‘å‰æ¢å¤ï¼šé‡è¯•å¤±è´¥çš„äº‹åŠ¡ï¼Œå‡è®¾æ¯ä¸ªå­äº‹åŠ¡æœ€ç»ˆéƒ½ä¼šæˆåŠŸã€‚</li></ul><p>æ˜¾ç„¶ï¼Œå‘å‰æ¢å¤æ²¡æœ‰å¿…è¦æä¾›è¡¥å¿äº‹åŠ¡ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡ä¸­ï¼Œå­äº‹åŠ¡(æœ€ç»ˆ)æ€»ä¼šæˆåŠŸï¼Œæˆ–è¡¥å¿äº‹åŠ¡éš¾ä»¥å®šä¹‰æˆ–ä¸å¯èƒ½ï¼Œå‘å‰æ¢å¤æ›´ç¬¦åˆä½ çš„éœ€æ±‚ã€‚ç†è®ºä¸Šè¡¥å¿äº‹åŠ¡æ°¸ä¸å¤±è´¥ï¼Œç„¶è€Œï¼Œåœ¨åˆ†å¸ƒå¼ä¸–ç•Œä¸­ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå®•æœºã€ç½‘ç»œå¯èƒ½ä¼šå¤±è´¥ï¼Œç”šè‡³æ•°æ®ä¸­å¿ƒä¹Ÿå¯èƒ½ä¼šåœç”µï¼Œè¿™æ—¶éœ€è¦æä¾›æ•…éšœæ¢å¤åå›é€€çš„æœºåˆ¶ï¼Œæ¯”å¦‚äººå·¥å¹²é¢„ã€‚</p><hr><h4 id="ACIDä¸Sage"><a href="#ACIDä¸Sage" class="headerlink" title="ACIDä¸Sage"></a>ACIDä¸Sage</h4><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/acid-and-sage.png"><p>ä¸ºäº†æ»¡è¶³é‡è¯•å–æ¶ˆçš„æœºåˆ¶ï¼Œéœ€è¦æˆ‘ä»¬åœ¨è®¾è®¡ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ä¿ç•™æ‰€æœ‰çš„äº‹åŠ¡æ•°æ®ã€‚ä½†æ˜¯ä»ä¸Šå›¾å¯çŸ¥ï¼ŒSagaæ¨¡å‹åªæ”¯æŒACDï¼Œä¸æä¾›éš”ç¦»æ€§çš„ä¿è¯ã€‚</p><p><strong>å¦‚æœSageç¼ºå°‘äº†éš”ç¦»æ€§ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><ul><li>ä¸¤ä¸ªSageäº‹åŠ¡åŒæ—¶æ“ä½œä¸€ä¸ªèµ„æºä¼šå‡ºç°æ•°æ®è¯­ä¹‰ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li><li>ä¸¤ä¸ªSageäº‹åŠ¡åŒæ—¶æ“ä½œä¸€ä¸ªè®¢å•ï¼Œå½¼æ­¤æ“ä½œä¼šè¦†ç›–å¯¹æ¯”(æ›´æ–°ä¸¢å¤±)ã€‚</li><li>ä¸¤ä¸ªSageäº‹åŠ¡åŒæ—¶è®¿é—®æ‰£æ¬¾è´¦å·ï¼Œæ— æ³•çœ‹åˆ°é€€æ¬¾(è„è¯»å–é—®é¢˜)ã€‚</li><li>åœ¨ä¸€ä¸ªSageäº‹åŠ¡å†…ï¼Œæ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹å‰åçš„è¯»å–å€¼ä¸ä¸€è‡´(æ¨¡ç³Šè¯»å–é—®é¢˜)ã€‚</li></ul><p><strong>å¦‚ä½•åº”å¯¹éš”ç¦»æ€§é—®é¢˜ï¼Ÿ</strong></p><p>éš”ç¦»çš„æœ¬è´¨æ˜¯æ§åˆ¶å¹¶å‘ï¼Œé˜²æ­¢å¹¶å‘äº‹åŠ¡æ“ä½œç›¸åŒèµ„æºè€Œå¼•èµ·ç»“æœé”™ä¹±ã€‚</p><ul><li>åœ¨åº”ç”¨å±‚é¢åŠ å…¥é€»è¾‘é”çš„é€»è¾‘ã€‚</li><li>Sessionå±‚é¢ï¼ŒSessionä»¥åŠé”çš„æœºåˆ¶ä¿è¯ä¸²è¡ŒåŒ–æ“ä½œèµ„æºã€‚</li><li>ä¸šåŠ¡å±‚é¢é‡‡ç”¨é¢„å…ˆå†»ç»“èµ„é‡‘çš„æ–¹å¼éš”ç¦»æ­¤éƒ¨åˆ†èµ„é‡‘ã€‚</li><li>ä¸šåŠ¡æ“ä½œè¿‡ç¨‹ä¸­é€šè¿‡åŠæ—¶è¯»å–å½“å‰çŠ¶æ€çš„æ–¹å¼è·å–æ›´æ–°ã€‚</li></ul><hr><h4 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h4><ul><li><p>Orchestration-Base Coordination - é›†ä¸­å¼ï¼šé›†ä¸­å¼åè°ƒå™¨è´Ÿè´£æœåŠ¡è°ƒç”¨ä»¥åŠäº‹åŠ¡åè°ƒã€‚</p></li><li><p>Choreography-Base Coordination - åˆ†å¸ƒå¼ï¼šé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼æ¥è¿›è¡Œäº‹åŠ¡åè°ƒã€‚</p></li></ul><hr><h3 id="FESCAR-Fast-amp-Easy-Commit-And-Rollback"><a href="#FESCAR-Fast-amp-Easy-Commit-And-Rollback" class="headerlink" title="FESCAR - Fast &amp; Easy Commit And Rollback"></a>FESCAR - Fast &amp; Easy Commit And Rollback</h3><p>å‡è®¾æŸä¸ªä¸šåŠ¡å…±æœ‰ 3 ä¸ªæ¨¡å—ï¼Œåœ¨ä¼ ç»Ÿçš„å•ä½“åº”ç”¨ä¸­ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—å¯ä»¥ä½¿ç”¨å•ä¸ªçš„æœ¬åœ°æ•°æ®æºï¼Œè¿™æ ·æœ¬åœ°äº‹åŠ¡è‡ªç„¶å°±å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚è€Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸šåŠ¡æ¨¡å—ä¼šè¢«è®¾è®¡æˆä¸º3ä¸ªä¸åŒæ•°æ®æºä¸Šçš„3ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å¯¹åº”ä¸€ä¸ªæ•°æ®åº“ï¼Œæœ¬åœ°äº‹åŠ¡å½“ç„¶ä¹Ÿå¯ä»¥ä¿è¯æ¯ä¸ªæœåŠ¡ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯æ‰©å±•åˆ°æ•´ä¸ªåº”ç”¨ã€æ•´ä¸ªä¸šåŠ¡é€»è¾‘èŒƒå›´æ¥çœ‹ï¼Œæƒ…å†µå¦‚ä½•å‘¢ï¼Ÿ</p><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/fescar-ms-example.png"><p>FESCARè§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/fescar-ms-solution.png"><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œç”±ä¸€æ‰¹Branch Transationç»„æˆï¼Œé€šå¸¸Branch Transationåªæ˜¯æœ¬åœ°äº‹åŠ¡ã€‚</p><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/fescar-ms-global-transaction.png"><h4 id="ä¸‰å¤§åŸºæœ¬ç»„ä»¶"><a href="#ä¸‰å¤§åŸºæœ¬ç»„ä»¶" class="headerlink" title="ä¸‰å¤§åŸºæœ¬ç»„ä»¶"></a>ä¸‰å¤§åŸºæœ¬ç»„ä»¶</h4><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/fescar-component.png"><ul><li>Transaction Coordinator(TC)ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤ä¸å›æ»šã€‚</li><li>Transaction Managerâ„¢ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li>Resource Manager(RM)ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCé€šä¿¡ä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å¹¶æŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li></ul><h4 id="ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸ"><a href="#ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸ"></a>ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸ</h4><img src="/2019/01/13/DistributedSystem/Transaction/DTP-Solution/fescar-transaction-lifecycle.png"><ol><li>TM è¦æ±‚ TC å¼€å§‹æ–°çš„å…¨å±€äº‹åŠ¡ï¼ŒTC ç”Ÿæˆè¡¨ç¤ºå…¨å±€äº‹åŠ¡çš„ XIDã€‚</li><li>XID é€šè¿‡å¾®æœåŠ¡çš„è°ƒç”¨é“¾ä¼ æ’­ã€‚</li><li>RM åœ¨ TC ä¸­å°†æœ¬åœ°äº‹åŠ¡æ³¨å†Œä¸º XID çš„ç›¸åº”å…¨å±€äº‹åŠ¡çš„åˆ†æ”¯ã€‚</li><li>TM è¦æ±‚ TC æäº¤æˆ–å›æ»š XID çš„ç›¸åº”å…¨å±€äº‹åŠ¡ã€‚</li><li>TC é©±åŠ¨ XID çš„ç›¸åº”å…¨å±€äº‹åŠ¡ä¸‹çš„æ‰€æœ‰åˆ†æ”¯äº‹åŠ¡ï¼Œå®Œæˆåˆ†æ”¯æäº¤æˆ–å›æ»šã€‚</li></ol><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://servicecomb.apache.org/cn/docs/distributed-transactions-saga-implementation/" target="_blank" rel="noopener">https://servicecomb.apache.org/cn/docs/distributed-transactions-saga-implementation/</a><br><a href="https://www.infoq.cn/article/JYa9UEU*CrBu8WHIQywy" target="_blank" rel="noopener">https://www.infoq.cn/article/JYa9UEU*CrBu8WHIQywy</a><br><a href="https://dbaplus.cn/news-159-2152-1.html" target="_blank" rel="noopener">https://dbaplus.cn/news-159-2152-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;img src=&quot;/2019/01/13/Distributed
      
    
    </summary>
    
      <category term="DistributedSystem" scheme="https://sulangsss.github.io/categories/DistributedSystem/"/>
    
      <category term="Transaction" scheme="https://sulangsss.github.io/categories/DistributedSystem/Transaction/"/>
    
    
      <category term="DistributedSystem" scheme="https://sulangsss.github.io/tags/DistributedSystem/"/>
    
      <category term="DistributedTransaction" scheme="https://sulangsss.github.io/tags/DistributedTransaction/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" scheme="https://sulangsss.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    
  </entry>
  
  <entry>
    <title>An Introduction to Distributed Transaction</title>
    <link href="https://sulangsss.github.io/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/"/>
    <id>https://sulangsss.github.io/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/</id>
    <published>2019-01-11T05:22:18.000Z</published>
    <updated>2019-01-15T09:36:52.304Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>ä¼ ç»Ÿå•æœºåº”ç”¨ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œå¥½å¤„æ˜¯åº”ç”¨å¯ä»¥ä½¿ç”¨ACID Transactionsã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/local-transaction.png"><p>ä¸ºä¿è¯ä¸€è‡´æ€§æˆ‘ä»¬åªéœ€è¦ï¼šå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œæ”¹å˜ï¼ˆæ’å…¥ï¼Œåˆ é™¤ï¼Œæ›´æ–°ï¼‰å¾ˆå¤šè¡Œï¼Œç„¶åæäº¤äº‹åŠ¡ï¼ˆå¦‚æœæœ‰å¼‚å¸¸æ—¶å›æ»šäº‹åŠ¡ï¼‰ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå€ŸåŠ©å¼€å‘å¹³å°ä¸­çš„æ•°æ®è®¿é—®æŠ€æœ¯å’Œæ¡†æ¶ï¼ˆå¦‚Springï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…æ›´å°‘ï¼Œåªéœ€è¦å…³æ³¨æ•°æ®æœ¬èº«çš„æ”¹å˜ã€‚</p><p>éšç€ç»„ç»‡è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œä¸šåŠ¡é‡ä¸æ–­å¢é•¿ï¼Œå•æœºåº”ç”¨å’Œæ•°æ®åº“å·²ç»ä¸è¶³ä»¥æ”¯æŒåºå¤§çš„ä¸šåŠ¡é‡å’Œæ•°æ®é‡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å¯¹åº”ç”¨å’Œæ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œå°±å‡ºç°äº†ä¸€ä¸ªåº”ç”¨éœ€è¦åŒæ—¶è®¿é—®ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„æ•°æ®åº“æƒ…å†µã€‚å¼€å§‹æˆ‘ä»¬ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯ä¸€è‡´æ€§ã€‚</p><hr><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/dtp.png"><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>æ˜¯æŒ‡ä¼šæ¶‰åŠåˆ°æ“ä½œå¤šä¸ªæ•°æ®åº“çš„äº‹åŠ¡ã€‚å…¶å®å°±æ˜¯å°†å¯¹åŒä¸€åº“äº‹åŠ¡çš„æ¦‚å¿µæ‰©å¤§åˆ°äº†å¯¹å¤šä¸ªåº“çš„äº‹åŠ¡ã€‚ç›®çš„æ˜¯ä¸ºäº†ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®ä¸€è‡´æ€§ã€‚<strong>åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„å…³é”®æ˜¯å¿…é¡»æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥çŸ¥é“äº‹åŠ¡åœ¨ä»»ä½•åœ°æ–¹æ‰€åšçš„æ‰€æœ‰åŠ¨ä½œï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡çš„å†³å®šå¿…é¡»äº§ç”Ÿç»Ÿä¸€çš„ç»“æœ(å…¨éƒ¨æäº¤æˆ–å…¨éƒ¨å›æ»š)</strong>ã€‚</p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¹‹é—´åœ¨ç‰©ç†ä¸Šç›¸äº’ç‹¬ç«‹ï¼Œé€šè¿‡ç½‘ç»œè¿›è¡Œæ²Ÿé€šå’Œåè°ƒã€‚ç”±äºå­˜åœ¨äº‹åŠ¡æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯æ¯ä¸ªç‹¬ç«‹èŠ‚ç‚¹ä¸Šçš„æ•°æ®æ“ä½œå¯ä»¥æ»¡è¶³ACIDã€‚ä½†æ˜¯ï¼Œç›¸äº’ç‹¬ç«‹çš„èŠ‚ç‚¹ä¹‹é—´æ— æ³•å‡†ç¡®çš„çŸ¥é“å…¶ä»–èŠ‚ç‚¹ä¸­çš„äº‹åŠ¡æ‰§è¡Œæƒ…å†µã€‚æ‰€ä»¥ä»ç†è®ºä¸Šè®²ï¼Œä¸¤å°æœºå™¨ç†è®ºä¸Šæ— æ³•è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>å¦‚æœæƒ³è®©åˆ†å¸ƒå¼éƒ¨ç½²çš„å¤šå°æœºå™¨ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±è¦ä¿è¯åœ¨æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®å†™æ“ä½œï¼Œè¦ä¸å…¨éƒ¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨çš„éƒ½ä¸æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸€å°æœºå™¨åœ¨æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æ—¶å€™æ— æ³•çŸ¥é“å…¶ä»–æœºå™¨ä¸­çš„æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æ‰€ä»¥ä»–ä¹Ÿå°±ä¸çŸ¥é“æœ¬æ¬¡äº‹åŠ¡åˆ°åº•åº”è¯¥commitè¿˜æ˜¯roolbackã€‚æ‰€ä»¥ï¼Œå¸¸è§„çš„è§£å†³åŠæ³•å°±æ˜¯å¼•å…¥ä¸€ä¸ªâ€œ<strong>åè°ƒè€…</strong>â€çš„ç»„ä»¶æ¥ç»Ÿä¸€è°ƒåº¦æ‰€æœ‰åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ‰§è¡Œã€‚</p><hr><h3 id="å¾®æœåŠ¡çš„å›°å¢ƒ"><a href="#å¾®æœåŠ¡çš„å›°å¢ƒ" class="headerlink" title="å¾®æœåŠ¡çš„å›°å¢ƒ"></a>å¾®æœåŠ¡çš„å›°å¢ƒ</h3><p>é¦–å…ˆï¼Œå¯¹äºå¾®æœåŠ¡æ¶æ„æ¥è¯´ï¼Œæ•°æ®è®¿é—®å˜å¾—æ›´åŠ å¤æ‚ï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®éƒ½æ˜¯å¾®æœåŠ¡ç§æœ‰çš„ï¼Œå”¯ä¸€å¯è®¿é—®çš„æ–¹å¼å°±æ˜¯é€šè¿‡APIã€‚è¿™ç§æ‰“åŒ…æ•°æ®è®¿é—®æ–¹å¼ä½¿å¾—å¾®æœåŠ¡ä¹‹é—´æ¾è€¦åˆï¼Œå¹¶ä¸”å½¼æ­¤ä¹‹é—´ç‹¬ç«‹éå¸¸å®¹æ˜“è¿›è¡Œæ€§èƒ½æ‰©å±•ã€‚</p><p>å…¶æ¬¡ï¼Œä¸åŒçš„å¾®æœåŠ¡ç»å¸¸ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ã€‚åº”ç”¨ä¼šäº§ç”Ÿå„ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå…³ç³»å‹æ•°æ®åº“å¹¶ä¸ä¸€å®šæ˜¯æœ€ä½³é€‰æ‹©ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸä¸ªäº§ç”Ÿå’ŒæŸ¥è¯¢å­—ç¬¦ä¸²çš„åº”ç”¨é‡‡ç”¨Elasticsearchçš„å­—ç¬¦æœç´¢å¼•æ“ï¼›æŸä¸ªäº§ç”Ÿç¤¾äº¤å›¾ç‰‡æ•°æ®çš„åº”ç”¨å¯ä»¥é‡‡ç”¨å›¾æ•°æ®åº“ï¼Œä¾‹å¦‚Neo4jï¼›åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ä¸€èˆ¬éƒ½ä½¿ç”¨SQLå’ŒNoSQLç»“åˆçš„æ¨¡å¼ã€‚ä½†æ˜¯è¿™äº›éå…³ç³»å‹æ•°æ®å¤§å¤šæ•°å¹¶ä¸æ”¯æŒ2PCã€‚å¯è§åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å·²ç»ä¸èƒ½é€‰æ‹©åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p><p>ä¾æ®CAPç†è®ºï¼Œå¿…é¡»åœ¨å¯ç”¨æ€§(availability)å’Œä¸€è‡´æ€§(consistency)ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚å¦‚æœé€‰æ‹©æä¾›ä¸€è‡´æ€§éœ€è¦ä»˜å‡ºåœ¨æ»¡è¶³ä¸€è‡´æ€§ä¹‹å‰é˜»å¡å…¶ä»–å¹¶å‘è®¿é—®çš„ä»£ä»·ã€‚è¿™å¯èƒ½æŒç»­ä¸€ä¸ªä¸ç¡®å®šçš„æ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨ç³»ç»Ÿå·²ç»è¡¨ç°å‡ºé«˜å»¶è¿Ÿæ—¶æˆ–è€…ç½‘ç»œæ•…éšœå¯¼è‡´å¤±å»è¿æ¥æ—¶ã€‚</p><p>ä¾æ®ç›®å‰çš„æˆåŠŸç»éªŒï¼Œå¯ç”¨æ€§ä¸€èˆ¬æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯åœ¨æœåŠ¡å’Œæ•°æ®åº“ä¹‹é—´ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§æ˜¯éå¸¸æ ¹æœ¬çš„éœ€æ±‚ï¼Œå¾®æœåŠ¡æ¶æ„ä¸­åº”é€‰æ‹©æ»¡è¶³æœ€ç»ˆä¸€è‡´æ€§ã€‚å¦‚æœé€‰æ‹©äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œå°±è¦ä¿è¯åˆ°è¾¾æœ€ç»ˆä¸€è‡´æ€§çš„è¿™æ®µæ—¶é—´è¦åœ¨ç”¨æˆ·å¯æ¥å—çš„èŒƒå›´ä¹‹å†…ã€‚</p><blockquote><p>æœ€ç»ˆä¸€è‡´æ€§ï¼šæŒ‡ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p></blockquote><hr><h3 id="X-Open-DTP-Model"><a href="#X-Open-DTP-Model" class="headerlink" title="X/Open DTP Model"></a>X/Open DTP Model</h3><hr><h4 id="Whatâ€™s-DTP-Model"><a href="#Whatâ€™s-DTP-Model" class="headerlink" title="Whatâ€™s DTP Model"></a>Whatâ€™s DTP Model</h4><p>X/Open DTP(Distributed Transaction Process)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ã€‚è¿™ä¸ªæ¨¡å‹ä¸»è¦ä½¿ç”¨äº†2PC(Two-Phase-Commit)æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„å®Œæ•´æ€§ã€‚</p><blockquote><p>The X/Open Distributed Transaction Processing (DTP) model is a software architecture that <strong>allows multiple application programs to share resources provided by multiple resource managers, and allows their work to be coordinated into global transactions</strong>.</p></blockquote><p>DTPç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯V3ï¼ŒDTPæ¨¡å‹çš„ç»„æˆï¼š</p><ul><li>åº”ç”¨ç¨‹åº(Application Program ï¼Œç®€ç§°AP)ï¼šå³ä¸šåŠ¡å±‚ã€‚å“ªäº›æ“ä½œå±äºä¸€ä¸ªäº‹åŠ¡ï¼Œå°±æ˜¯APå®šä¹‰çš„ã€‚ã€‚</li><li>èµ„æºç®¡ç†å™¨(Resource Managerï¼Œç®€ç§°RM)ï¼šä¸€èˆ¬æ˜¯æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„èµ„æºç®¡ç†å™¨ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—(å¦‚JMSæ•°æ®æº)ï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰ã€‚</li><li>äº‹åŠ¡ç®¡ç†å™¨(Transaction Manager ï¼Œç®€ç§°TM)ï¼šæ¥æ”¶APçš„äº‹åŠ¡è¯·æ±‚ï¼Œå¯¹å…¨å±€äº‹åŠ¡è¿›è¡Œç®¡ç†ï¼Œç®¡ç†äº‹åŠ¡åˆ†æ”¯çŠ¶æ€ï¼Œåè°ƒRMçš„å¤„ç†ï¼Œé€šçŸ¥RMå“ªäº›æ“ä½œå±äºå“ªäº›å…¨å±€äº‹åŠ¡ä»¥åŠäº‹åŠ¡åˆ†æ”¯ç­‰ç­‰ã€‚è¿™ä¸ªä¹Ÿæ˜¯æ•´ä¸ªäº‹åŠ¡è°ƒåº¦æ¨¡å‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸€èˆ¬æ˜¯ä½œä¸ºäº¤æ˜“ä¸­é—´ä»¶ã€‚</li><li>é€šä¿¡èµ„æºç®¡ç†å™¨(Communication Resource Managerï¼Œç®€ç§°CRM)ï¼šæ§åˆ¶ä¸€ä¸ªTMåŸŸ(TM domain)å†…æˆ–è€…è·¨TMåŸŸçš„åˆ†å¸ƒå¼åº”ç”¨ä¹‹é—´çš„é€šä¿¡ã€‚</li><li>é€šä¿¡åè®®(Communication Protocolï¼Œç®€ç§°CP)ï¼šæä¾›CRMæä¾›çš„åˆ†å¸ƒå¼åº”ç”¨èŠ‚ç‚¹ä¹‹é—´çš„åº•å±‚é€šä¿¡æœåŠ¡ã€‚</li></ul><blockquote><p>an Application Program (<strong>AP</strong>), which defines transaction boundaries and specifies actions that constitute a transaction<br>Resource Managers (<strong>RMs</strong>) such as databases or file access systems, which provide access to resources<br>a Transaction Manager (<strong>TM</strong>), which assigns identifiers to transactions, monitors their progress, and takes responsibility for transaction completion and for coordinating failure recovery.<br>Communication Resource Managers (<strong>CRMs</strong>), which control communication between distributed applications within or across TM domains.<br>a communication protocol(<strong>CP</strong>), which provides the underlying communication services used by distributed applications and supported by CRMs.<br>Javaä¸­çš„javax.transaction.xa.XAResourceå®šä¹‰äº†XAæ¥å£ï¼Œå®ƒä¾èµ–æ•°æ®åº“å‚å•†å¯¹jdbc-driverçš„å…·ä½“å®ç°ã€‚</p></blockquote><hr><h4 id="å…¨å±€çš„DTP-Global-DTP"><a href="#å…¨å±€çš„DTP-Global-DTP" class="headerlink" title="å…¨å±€çš„DTP - Global DTP"></a>å…¨å±€çš„DTP - Global DTP</h4><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/dtp-model.png"><ul><li>å…¨å±€äº‹åŠ¡ï¼šå¯¹äºä¸€æ¬¡æ€§æ“ä½œå¤šä¸ªèµ„æºç®¡ç†å™¨çš„äº‹åŠ¡ã€‚</li><li>åˆ†æ”¯äº‹åŠ¡ï¼šåœ¨å…¨å±€äº‹åŠ¡ä¸­ï¼ŒæŸä¸€ä¸ªèµ„æºç®¡ç†å™¨æœ‰è‡ªå·±ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡çš„é›†åˆä½œä¸ºè¿™ä¸ªèµ„æºç®¡ç†å™¨çš„åˆ†æ”¯ä»»åŠ¡ã€‚</li></ul><p>APå¯ä»¥å’ŒTMä»¥åŠRMé€šä¿¡ï¼ŒTMå’ŒRMäº’ç›¸ä¹‹é—´å¯ä»¥é€šä¿¡ï¼ŒDTPæ¨¡å‹é‡Œé¢å®šä¹‰äº†XAæ¥å£ï¼ŒTMå’ŒRMé€šè¿‡XAæ¥å£è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä¾‹å¦‚ï¼ŒTMé€šçŸ¥RMæäº¤äº‹åŠ¡æˆ–è€…å›æ»šäº‹åŠ¡ï¼ŒRMæŠŠæäº¤ç»“æœé€šçŸ¥ç»™TMã€‚APå’ŒRMä¹‹é—´åˆ™é€šè¿‡RMæä¾›çš„Native API è¿›è¡Œèµ„æºæ§åˆ¶ï¼Œè¿™ä¸ªæ²¡æœ‰è¿›è¡Œçº¦APIå’Œè§„èŒƒï¼Œå„ä¸ªå‚å•†è‡ªå·±å®ç°è‡ªå·±çš„èµ„æºæ§åˆ¶ï¼Œæ¯”å¦‚Oracleçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/ap-tm-rm-relationship.png" title="ä¸‰è€…å…³ç³»çš„å…³ç³»"><hr><h4 id="è·¨åŸŸçš„å…¨å±€DTP"><a href="#è·¨åŸŸçš„å…¨å±€DTP" class="headerlink" title="è·¨åŸŸçš„å…¨å±€DTP"></a>è·¨åŸŸçš„å…¨å±€DTP</h4><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/global-dtp-model.png"><p>å¦‚æœåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦è·¨å¤šä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸ªModelå®ä¾‹ä¸­ï¼Œè¿˜éœ€è¦é¢å¤–çš„åŠ å…¥ä¸€ä¸ªé€šä¿¡èµ„æºç®¡ç†å™¨CRMã€‚CRMè´Ÿè´£åœ¨å¤šä¸ªäº‹åŠ¡åŸŸä¹‹é—´è¿›è¡Œåè°ƒå’Œæ²Ÿé€šã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/crm-communication.png"><p>CRMä½œä¸ºå¤šä¸ªModelå®ä¾‹ä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ï¼š</p><ul><li>åŸºæœ¬çš„é€šä¿¡èƒ½åŠ›ï¼šä»è¿™ä¸ªè§’åº¦ï¼Œå¯ä»¥å°†CRMç±»æ¯”ä¸ºRPCæ¡†æ¶ï¼ŒModelå®ä¾‹ä¹‹é—´é€šè¿‡RPCè°ƒç”¨å®ç°å½¼æ­¤çš„é€šä¿¡ã€‚è¿™ä¸€ç‚¹ä½“ç°åœ¨APã€CRMä¹‹é—´çš„è¿çº¿ã€‚</li><li>äº‹åŠ¡ä¼ æ’­èƒ½åŠ›ï¼šä¸ä¼ ç»ŸRPCæ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒCRMåº•å±‚é‡‡ç”¨OSI TPé€šä¿¡æœåŠ¡ï¼Œå› æ­¤CRMå…·å¤‡äº‹åŠ¡ä¼ æ’­èƒ½åŠ›ã€‚è¿™ä¸€ç‚¹ä½“ç°TMã€CRMä¹‹é—´çš„è¿çº¿ã€‚<blockquote><p>OSI TPï¼šOpen Systems Interconnection â€” Distributed Transaction Processing</p></blockquote></li></ul><hr><h4 id="XAè§„èŒƒ"><a href="#XAè§„èŒƒ" class="headerlink" title="XAè§„èŒƒ"></a>XAè§„èŒƒ</h4><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/basic-dtp-model.png"><p>ä¸€ä¸ªDTP Model Instanceï¼Œè‡³å°‘æœ‰3ä¸ªç»„æˆéƒ¨åˆ†ï¼šAPã€RMsã€TMã€‚</p><blockquote><p>The subject of this X/Open specification is interface (3) in the diagram above, the XA interface by which TMs and RMs interact.<br>XAè§„èŒƒçš„æœ€ä¸»è¦çš„ä½œç”¨æ˜¯ï¼Œå°±æ˜¯å®šä¹‰äº†RM-TMçš„äº¤äº’æ¥å£ã€‚</p></blockquote><blockquote><ul><li>2PCæ˜¯åœ¨OSI TPæ ‡å‡†ä¸­æå‡ºçš„ã€‚</li><li>åœ¨DTP Modelä¸­ï¼ŒæŒ‡å®šäº†å…¨å±€äº‹åŠ¡çš„æäº¤è¦ä½¿ç”¨2PCåè®®ã€‚</li><li>XAè§„èŒƒåªæ˜¯å®šä¹‰äº†2PCåè®®ä¸­éœ€è¦ä½¿ç”¨åˆ°çš„æ¥å£ï¼Œå³ä¸Šé¢æåˆ°çš„RM-TMäº¤äº’çš„æ¥å£(å› ä¸º2PCè¿‡ç¨‹ä¸­çš„å‚ä¸æ–¹åªæœ‰TMå’ŒRMs)ã€‚</li></ul></blockquote><hr><h4 id="TM-Domain"><a href="#TM-Domain" class="headerlink" title="TM Domain"></a>TM Domain</h4><p>ä¸€ä¸ªTM Domainä¸­ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªModelå®ä¾‹ç»„æˆï¼Œè¿™äº›Modelå®ä¾‹ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªTMï¼Œä½†æ˜¯æ“ä½œçš„RMså„ä¸ç›¸åŒï¼Œç”±TMæ¥ç»Ÿä¸€åè°ƒè¿™äº›Modelå®ä¾‹å…±åŒå‚ä¸å½¢æˆçš„å…¨å±€äº‹åŠ¡(global transaction)ã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/tm-domain.png"><p>TM Domainåªæ˜¯åˆ—å‡ºäº†æœ€ç»ˆå‚ä¸åˆ°ä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­ï¼Œæœ‰å“ªäº›Modelå®ä¾‹ï¼Œå¹¶ä¸å…³å¿ƒè¿™äº›Modelå®ä¾‹ä¹‹é—´çš„å…³ç³»ã€‚è¿™å°±å¥½æ¯”ï¼Œæœ‰ä¸€ä¸ªç­çº§ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³çŸ¥é“è¿™ä¸ªç­çº§ä¸­æ¯ä½åŒå­¦çš„åå­—ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…³å¿ƒè°æ˜¯ç­é•¿ã€è°æ˜¯å­¦ä¹ å§”å‘˜ç­‰ã€‚</p><p>ä¸è¿‡æ˜¾ç„¶çš„ï¼Œå½“ä¸€ä¸ªTM Domainä¸­å­˜åœ¨å¤šä¸ªModelå®ä¾‹æ—¶ï¼ŒModelå®ä¾‹å½¼æ­¤ä¹‹é—´å­˜åœ¨ä¸€å®šçš„å±‚çº§è°ƒç”¨å…³ç³»ã€‚è¿™å°±æ˜¯<strong>å…¨å±€äº‹åŠ¡çš„æ ‘å½¢ç»“æ„</strong>ã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/global-transaction-tree-structure.png"><p>å‘èµ·åˆ†å¸ƒå¼äº‹åŠ¡çš„Modelå®ä¾‹ç§°ä¹‹ä¸ºrootèŠ‚ç‚¹ï¼Œæˆ–è€…ç§°ä¹‹ä¸ºäº‹åŠ¡çš„å‘èµ·è€…ï¼Œå…¶ä»–çš„Modelå®ä¾‹å¯ä»¥ç»Ÿç§°ä¸ºäº‹åŠ¡çš„å‚ä¸è€…ã€‚äº‹åŠ¡å‘èµ·è€…è´Ÿè´£å¼€å¯æ•´ä¸ªå…¨å±€äº‹åŠ¡ï¼Œäº‹åŠ¡å‚ä¸è€…å„è‡ªè´Ÿè´£æ‰§è¡Œè‡ªå·±çš„äº‹åŠ¡åˆ†æ”¯ã€‚</p><p>è€Œä»Modelå®ä¾‹ä¹‹é—´çš„ç›¸äº’è°ƒç”¨å…³ç³»æ¥è¯´ï¼Œè°ƒç”¨æ–¹ç§°ä¹‹ä¸ºä¸Šæ¸¸èŠ‚ç‚¹(Superior Node)ï¼Œè¢«è°ƒç”¨æ–¹ç§°ä¹‹ä¸ºä¸‹æ¸¸èŠ‚ç‚¹(Subordinate Node)ã€‚</p><hr><h3 id="2PC-Two-Phase-Commitment-Protocol"><a href="#2PC-Two-Phase-Commitment-Protocol" class="headerlink" title="2PC - Two Phase Commitment Protocol"></a>2PC - Two Phase Commitment Protocol</h3><p>2PCåè®®ç»å¸¸è¢«ç”¨æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ä¸€èˆ¬åˆ†ä¸ºåè°ƒå™¨å’Œè‹¥å¹²äº‹åŠ¡æ‰§è¡Œè€…ä¸¤ç§è§’è‰²ï¼Œè¿™é‡Œçš„äº‹åŠ¡æ‰§è¡Œè€…å°±æ˜¯å…·ä½“çš„æ•°æ®åº“ï¼ŒæŠ½è±¡ç‚¹å¯ä»¥è¯´æ˜¯æ§åˆ¶æ•°æ®åº“çš„ç¨‹åºã€‚åè°ƒå™¨å¯ä»¥ç‹¬ç«‹è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å’Œäº‹åŠ¡æ‰§è¡Œå™¨åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚</p><p>2PCåè®®ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>å‡†å¤‡é˜¶æ®µ(æŠ•ç¥¨é˜¶æ®µ)</li><li>æäº¤é˜¶æ®µ(æ‰§è¡Œé˜¶æ®µ)</li></ul><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/2pc-scene.png"><h4 id="2PCã€Paxoså’ŒRaftåè®®ä¹‹é—´çš„åŒºåˆ«"><a href="#2PCã€Paxoså’ŒRaftåè®®ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="2PCã€Paxoså’ŒRaftåè®®ä¹‹é—´çš„åŒºåˆ«"></a>2PCã€Paxoså’ŒRaftåè®®ä¹‹é—´çš„åŒºåˆ«</h4><ul><li>2PCåè®®ç”¨äº<strong>ä¿è¯å¤šä¸ªæ•°æ®åˆ†ç‰‡ä¸Šçš„æ“ä½œçš„åŸå­æ€§</strong>ã€‚è¿™äº›æ•°æ®åˆ†ç‰‡å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œ2PCåè®®ä¿è¯å¤šå°æœåŠ¡å™¨ä¸Šçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>Raftåè®®å’ŒPaxosåè®®éƒ½æ˜¯ç”¨äºä¿è¯<strong>åŒä¸€ä¸ªæ•°æ®åˆ†ç‰‡çš„å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§</strong>ã€‚å½“è¿™äº›å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®ä¸­å¿ƒæ—¶ï¼Œè¿™ä¸ªéœ€æ±‚å°¤å…¶å¼ºçƒˆã€‚</li><li>Raftåè®®æ¯”paxosçš„ä¼˜ç‚¹æ˜¯å®¹æ˜“ç†è§£ï¼Œå®¹æ˜“å®ç°ã€‚å®ƒå¼ºåŒ–äº†leaderçš„åœ°ä½ï¼ŒæŠŠæ•´ä¸ªåè®®å¯ä»¥æ¸…æ¥šçš„åˆ†å‰²æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¹¶åˆ©ç”¨æ—¥å¿—çš„è¿ç»­æ€§åšäº†ä¸€äº›ç®€åŒ–ï¼š(1)Leaderåœ¨æ—¶ã€‚ç”±Leaderå‘FolloweråŒæ­¥æ—¥å¿—ï¼›(2)LeaderæŒ‚æ‰äº†ï¼Œé€‰ä¸€ä¸ªæ–°Leaderçš„Leaderé€‰ä¸¾ç®—æ³•ã€‚</li></ul><h4 id="Phase-é˜¶æ®µè¯´æ˜"><a href="#Phase-é˜¶æ®µè¯´æ˜" class="headerlink" title="Phase - é˜¶æ®µè¯´æ˜"></a>Phase - é˜¶æ®µè¯´æ˜</h4><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/2pc-theory.png"><p><strong>Phase 1 æäº¤äº‹åŠ¡è¯·æ±‚(æŠ•ç¥¨é˜¶æ®µ)</strong></p><ol><li>äº‹åŠ¡è¯¢é—®ï¼šåè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…çš„å“åº”ã€‚</li><li>æ‰§è¡Œäº‹åŠ¡ï¼šå„å‚ä¸è€…èŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoå’ŒRedoä¿¡æ¯è®¡å…¥äº‹åŠ¡æ—¥å¿—ä¸­ã€‚</li><li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”ï¼šå¦‚æœå‚ä¸è€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€…Yeså“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯ä»¥æ‰§è¡Œï¼›å¦‚æœå‚ä¸è€…æ²¡æœ‰æˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€…Noå“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡ä¸å¯ä»¥æ‰§è¡Œã€‚</li></ol><hr><p><strong>Phase 2 æ‰§è¡Œäº‹åŠ¡æäº¤(æ‰§è¡Œé˜¶æ®µ)</strong></p><p>å¦‚æœæ‰€æœ‰å‚ä¸è€…çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆï¼š</p><ol><li>å‘é€æäº¤è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡ºCommitè¯·æ±‚ã€‚</li><li>äº‹åŠ¡æäº¤ï¼šå‚ä¸è€…æ¥æ”¶åˆ°Commitè¯·æ±‚åï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨å®Œæˆæäº¤ä¹‹åé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„äº‹åŠ¡èµ„æºã€‚</li><li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼šå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ã€‚</li><li>å®Œæˆäº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ACKæ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚</li></ol><hr><p><strong>Phase 2 ä¸­æ–­äº‹åŠ¡</strong></p><p>å¦‚æœä»»ä½•ä¸€ä¸ªå‚ä¸è€…åé¦ˆäº†Noå“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…å°šæ— æ³•æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚é‚£ä¹ˆï¼š</p><ol><li>å‘é€å›æ»šè¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡ºRollbackè¯·æ±‚ã€‚</li><li>äº‹åŠ¡å›æ»šï¼šå‚ä¸è€…æ¥æ”¶åˆ°rollbackè¯·æ±‚åï¼Œä¼šåˆ©ç”¨å…¶åœ¨é˜¶æ®µä¸€ä¸­è®°å½•çš„Undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„èµ„æºã€‚</li><li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼šå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ã€‚</li><li>ä¸­æ–­äº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ACKä¿¡æ¯åï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚</li></ol><h4 id="Advantage-and-Disadvantage"><a href="#Advantage-and-Disadvantage" class="headerlink" title="Advantage and Disadvantage"></a>Advantage and Disadvantage</h4><p>Advantageï¼šåŸç†ç®€å•ã€å®ç°æ–¹ä¾¿</p><p>Disadvantageï¼šåŒæ­¥é˜»å¡ã€å•ç‚¹é—®é¢˜ã€æ•°æ®ä¸ä¸€è‡´ã€å®¹é”™æœºåˆ¶</p><ul><li>åŒæ­¥é˜»å¡ï¼šåŒæ­¥é˜»å¡ä¼šæå¤§åœ°é™åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½ã€‚åœ¨Phase 2æäº¤çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å‚ä¸è¯¥äº‹åŠ¡æ“ä½œçš„é€»è¾‘éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œå„ä¸ªå‚ä¸è€…åœ¨ç­‰å¾…å…¶ä»–å‚ä¸è€…å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ— æ³•è¿›è¡Œå…¶ä»–ä»»ä½•æ“ä½œã€‚</li><li>å•ç‚¹é—®é¢˜ï¼šä¸€æ—¦åè°ƒè€…å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªäºŒé˜¶æ®µæäº¤æµç¨‹å°†æ— æ³•è¿è½¬ï¼Œæ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œå¦‚æœæ˜¯åœ¨é˜¶æ®µäºŒä¸­å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå…¶ä»–å‚ä¸è€…å°†ä¼šä¸€ç›´å¤„äºé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚</li><li>æ•°æ®ä¸ä¸€è‡´ï¼šåœ¨é˜¶æ®µäºŒï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€commitè¯·æ±‚ä¹‹åï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–åè°ƒè€…åœ¨å°šæœªå‘å®Œcommitè¯·æ±‚ä¹‹å‰è‡ªèº«å‘ç”Ÿäº†å´©æºƒï¼Œå¯¼è‡´æœ€ç»ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ¥æ”¶åˆ°äº†commitè¯·æ±‚ï¼Œäºæ˜¯éƒ¨åˆ†å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œè€Œæ²¡æ”¶åˆ°commitè¯·æ±‚çš„å‚ä¸è€…åˆ™æ— æ³•è¿›è¡Œäº‹åŠ¡æäº¤ï¼Œäºæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´æ€§ç°è±¡ã€‚</li><li>å®¹é”™æœºåˆ¶ï¼šå¦‚æœå‚ä¸è€…åœ¨ä¸åè°ƒè€…é€šä¿¡æœŸé—´å‡ºç°æ•…éšœï¼Œåè°ƒè€…åªèƒ½é è¶…æ—¶æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­äº‹åŠ¡ï¼Œè¿™ä¸ªç­–ç•¥æ¯”è¾ƒä¿å®ˆï¼Œéœ€è¦æ›´ä¸ºå®Œå–„çš„å®¹é”™æœºåˆ¶ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥ã€‚</li></ul><p><strong>Phase 2æ— æ³•è§£å†³çš„é—®é¢˜ï¼šåè°ƒè€…å†å‘å‡ºcommitæ¶ˆæ¯ä¹‹åå®•æœºï¼Œè€Œå”¯ä¸€æ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸è€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚</strong></p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>å‡è®¾æƒ³ä»æ”¯ä»˜å®é‡Œè½¬10000å…ƒåˆ°ä½™é¢å®</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/2pc-alipay.jpg"><ol><li>é¦–å…ˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‘èµ·ä¸€ä¸ªè¯·æ±‚åˆ°åè°ƒå™¨, ç„¶åç”±æ§åˆ¶å™¨æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li><li>å‡†å¤‡å‡­è¯é˜¶æ®µ<ol><li>åè°ƒå™¨å…ˆå°†<prepare>æ¶ˆæ¯å†™åˆ°æœ¬åœ°æ—¥å¿—ã€‚</prepare></li><li>å‘æ‰€æœ‰çš„å‚ä¸è€…å‘èµ·<prepare>æ¶ˆæ¯ã€‚ä»¥æ”¯ä»˜å®è½¬è´¦åˆ°ä½™é¢å®ä¸ºä¾‹ï¼Œåè°ƒå™¨ç»™Açš„prepareæ¶ˆæ¯æ˜¯é€šçŸ¥æ”¯ä»˜å®æ•°æ®åº“ç›¸åº”è´¦ç›®æ‰£æ¬¾10000ï¼Œåè°ƒå™¨ç»™Bçš„prepareæ¶ˆæ¯æ˜¯é€šçŸ¥ä½™é¢å®æ•°æ®åº“ç›¸åº”è´¦ç›®å¢åŠ 10000ã€‚</prepare></li></ol></li><li>å‚ä¸è€…æ”¶åˆ°<prepare>æ¶ˆæ¯åï¼Œæ‰§è¡Œå…·ä½“æœ¬æœºäº‹åŠ¡ï¼Œä½†ä¸ä¼šè¿›è¡Œcommitï¼Œå¦‚æœæˆåŠŸè¿”å›<yes>ï¼Œä¸æˆåŠŸè¿”å›<no>ã€‚åŒç†ï¼Œè¿”å›å‰éƒ½åº”æŠŠè¦è¿”å›çš„æ¶ˆæ¯å†™åˆ°æ—¥å¿—é‡Œï¼Œå½“ä½œå‡­è¯ã€‚</no></yes></prepare></li><li>åè°ƒå™¨æ”¶é›†æ‰€æœ‰æ‰§è¡Œå™¨è¿”å›çš„æ¶ˆæ¯ï¼Œå¦‚æœæ‰€æœ‰æ‰§è¡Œå™¨éƒ½è¿”å›yesï¼Œé‚£ä¹ˆç»™æ‰€æœ‰æ‰§è¡Œå™¨å‘ç”Ÿé€commitæ¶ˆæ¯ï¼Œæ‰§è¡Œå™¨æ”¶åˆ°commitåæ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„commitæ“ä½œï¼›å¦‚æœæœ‰ä»»ä¸€ä¸ªæ‰§è¡Œå™¨è¿”å›noï¼Œé‚£ä¹ˆç»™æ‰€æœ‰æ‰§è¡Œå™¨å‘é€abortæ¶ˆæ¯ï¼Œæ‰§è¡Œå™¨æ”¶åˆ°abortæ¶ˆæ¯åæ‰§è¡Œäº‹åŠ¡abortæ“ä½œã€‚</li></ol><blockquote><p>åè°ƒå™¨æˆ–å‚ä¸è€…æŠŠå‘é€æˆ–æ¥æ”¶åˆ°çš„æ¶ˆæ¯å…ˆå†™åˆ°æ—¥å¿—é‡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†æ•…éšœåæ¢å¤ç”¨ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æŸä¸ªå‚ä¸è€…ä»æ•…éšœä¸­æ¢å¤åï¼Œå…ˆæ£€æŸ¥æœ¬æœºçš„æ—¥å¿—ï¼Œå¦‚æœå·²æ”¶åˆ°<commit>ï¼Œåˆ™æäº¤ï¼Œå¦‚æœ<abort>åˆ™å›æ»šã€‚å¦‚æœæ˜¯<yes>ï¼Œåˆ™å†å‘æ§åˆ¶å™¨è¯¢é—®ä¸€ä¸‹ï¼Œç¡®å®šä¸‹ä¸€æ­¥ã€‚å¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåˆ™å¾ˆå¯èƒ½åœ¨<prepare>é˜¶æ®µå°±å´©æºƒäº†ï¼Œå› æ­¤éœ€è¦å›æ»šã€‚</prepare></yes></abort></commit></p></blockquote><hr><h3 id="3PC-Three-Phase-Commitment-Protocol"><a href="#3PC-Three-Phase-Commitment-Protocol" class="headerlink" title="3PC - Three Phase Commitment Protocol"></a>3PC - Three Phase Commitment Protocol</h3><p>å¯¹æ¯”2PCï¼Œ3PCçš„å˜åŒ–ï¼š</p><ol><li>å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚</li><li>åœ¨ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µã€‚ä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</li></ol><p>3PCè§£å†³äº†2PCçš„é˜»å¡é—®é¢˜ï¼Œä½†ä»ç„¶æ²¡æœ‰è§£å†³å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/3pc.png"><p>Three-Phase Commitï¼š</p><ul><li>CanCommit</li><li>PreCommit</li><li>DoCommit</li></ul><p>ä¸ºäº†é¿å…åœ¨é€šçŸ¥æ‰€æœ‰å‚ä¸è€…æäº¤äº‹åŠ¡æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå‚ä¸è€…crashä¸ä¸€è‡´æ—¶ï¼Œå°±å‡ºç°äº†ä¸‰é˜¶æ®µæäº¤çš„æ–¹å¼ã€‚ä¸‰é˜¶æ®µæäº¤åœ¨ä¸¤é˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªpreCommitçš„è¿‡ç¨‹ï¼Œå½“æ‰€æœ‰å‚ä¸è€…æ”¶åˆ°preCommitåï¼Œå¹¶ä¸æ‰§è¡ŒåŠ¨ä½œï¼Œç›´åˆ°æ”¶åˆ°commitæˆ–è¶…è¿‡ä¸€å®šæ—¶é—´åæ‰å®Œæˆæ“ä½œã€‚</p><h4 id="Phase-é˜¶æ®µè¯´æ˜-1"><a href="#Phase-é˜¶æ®µè¯´æ˜-1" class="headerlink" title="Phase - é˜¶æ®µè¯´æ˜"></a>Phase - é˜¶æ®µè¯´æ˜</h4><p><strong>Phase 1 CanCommit</strong></p><ol><li>äº‹åŠ¡è¯¢é—®ï¼šåè°ƒè€…å‘å„å‚ä¸è€…å‘é€CanCommitçš„è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…çš„å“åº”ã€‚</li><li>å‚ä¸è€…å‘åè°ƒè€…åé¦ˆè¯¢é—®çš„å“åº”ï¼šå‚ä¸è€…æ”¶åˆ°CanCommitè¯·æ±‚åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœè‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œé‚£ä¹ˆä¼šåé¦ˆYeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™åé¦ˆNoã€‚</li></ol><hr><p><strong>Phase 2 Pre Commit</strong></p><p>å¦‚æœåè°ƒè€…æ¥æ”¶åˆ°å„å‚ä¸è€…åé¦ˆéƒ½æ˜¯Yesï¼Œé‚£ä¹ˆæ‰§è¡Œäº‹åŠ¡é¢„æäº¤ï¼š</p><ol><li>å‘é€é¢„æäº¤è¯·æ±‚ï¼šåè°ƒè€…å‘å„å‚ä¸è€…å‘é€preCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥preparedé˜¶æ®µã€‚</li><li>äº‹åŠ¡é¢„æäº¤ï¼šå‚ä¸è€…æ¥æ”¶åˆ°preCommitè¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoå’ŒRedoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥è®°ä¸­ã€‚</li><li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡æ‰§è¡Œçš„å“åº”ï¼šå¦‚æœå„å‚ä¸è€…éƒ½æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆåé¦ˆç»™åè°ƒè€…Ackå“åº”ï¼ŒåŒæ—¶ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ï¼Œæäº¤commitæˆ–è€…ç»ˆæ­¢abortã€‚</li></ol><p>å¦‚æœä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº†Noå“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶åï¼Œåè°ƒè€…æ— æ³•æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ï¼š</p><ol><li>å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚ã€‚</li><li>ä¸­æ–­äº‹åŠ¡ï¼šæ— è®ºæ˜¯æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ï¼Œè¿˜æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œå‚ä¸è€…éƒ½ä¸­æ–­äº‹åŠ¡ã€‚</li></ol><hr><p><strong>Phase 3 Do Commit</strong></p><p>å‡è®¾åè°ƒè€…æ­£å¸¸å·¥ä½œï¼Œæ¥æ”¶åˆ°äº†æ‰€æœ‰å‚ä¸è€…çš„ackå“åº”ï¼Œé‚£ä¹ˆå®ƒå°†ä»é¢„æäº¤é˜¶æ®µè¿›å…¥æäº¤çŠ¶æ€ï¼š</p><ol><li>å‘é€æäº¤è¯·æ±‚ï¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€doCommitè¯·æ±‚ã€‚</li><li>äº‹åŠ¡æäº¤ï¼šå‚ä¸è€…æ”¶åˆ°doCommitè¯·æ±‚åï¼Œæ­£å¼æäº¤äº‹åŠ¡ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤åé‡Šæ”¾å ç”¨çš„èµ„æºã€‚</li><li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼šå‚ä¸è€…å®Œæˆäº‹åŠ¡æäº¤åï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ã€‚</li><li>å®Œæˆäº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…ackä¿¡æ¯ï¼Œå®Œæˆäº‹åŠ¡ã€‚</li></ol><p>å‡è®¾åè°ƒè€…æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æœ‰ä»»ä¸€å‚ä¸è€…åé¦ˆNoï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶åæ— æ³•æ¥æ”¶æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆï¼Œéƒ½ä¼šä¸­æ–­äº‹åŠ¡ï¼š</p><ol><li>å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘é€abortè¯·æ±‚ã€‚</li><li>äº‹åŠ¡å›æ»šï¼šå‚ä¸è€…æ¥æ”¶åˆ°abortè¯·æ±‚åï¼Œåˆ©ç”¨undoæ—¥å¿—æ‰§è¡Œäº‹åŠ¡å›æ»šï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡å›æ»šåé‡Šæ”¾å ç”¨çš„èµ„æºã€‚</li><li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼šå‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ã€‚</li><li>ä¸­æ–­äº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ackä¿¡æ¯åï¼Œä¸­æ–­äº‹åŠ¡ã€‚</li></ol><p>åœ¨DoCommité˜¶æ®µï¼Œå¦‚æœå‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…rebortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚</p><p>å…¶å®è¿™ä¸ªåº”è¯¥æ˜¯åŸºäºæ¦‚ç‡æ¥å†³å®šçš„ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œè¯´æ˜å‚ä¸è€…åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»æ”¶åˆ°äº†PreCommitè¯·æ±‚ï¼Œé‚£ä¹ˆåè°ƒè€…äº§ç”ŸPreCommitè¯·æ±‚çš„å‰ææ¡ä»¶æ˜¯ä»–åœ¨ç¬¬äºŒé˜¶æ®µå¼€å§‹ä¹‹å‰ï¼Œæ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„CanCommitå“åº”éƒ½æ˜¯Yes(ä¸€æ—¦å‚ä¸è€…æ”¶åˆ°äº†PreCommitï¼Œæ„å‘³ä»–çŸ¥é“å¤§å®¶å…¶å®éƒ½åŒæ„ä¿®æ”¹äº†)ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œç”±äºç½‘ç»œè¶…æ—¶ç­‰åŸå› ï¼Œè™½ç„¶å‚ä¸è€…æ²¡æœ‰æ”¶åˆ°commitæˆ–è€…abortå“åº”ï¼Œä½†æ˜¯ä»–æœ‰ç†ç”±ç›¸ä¿¡ï¼šæˆåŠŸæäº¤çš„å‡ ç‡å¾ˆå¤§ã€‚</p><h4 id="Advantage-and-Disadvantage-1"><a href="#Advantage-and-Disadvantage-1" class="headerlink" title="Advantage and Disadvantage"></a>Advantage and Disadvantage</h4><p>Advantageï¼šé™ä½å‚ä¸è€…é˜»å¡èŒƒå›´ï¼Œå¹¶èƒ½å¤Ÿåœ¨å‡ºç°å•ç‚¹æ•…éšœåç»§ç»­è¾¾æˆä¸€è‡´ã€‚</p><p>Disadvantageï¼šåœ¨DoCommité˜¶æ®µå¦‚æœå‡ºç°ç½‘ç»œåˆ†åŒºï¼Œåè°ƒè€…æ— æ³•ä¸å‚ä¸è€…æ­£å¸¸é€šä¿¡ï¼Œå‚ä¸è€…ä¾ç„¶ä¼šè¿›è¡Œäº‹åŠ¡æäº¤ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</p><h3 id="J2EE-åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#J2EE-åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="J2EE åˆ†å¸ƒå¼äº‹åŠ¡"></a>J2EE åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>Javaäº‹åŠ¡ç¼–ç¨‹æ¥å£(JTAï¼šJava Transaction API)å’Œ Javaäº‹åŠ¡æœåŠ¡(JTSï¼›Java Transaction Service)ä¸ºJ2EEå¹³å°æä¾›äº†åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p><p>JTAå®šä¹‰äº†ä¸€å¥—æ¥å£ï¼Œå…¶ä¸­çº¦å®šäº†å‡ ç§ä¸»è¦çš„è§’è‰²ï¼šTransactionManagerã€UserTransactionã€Transactionã€XAResourceï¼Œå¹¶å®šä¹‰äº†è¿™äº›è§’è‰²ä¹‹é—´éœ€è¦éµå®ˆçš„è§„èŒƒï¼Œå¦‚Transactionçš„å§”æ‰˜ç»™TransactionManagerç­‰ã€‚</p><p>JTSä¹Ÿæ˜¯ä¸€ç»„è§„èŒƒï¼Œä¸Šé¢æåˆ°JTAä¸­éœ€è¦è§’è‰²ä¹‹é—´çš„äº¤äº’ï¼Œé‚£åº”è¯¥å¦‚ä½•äº¤äº’ï¼ŸJTSå°±æ˜¯çº¦å®šäº†äº¤äº’ç»†èŠ‚çš„è§„èŒƒã€‚</p><p>æ€»ä½“ä¸Šæ¥è¯´JTAæ›´å¤šçš„æ˜¯ä»æ¡†æ¶çš„è§’åº¦æ¥çº¦å®šç¨‹åºè§’è‰²çš„æ¥å£ï¼Œè€ŒJTSåˆ™æ˜¯ä»å…·ä½“å®ç°çš„è§’åº¦æ¥çº¦å®šç¨‹åºè§’è‰²ä¹‹é—´çš„æ¥å£ï¼Œä¸¤è€…å„å¸å…¶èŒã€‚</p><img src="/2019/01/11/DistributedSystem/Transaction/Introduction-Distributed-Transaction/j2ee-jta.png"><h4 id="JTA"><a href="#JTA" class="headerlink" title="JTA"></a>JTA</h4><p>Example</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transferAccount</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    UserTransaction userTx = <span class="keyword">null</span>; </span><br><span class="line">    Connection connA = <span class="keyword">null</span>; </span><br><span class="line">    Statement stmtA = <span class="keyword">null</span>; </span><br><span class="line">            </span><br><span class="line">    Connection connB = <span class="keyword">null</span>; </span><br><span class="line">    Statement stmtB = <span class="keyword">null</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123; </span><br><span class="line">        <span class="comment">// è·å¾— Transaction ç®¡ç†å¯¹è±¡</span></span><br><span class="line">        userTx = (UserTransaction)getContext().lookup(<span class="string">"java:comp/UserTransaction"</span>); </span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ A ä¸­å–å¾—æ•°æ®åº“è¿æ¥</span></span><br><span class="line">        connA = getDataSourceA().getConnection(); </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ B ä¸­å–å¾—æ•°æ®åº“è¿æ¥</span></span><br><span class="line">        connB = getDataSourceB().getConnection(); </span><br><span class="line">    </span><br><span class="line">        <span class="comment">// å¯åŠ¨äº‹åŠ¡</span></span><br><span class="line">        userTx.begin();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°† A è´¦æˆ·ä¸­çš„é‡‘é¢å‡å°‘ 500 </span></span><br><span class="line">        stmtA = connA.createStatement(); </span><br><span class="line">        stmtA.execute(<span class="string">"update t_account set amount = amount - 500 where account_id = 'A'"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°† B è´¦æˆ·ä¸­çš„é‡‘é¢å¢åŠ  500 </span></span><br><span class="line">        stmtB = connB.createStatement(); </span><br><span class="line">        stmtB.execute(<span class="string">"update t_account set amount = amount + 500 where account_id = 'B'"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">        userTx.commit();</span><br><span class="line">        <span class="comment">// äº‹åŠ¡æäº¤ï¼šè½¬è´¦çš„ä¸¤æ­¥æ“ä½œåŒæ—¶æˆåŠŸï¼ˆæ•°æ®åº“ A å’Œæ•°æ®åº“ B ä¸­çš„æ•°æ®è¢«åŒæ—¶æ›´æ–°ï¼‰</span></span><br><span class="line">    &#125; <span class="keyword">catch</span>(SQLException sqle)&#123; </span><br><span class="line">        <span class="keyword">try</span>&#123; </span><br><span class="line">            <span class="comment">// å‘ç”Ÿå¼‚å¸¸ï¼Œå›æ»šåœ¨æœ¬äº‹åŠ¡ä¸­çš„æ“çºµ</span></span><br><span class="line">            userTx.rollback();</span><br><span class="line">            <span class="comment">// äº‹åŠ¡å›æ»šï¼šè½¬è´¦çš„ä¸¤æ­¥æ“ä½œå®Œå…¨æ’¤é”€ </span></span><br><span class="line">            <span class="comment">//( æ•°æ®åº“ A å’Œæ•°æ®åº“ B ä¸­çš„æ•°æ®æ›´æ–°è¢«åŒæ—¶æ’¤é”€ï¼‰</span></span><br><span class="line">            stmt.close(); </span><br><span class="line">            conn.close(); </span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception ignore)&#123; </span><br><span class="line">            </span><br><span class="line">        &#125; </span><br><span class="line">        sqle.printStackTrace(); </span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception ne)&#123; </span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote><p><a href="https://yq.aliyun.com/articles/582282" target="_blank" rel="noopener">https://yq.aliyun.com/articles/582282</a><br><a href="http://xiaorui.cc/2016/02/25/%E7%90%86%E8%A7%A3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A42pc/" target="_blank" rel="noopener">http://xiaorui.cc/2016/02/25/%E7%90%86%E8%A7%A3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A42pc/</a><br><a href="https://my.oschina.net/fileoptions/blog/886967#comments" target="_blank" rel="noopener">https://my.oschina.net/fileoptions/blog/886967#comments</a><br><a href="https://segmentfault.com/a/1190000004474543" target="_blank" rel="noopener">https://segmentfault.com/a/1190000004474543</a><br>æµ…è°ˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶åœ¨é“¶è¡Œåº”ç”¨çš„å®ç°: <a href="https://www.ctolib.com/topics-117188.html" target="_blank" rel="noopener">https://www.ctolib.com/topics-117188.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;ä¼ ç»Ÿå•æœºåº”ç”¨ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œå¥½å¤„æ˜¯åº”ç”¨å¯ä»¥ä½¿ç”¨
      
    
    </summary>
    
      <category term="DistributedSystem" scheme="https://sulangsss.github.io/categories/DistributedSystem/"/>
    
      <category term="Transaction" scheme="https://sulangsss.github.io/categories/DistributedSystem/Transaction/"/>
    
    
      <category term="DistributedSystem" scheme="https://sulangsss.github.io/tags/DistributedSystem/"/>
    
      <category term="Introduction" scheme="https://sulangsss.github.io/tags/Introduction/"/>
    
      <category term="DistributedTransaction" scheme="https://sulangsss.github.io/tags/DistributedTransaction/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="https://sulangsss.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Technology Stack On DB</title>
    <link href="https://sulangsss.github.io/2019/01/11/DB/TechStack/"/>
    <id>https://sulangsss.github.io/2019/01/11/DB/TechStack/</id>
    <published>2019-01-11T04:19:22.000Z</published>
    <updated>2019-01-28T02:48:35.455Z</updated>
    
    <content type="html"><![CDATA[<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="Operation"><a href="#Operation" class="headerlink" title="Operation"></a>Operation</h4><ul><li>percona-toolkitï¼šä¸€ç»„é«˜çº§å‘½ä»¤è¡Œå·¥å…·çš„é›†åˆï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰æœåŠ¡çš„æ‘˜è¦ä¿¡æ¯ï¼Œç£ç›˜æ£€æµ‹ï¼Œåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒæŸ¥æ‰¾é‡å¤ç´¢å¼•ï¼Œå®ç°è¡¨åŒæ­¥ç­‰ç­‰ã€‚</li><li>Percona XtraBackupï¼šç®€ç§°PXBï¼Œæ˜¯Perconaå…¬å¸å¼€å‘çš„ä¸€ä¸ªç”¨äºMySQLæ•°æ®åº“ç‰©ç†çƒ­å¤‡çš„å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒ MySQlï¼ˆOracleï¼‰ã€Percona Server å’Œ MariaDBã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;MySQL&quot;&gt;&lt;a href=&quot;#MySQL&quot; class=&quot;headerlink&quot; title=&quot;MySQL&quot;&gt;&lt;/a&gt;MySQL&lt;/h3&gt;&lt;h4 id=&quot;Operation&quot;&gt;&lt;a href=&quot;#Operation&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
      <category term="DB" scheme="https://sulangsss.github.io/categories/DB/"/>
    
    
      <category term="DB" scheme="https://sulangsss.github.io/tags/DB/"/>
    
      <category term="TechStack" scheme="https://sulangsss.github.io/tags/TechStack/"/>
    
  </entry>
  
</feed>
