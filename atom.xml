<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>A Big Boy Blog -  Tech Articls &amp; Notes</title>
  
  <subtitle>Python Java Android Django Web -&gt; sulang357159@gmail.com</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://sulangsss.github.io/"/>
  <updated>2019-08-03T15:26:15.497Z</updated>
  <id>https://sulangsss.github.io/</id>
  
  <author>
    <name>Jason - sulang357159@163.com</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Java Executors</title>
    <link href="https://sulangsss.github.io/2019/08/03/Java/Thread/Executors/"/>
    <id>https://sulangsss.github.io/2019/08/03/Java/Thread/Executors/</id>
    <published>2019-08-03T12:22:22.000Z</published>
    <updated>2019-08-03T15:26:15.497Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>自 JDK 1.5 起，utils 包提供了 ExecutorService 线程池的实现，主要目的是为了重复利用线程，提供系统效率。</p><p>线程数量和系统性能是一种抛物线的关系，即当线程数量达到某个值的时候，性能反倒会降低很多，因此对线程的管理，尤其是数量的控制更能直接决定程序的性能。</p><blockquote><p>JUC: JDK 的 Java utilities concurrent</p></blockquote><h3 id="ExecutorService-Implementation-Class"><a href="#ExecutorService-Implementation-Class" class="headerlink" title="ExecutorService Implementation Class"></a>ExecutorService Implementation Class</h3><ul><li>ScheduledExecutorService</li><li>ThreadPoolExecutor</li><li>ScheduledThreadPoolExecutor</li></ul><h4 id="Thread-Factory-Class"><a href="#Thread-Factory-Class" class="headerlink" title="Thread Factory Class"></a>Thread Factory Class</h4><ul><li>newSingleThreadExecutor: 创建一个单线程的线程池。这个线程池只有一个线程在工作，也就是相当于单线程串行执行所有任务。如果这个唯一的线程因为异常结束，那么会有一个新的线程来替代它。此线程池保证所有任务的执行顺序按照任务的提交顺序执行。</li><li>newFixedThreadPool: 创建固定大小的线程池。每次提交一个任务就创建一个线程，直到线程达到线程池的最大大小。线程池的大小一旦达到最大值就会保持不变，在提交新任务，任务将会进入等待队列中等待。如果某个线程因为执行异常而结束，那么线程池会补充一个新线程。</li><li>newCachedThreadPool: 创建一个可缓存的线程池。如果线程池的大小超过了处理任务所需要的线程，那么就会回收部分空闲（60秒处于等待任务到来）的线程，当任务数增加时，此线程池又可以智能的添加新线程来处理任务。此线程池的最大值是Integer的最大值(2^31-1)。</li><li>newScheduledThreadPool: 创建一个大小无限的线程池。此线程池支持定时以及周期性执行任务的需求。</li><li>newWorkStealingPool: 创建一个带并行级别的线程池，并行级别决定了同一时刻最多有多少个线程在执行，默认并行级别为当前系统的CPU个数。</li></ul><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li>[Java Executor并发框架（一）整体介绍]<a href="https://www.cnblogs.com/vhua/p/5277694.html" target="_blank" rel="noopener">https://www.cnblogs.com/vhua/p/5277694.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;自 JDK 1.5 起，utils 包提供了 Executo
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Thread" scheme="https://sulangsss.github.io/categories/Java/Thread/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="Thread" scheme="https://sulangsss.github.io/tags/Thread/"/>
    
      <category term="Executors" scheme="https://sulangsss.github.io/tags/Executors/"/>
    
  </entry>
  
  <entry>
    <title>DataBase Architecture Basic Knowledge</title>
    <link href="https://sulangsss.github.io/2019/08/03/DB/Basic/DataBase-Architecture-Basic-Knowledge/"/>
    <id>https://sulangsss.github.io/2019/08/03/DB/Basic/DataBase-Architecture-Basic-Knowledge/</id>
    <published>2019-08-03T03:13:18.000Z</published>
    <updated>2019-08-03T04:50:17.067Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h3><p>数据库按照数据结构来组织、存储和管理数据，实际上，数据库一共有三种模型：</p><ul><li>层次模型</li><li>网状模型</li><li>关系模型</li></ul><h4 id="层次模型"><a href="#层次模型" class="headerlink" title="层次模型"></a>层次模型</h4><img src="/2019/08/03/DB/Basic/DataBase-Architecture-Basic-Knowledge/layout-model.png"><p>层次模型就是以“上下级”的层次关系来组织数据的一种方式，层次模型的数据结构看起来就像一颗树。</p><h4 id="网状模型"><a href="#网状模型" class="headerlink" title="网状模型"></a>网状模型</h4><img src="/2019/08/03/DB/Basic/DataBase-Architecture-Basic-Knowledge/net-model.png"><p>网状模型把每个数据节点和其他很多节点都连接起来，它的数据结构看起来就像很多城市之间的路网。</p><h4 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h4><img src="/2019/08/03/DB/Basic/DataBase-Architecture-Basic-Knowledge/relationship-model.png"><p>关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表。</p><p>随着时间的推移和市场竞争，最终，基于关系模型的关系数据库获得了绝对市场份额。为什么关系数据库获得了最广泛的应用？</p><hr><h3 id="SQL-Structured-Query-Language"><a href="#SQL-Structured-Query-Language" class="headerlink" title="SQL - Structured Query Language"></a>SQL - Structured Query Language</h3><p>什么是SQL？SQL是结构化查询语言的缩写，用来访问和操作数据库系统。SQL语句既可以查询数据库中的数据，也可以添加、更新和删除数据库中的数据，还可以对数据库进行管理和维护操作。不同的数据库，都支持SQL，这样，我们通过学习SQL这一种语言，就可以操作各种不同的数据库。</p><p>虽然SQL已经被ANSI组织定义为标准，不幸地是，各个不同的数据库对标准的SQL支持不太一致。并且，大部分数据库都在标准的SQL上做了扩展。也就是说，如果只使用标准SQL，理论上所有数据库都可以支持，但如果使用某个特定数据库的扩展SQL，换一个数据库就不能执行了。例如，Oracle把自己扩展的SQL称为PL/SQL，Microsoft把自己扩展的SQL称为T-SQL。</p><p>现实情况是，如果我们只使用标准SQL的核心功能，那么所有数据库通常都可以执行。不常用的SQL功能，不同的数据库支持的程度都不一样。而各个数据库支持的各自扩展的功能，通常我们把它们称之为“方言”。</p><p>总的来说，SQL语言定义了这么几种操作数据库的能力：</p><ul><li>DDL - Data Definition Language: DDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL由数据库管理员执行。</li><li>DML - Data Manipulation Language: DML为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作。</li><li>DQL - Data Query Language: DQL允许用户查询数据，这也是通常最频繁的数据库日常操作。</li></ul><blockquote><p>SQL语言关键字不区分大小写！但是，针对不同的数据库，对于表名和列名，有的数据库区分大小写，有的数据库不区分大小写。同一个数据库，有的在Linux上区分大小写，有的在Windows上不区分大小写。</p></blockquote><hr><h3 id="DB-Engine"><a href="#DB-Engine" class="headerlink" title="DB Engine"></a>DB Engine</h3><ul><li>InnoDB(MySQL)</li><li>MyISAM(MySQL)</li><li>PBXT</li><li>TokuDB(MySQL)</li><li>XtraDB(MariaDB)</li></ul><h4 id="XtraDB"><a href="#XtraDB" class="headerlink" title="XtraDB"></a>XtraDB</h4><p>XtraDB是由Percona开发的一款MySQL数据库的高性能存储引擎，其目的是用来代替InnoDB存储引擎，可用于需要更高性能的环境。XtraDB可以看作是InnoDB存储引擎的增强版本，它在InnoDB上进行了大量的修改和补丁，它完全兼容InnoDB，且提供了很多InnoDB不具备的有用的功能。</p><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li>[关系数据库概述]<a href="https://www.liaoxuefeng.com/wiki/1177760294764384/1179613436834240" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1177760294764384/1179613436834240</a></li><li>[TokuDB引擎特性揭秘]<a href="http://mysql.taobao.org/monthly/2017/07/04/" target="_blank" rel="noopener">http://mysql.taobao.org/monthly/2017/07/04/</a></li><li>[MySQL高可用性解决方案—Percona XtraDB Cluster]<a href="https://cloud.tencent.com/developer/article/1056472" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1056472</a></li><li>[TokuDB性能测试报告]<a href="https://zhuanlan.zhihu.com/p/25743441" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25743441</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Data-Model&quot;&gt;&lt;a href=&quot;#Data-Model&quot; class=&quot;headerlink&quot; title=&quot;Data Model&quot;&gt;&lt;/a&gt;Data Model&lt;/h3&gt;&lt;p&gt;数据库按照数据结构来组织、存储和管理数据，实际上，数据库一共有三种模型：&lt;/
      
    
    </summary>
    
      <category term="DB" scheme="https://sulangsss.github.io/categories/DB/"/>
    
      <category term="Basic" scheme="https://sulangsss.github.io/categories/DB/Basic/"/>
    
    
      <category term="Architecture" scheme="https://sulangsss.github.io/tags/Architecture/"/>
    
      <category term="DB" scheme="https://sulangsss.github.io/tags/DB/"/>
    
      <category term="Baisc Knowledge" scheme="https://sulangsss.github.io/tags/Baisc-Knowledge/"/>
    
  </entry>
  
  <entry>
    <title>Kuberntes sysctls</title>
    <link href="https://sulangsss.github.io/2019/07/27/Kubenetes/Using-sysctls/"/>
    <id>https://sulangsss.github.io/2019/07/27/Kubenetes/Using-sysctls/</id>
    <published>2019-07-27T02:11:22.000Z</published>
    <updated>2019-07-27T04:16:40.361Z</updated>
    
    <content type="html"><![CDATA[<h3 id="PodSecurityPolicy"><a href="#PodSecurityPolicy" class="headerlink" title="PodSecurityPolicy"></a>PodSecurityPolicy</h3><p>version at least v1.11</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">policy/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PodSecurityPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">sysctl-psp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  allowedUnsafeSysctls:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">kernel.msg*</span></span><br><span class="line"><span class="attr">  forbiddenSysctls:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">kernel.shm_rmid_forced</span></span><br></pre></td></tr></table></figure><h3 id="Sysctls"><a href="#Sysctls" class="headerlink" title="Sysctls"></a>Sysctls</h3><p>Sysctls 允许容器设置内核参数，分为安全 Sysctls 和非安全 Sysctls</p><p>安全 Sysctls：即设置后不影响其他 Pod 的内核选项，只作用在容器 namespace 中，默认开启。包括以下几种</p><ul><li>kernel.shm_rmid_forced</li><li>net.ipv4.ip_local_port_range</li><li>net.ipv4.tcp_syncookies</li></ul><p>非安全 Sysctls：即设置好有可能影响其他 Pod 和 Node 上其他服务的内核选项，默认禁止。如果使用，需要管理员在配置 kubelet 时开启，如 </p><ul><li>kubelet –experimental-allowed-unsafe-sysctls ‘kernel.msg*,net.ipv4.route.min_pmtu’</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">    securityContext:</span></span><br><span class="line"><span class="attr">    privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    sysctls:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">net.core.rmem_max</span></span><br><span class="line"><span class="attr">        value:</span> <span class="string">"4194304"</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">net.core.rmem_default</span></span><br><span class="line"><span class="attr">        value:</span> <span class="string">"2097152"</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">net.core.wmem_max</span></span><br><span class="line"><span class="attr">        value:</span> <span class="string">"4194304"</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">net.core.wmem_default</span></span><br><span class="line"><span class="attr">        value:</span> <span class="string">"2097152"</span></span><br></pre></td></tr></table></figure><p>SysctlForbidden</p><h4 id="Enabling-Unsafe-Sysctls"><a href="#Enabling-Unsafe-Sysctls" class="headerlink" title="Enabling Unsafe Sysctls"></a>Enabling Unsafe Sysctls</h4><p>如果要在 Kuberntes 上进行修改，那如何操作？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubelet --experimental-allowed-unsafe-sysctls <span class="string">'kernel.msg*,kernel.shmmax,kernel.sem,net.ipv4.route.min_pmtu'</span></span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://kubernetes.io/docs/tasks/administer-cluster/sysctl-cluster/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/administer-cluster/sysctl-cluster/</a></li><li><a href="https://www.cnblogs.com/DaweiJ/articles/8528687.html" target="_blank" rel="noopener">https://www.cnblogs.com/DaweiJ/articles/8528687.html</a></li><li><a href="https://www.cnblogs.com/DaweiJ/articles/8529706.html" target="_blank" rel="noopener">https://www.cnblogs.com/DaweiJ/articles/8529706.html</a></li><li>[Pod 安全策略]<a href="https://kubernetes.io/zh/docs/concepts/policy/pod-security-policy/" target="_blank" rel="noopener">https://kubernetes.io/zh/docs/concepts/policy/pod-security-policy/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;PodSecurityPolicy&quot;&gt;&lt;a href=&quot;#PodSecurityPolicy&quot; class=&quot;headerlink&quot; title=&quot;PodSecurityPolicy&quot;&gt;&lt;/a&gt;PodSecurityPolicy&lt;/h3&gt;&lt;p&gt;version at
      
    
    </summary>
    
      <category term="Kuberntes" scheme="https://sulangsss.github.io/categories/Kuberntes/"/>
    
    
      <category term="Kuberntes" scheme="https://sulangsss.github.io/tags/Kuberntes/"/>
    
      <category term="sysctls" scheme="https://sulangsss.github.io/tags/sysctls/"/>
    
      <category term="Kernel" scheme="https://sulangsss.github.io/tags/Kernel/"/>
    
  </entry>
  
  <entry>
    <title>Netty WebSocket</title>
    <link href="https://sulangsss.github.io/2019/07/24/Java/Netty/WebSocket/"/>
    <id>https://sulangsss.github.io/2019/07/24/Java/Netty/WebSocket/</id>
    <published>2019-07-24T06:00:22.000Z</published>
    <updated>2019-07-24T07:05:21.115Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h3><hr><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><hr><h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><hr><h3 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h3><h4 id="io-netty-handler-ssl-NotSslRecordException-not-an-SSL-TLS-record"><a href="#io-netty-handler-ssl-NotSslRecordException-not-an-SSL-TLS-record" class="headerlink" title="io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record"></a>io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record</h4><p>在Netty中，如果开启了https，但是你使用http请求来发送请求，那么会打印一个SSL/TLS异常</p><h4 id="javax-net-ssl-SSLException-Received-fatal-alert-handshake-failure"><a href="#javax-net-ssl-SSLException-Received-fatal-alert-handshake-failure" class="headerlink" title="javax.net.ssl.SSLException: Received fatal alert: handshake_failure"></a>javax.net.ssl.SSLException: Received fatal alert: handshake_failure</h4><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://waylau.com/netty-websocket-chat/" target="_blank" rel="noopener">https://waylau.com/netty-websocket-chat/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Theory&quot;&gt;&lt;a href=&quot;#Theory&quot; class=&quot;headerlink&quot; title=&quot;Theory&quot;&gt;&lt;/a&gt;Theory&lt;/h3&gt;&lt;hr&gt;
&lt;h3 id=&quot;Server&quot;&gt;&lt;a href=&quot;#Server&quot; class=&quot;headerlink&quot;
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Netty" scheme="https://sulangsss.github.io/categories/Java/Netty/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="Netty" scheme="https://sulangsss.github.io/tags/Netty/"/>
    
      <category term="WebSocket" scheme="https://sulangsss.github.io/tags/WebSocket/"/>
    
  </entry>
  
  <entry>
    <title>Vscode Vue</title>
    <link href="https://sulangsss.github.io/2019/07/22/Tools/Vscode/Vscode-Vue/"/>
    <id>https://sulangsss.github.io/2019/07/22/Tools/Vscode/Vscode-Vue/</id>
    <published>2019-07-21T16:54:06.000Z</published>
    <updated>2019-07-21T16:17:26.244Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li>[vscode中开发vue的最佳实践]<a href="https://github.com/coppyC/blog/issues/1" target="_blank" rel="noopener">https://github.com/coppyC/blog/issues/1</a></li><li>[vscode 插件推荐]<a href="https://segmentfault.com/a/1190000006697219" target="_blank" rel="noopener">https://segmentfault.com/a/1190000006697219</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;[vscode中开发vue的最佳实践]&lt;a href=&quot;https://
      
    
    </summary>
    
      <category term="Tools" scheme="https://sulangsss.github.io/categories/Tools/"/>
    
      <category term="VsCode" scheme="https://sulangsss.github.io/categories/Tools/VsCode/"/>
    
    
      <category term="Tools" scheme="https://sulangsss.github.io/tags/Tools/"/>
    
      <category term="VsCode" scheme="https://sulangsss.github.io/tags/VsCode/"/>
    
      <category term="Vue" scheme="https://sulangsss.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Vue QuickStart</title>
    <link href="https://sulangsss.github.io/2019/07/20/FrontEnd/Vue/QuickStart/"/>
    <id>https://sulangsss.github.io/2019/07/20/FrontEnd/Vue/QuickStart/</id>
    <published>2019-07-20T15:40:22.000Z</published>
    <updated>2019-07-23T11:04:54.360Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><ul><li>vue: npm install -g vue</li><li>vue-cil: npm install -g @vue/cli</li><li>vue-i18n: npm install -g vue-i18n</li></ul><blockquote><p><a href="https://juejin.im/post/5d0259f2518825405d15ae62" target="_blank" rel="noopener">Vue3.0 前的 TypeScript 最佳入门实践</a><br><a href="https://www.npmjs.cn/getting-started/installing-node/" target="_blank" rel="noopener">npm 快速入门</a></p></blockquote><hr><h3 id="Launch-App"><a href="#Launch-App" class="headerlink" title="Launch App"></a>Launch App</h3><ol><li><p>create hello app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create my-app</span><br></pre></td></tr></table></figure></li><li><p>launch app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="Project-Architecture"><a href="#Project-Architecture" class="headerlink" title="Project Architecture"></a>Project Architecture</h3><p>main.js 是我们的入口文件，主要作用是初始化vue实例并使用需要的插件。App.vue是我们的主组件，所有页面都是在App.vue下进行切换的。</p><blockquote><p><a href="https://segmentfault.com/a/1190000014456796" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014456796</a></p></blockquote><hr><h3 id="UI-Framework"><a href="#UI-Framework" class="headerlink" title="UI Framework"></a>UI Framework</h3><h4 id="Ant-Design"><a href="#Ant-Design" class="headerlink" title="Ant Design"></a>Ant Design</h4><ol><li><p>install </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save ant-design-vue</span><br></pre></td></tr></table></figure></li><li><p>import all components</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Antd <span class="keyword">from</span> <span class="string">'ant-design-vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'ant-design-vue/dist/antd.css'</span></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Vue.use(Antd)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://vue.ant.design/docs/vue/getting-started-cn/" target="_blank" rel="noopener">Ant Designe 快速上手</a></p></blockquote><ol start="3"><li>Example Template</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">"ts"</span>&gt;</span><br><span class="line">    <span class="keyword">import</span> &#123;Component, Prop, Vue&#125; <span class="keyword">from</span> <span class="string">"vue-property-decorator"</span>;</span><br><span class="line"></span><br><span class="line">    @Component</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style scoped&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="px-to-rem"><a href="#px-to-rem" class="headerlink" title="px to rem"></a>px to rem</h3><p>create file <strong>.postcss.js</strong> on root direcotry</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">        <span class="string">"postcss-import"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"postcss-url"</span>: &#123;&#125;,</span><br><span class="line">        <span class="comment">// to edit target browsers: use "browserslist" field in package.json</span></span><br><span class="line">        <span class="string">"autoprefixer"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"postcss-pxtorem"</span>: &#123; <span class="comment">// 此处为添加部分</span></span><br><span class="line">            rootValue: <span class="number">32</span>, <span class="comment">//  根元素(html)的字体大小。可根据js动态设置的html的font-size大小进行设置。对应16px 适配移动端750px宽度</span></span><br><span class="line">            unitPrecision: <span class="number">5</span>, <span class="comment">// 计算后的最小精度值，默认保留的就是5位, 最小精度，小数点位数</span></span><br><span class="line">            propList: [<span class="string">'*'</span>, <span class="string">'!font*'</span>],    <span class="comment">//  !不匹配属性（这里是字体相关属性不转换）</span></span><br><span class="line">            selectorBlackList: [],  <span class="comment">//  设置哪些属性选择器（这里是属性选择器）忽略并保留px</span></span><br><span class="line">            replace: <span class="literal">true</span>,</span><br><span class="line">            mediaQuery: <span class="literal">false</span>,  <span class="comment">//  是否允许在媒体查询中转换px</span></span><br><span class="line">            minPixelValue: <span class="number">2</span>    <span class="comment">//  替换的最小像素值。1px不想被替换就设置为2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h3><h4 id="vue-cli-2"><a href="#vue-cli-2" class="headerlink" title="vue-cli-2"></a>vue-cli-2</h4><p>Install Plugin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save postcss-pxtorem</span><br></pre></td></tr></table></figure><blockquote><p>[vue中postcss怎么配置]<a href="https://juejin.im/post/5bf5135251882516d725d1cc" target="_blank" rel="noopener">https://juejin.im/post/5bf5135251882516d725d1cc</a></p></blockquote><h4 id="vue-cli-3"><a href="#vue-cli-3" class="headerlink" title="vue-cli-3"></a>vue-cli-3</h4><hr><h3 id="vue-i18n"><a href="#vue-i18n" class="headerlink" title="vue-i18n"></a>vue-i18n</h3><blockquote><p><a href="https://juejin.im/post/5aa7e18ff265da2384404334" target="_blank" rel="noopener">https://juejin.im/post/5aa7e18ff265da2384404334</a></p></blockquote><hr><h3 id="vue-cli3-Resource"><a href="#vue-cli3-Resource" class="headerlink" title="vue-cli3 Resource"></a>vue-cli3 Resource</h3><p>vue-cli3.0默认项目目录与2.0的相比，更精简:</p><ol><li>移除的配置文件根目录下的，build和config等目录，</li><li>移除了static文件夹，新增了public文件夹，并且index.html移动到public中。</li><li>在src文件夹中新增了views文件夹，用于分类试图组件和公共组件。</li><li>大部分配置都集成到 vue.config.js 这里，在项目根目录下。</li></ol><p>public文件夹下的文件并不会被Webpack处理：它们会直接被复制到最终的打包目录（文件名需指定）下。必须使用绝对路径引用这些文件，简单说就是用来存放万年不变的文件。<br>在vue2.x版本类似 static 文件夹。</p><h4 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"/static/imgUrl"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=<span class="string">"@/assets/imgUrl"</span>/&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><blockquote><p><a href="https://juejin.im/post/5bb4ca3de51d450e7210d7c4" target="_blank" rel="noopener">https://juejin.im/post/5bb4ca3de51d450e7210d7c4</a></p></blockquote><hr><h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><blockquote><p><a href="http://blog.hecun.site/vue/vue%E5%A4%9A%E7%8E%AF%E5%A2%83%E6%89%93%E5%8C%85.html" target="_blank" rel="noopener">http://blog.hecun.site/vue/vue%E5%A4%9A%E7%8E%AF%E5%A2%83%E6%89%93%E5%8C%85.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Install&quot;&gt;&lt;a href=&quot;#Install&quot; class=&quot;headerlink&quot; title=&quot;Install&quot;&gt;&lt;/a&gt;Install&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;vue: npm install -g vue&lt;/li&gt;
&lt;li&gt;vue-cil: np
      
    
    </summary>
    
      <category term="FrontEnd" scheme="https://sulangsss.github.io/categories/FrontEnd/"/>
    
      <category term="vue" scheme="https://sulangsss.github.io/categories/FrontEnd/vue/"/>
    
    
      <category term="前端" scheme="https://sulangsss.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="vue" scheme="https://sulangsss.github.io/tags/vue/"/>
    
      <category term="QuickStart" scheme="https://sulangsss.github.io/tags/QuickStart/"/>
    
  </entry>
  
  <entry>
    <title>前端布局基础知识</title>
    <link href="https://sulangsss.github.io/2019/07/19/FrontEnd/Basic-Layout/"/>
    <id>https://sulangsss.github.io/2019/07/19/FrontEnd/Basic-Layout/</id>
    <published>2019-07-19T15:13:22.000Z</published>
    <updated>2019-07-21T16:09:20.853Z</updated>
    
    <content type="html"><![CDATA[<h3 id="自适应和响应式的区别"><a href="#自适应和响应式的区别" class="headerlink" title="自适应和响应式的区别"></a>自适应和响应式的区别</h3><ul><li>自适应：多端请求时返回不同的页面，服务端需要准备多套程序或者多套模板。</li><li>响应式：主要是利用css媒体查询使得在不同屏幕大小下，页面有不同表现，主要是元素布局等变化。</li></ul><p>响应式，一套代码解决多端。展示阅读类交互逻辑简单且少，且移动端与pc端内容差异不大，如新闻站，企业官网。</p><ul><li>px 在缩放页面时无法调整那些使用它作为单位的字体、按钮等的大小；</li><li>em 的值并不是固定的，会继承父级元素的字体大小，代表倍数；</li><li>rem 的值并不是固定的，始终是基于根元素 <html> 的，也代表倍数。</html></li><li>vw css3新单位，viewpoint width的缩写，视窗宽度，1vw等于视窗宽度的1%，举个例子：浏览器宽度1200px, 1 vw = 1200px/100 = 12 px。</li><li>vh css3新单位，viewpoint height的缩写，视窗高度，1vh等于视窗高度的1%。举个例子：浏览器高度900px, 1 vh = 900px/100 = 9 px。</li></ul><h4 id="em"><a href="#em" class="headerlink" title="em"></a>em</h4><p>em 的使用是相对于其父级的字体大小的，即倍数。浏览器的默认字体高都是 16px，未经调整的浏览器显示 1em = 16px。但是有一个问题，如果设置 1.2em 则变成 19.2px，问题是 px 表示大小时数值会忽略掉小数位的（你想像不出来半个像素吧）。而且 1em = 16px 的关系不好转换，因此，常常人为地使 1em = 10px。这里要借助字体的 % 来作为桥梁。</p><p>因为默认时字体 16px = 100%，则有 10px = 62.5%。所以首先在 body 中全局声明 font-size=62.5%=10px，也就是定义了网页 body 默认字体大小为 10px，由于 em 有继承父级元素字体大小的特性，如果某元素的父级没有设定字体大小，那么它就继续了 body 默认字体大小 1em = 10px。</p><p>但是由于 em 是相对于其父级字体的倍数的，当出现有多重嵌套内容时，使用 em 分别给它们设置字体的大小往往要重新计算。比如说你在父级中声明了字体大小为 1.2em，那么在声明子元素的字体大小时设置 1em 才能和父级元素内容字体大小一致，而不是1.2em（避免 1.2*1.2=1.44em）, 因为此 em 非彼 em。再举个例子：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Outer <span class="tag">&lt;<span class="name">span</span>&gt;</span>inner<span class="tag">&lt;/<span class="name">span</span>&gt;</span> outer<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">body &#123; font-size: 62.5%; &#125;</span><br><span class="line">span &#123; font-size: 1.6em; &#125;</span><br></pre></td></tr></table></figure><p>结果：外层 <span> 为 body 字体 10px 的 1.6倍 = 16px，内层 <span> 为外层内容字体 16px 的 1.6倍 = 25px（或26px，不同浏览器取舍小数不同）。</span></span></p><p>明显地，内部 <span> 内的文字受到了父级 <span> 的影响。基于这点，在实际使用中给我们的计算带来了很大的不便。</span></span></p><h4 id="rem"><a href="#rem" class="headerlink" title="rem"></a>rem</h4><blockquote><p>rem values are relative to the root html element, not the parent element.</p></blockquote><p>rem 的出现再也不用担心还要根据父级元素的 font-size 计算 em 值了，因为它始终是基于根元素（<html>）的。比如默认的 html font-size=16px，那么想设置 12px 的文字就是：12÷16=0.75(rem)，仍然是上面的例子，CSS改为：</html></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">html &#123; font-size: 62.5%; &#125;</span><br><span class="line">span &#123; font-size: 16px; font-size: 1.6rem; &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://www.kancloud.cn/xiak/quanduan/696668" target="_blank" rel="noopener">https://www.kancloud.cn/xiak/quanduan/696668</a></li><li><a href="https://segmentfault.com/a/1190000005936910" target="_blank" rel="noopener">vue技术栈开发实战课程</a></li><li><a href="https://segmentfault.com/a/1190000005936910" target="_blank" rel="noopener">区别 px、em、rem</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;自适应和响应式的区别&quot;&gt;&lt;a href=&quot;#自适应和响应式的区别&quot; class=&quot;headerlink&quot; title=&quot;自适应和响应式的区别&quot;&gt;&lt;/a&gt;自适应和响应式的区别&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;自适应：多端请求时返回不同的页面，服务端需要准备多套程序或者多套
      
    
    </summary>
    
      <category term="FrontEnd" scheme="https://sulangsss.github.io/categories/FrontEnd/"/>
    
    
      <category term="前端" scheme="https://sulangsss.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="FrontEnd" scheme="https://sulangsss.github.io/tags/FrontEnd/"/>
    
  </entry>
  
  <entry>
    <title>Docker JDK Dockerfile</title>
    <link href="https://sulangsss.github.io/2019/07/15/Docker/Dockerfile/Java-jdk/"/>
    <id>https://sulangsss.github.io/2019/07/15/Docker/Dockerfile/Java-jdk/</id>
    <published>2019-07-15T05:28:19.000Z</published>
    <updated>2019-07-15T05:58:58.713Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Alibaba-Dragonwell"><a href="#Alibaba-Dragonwell" class="headerlink" title="Alibaba Dragonwell"></a>Alibaba Dragonwell</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line">ADD java /opt/java</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/java</span><br><span class="line"></span><br><span class="line">RUN alternatives --install /usr/bin/java java /opt/java/bin/java <span class="number">2</span> \</span><br><span class="line">    &amp;&amp; alternatives --install /usr/bin/jar jar /opt/java/bin/jar <span class="number">2</span> \</span><br><span class="line">    &amp;&amp; alternatives --install /usr/bin/javac javac /opt/java/bin/javac <span class="number">2</span> \</span><br><span class="line">    &amp;&amp; alternatives --set java /opt/java/bin/java \</span><br><span class="line">    &amp;&amp; alternatives --set jar /opt/java/bin/jar \</span><br><span class="line">    &amp;&amp; alternatives --set javac /opt/java/bin/javac \</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Alibaba-Dragonwell&quot;&gt;&lt;a href=&quot;#Alibaba-Dragonwell&quot; class=&quot;headerlink&quot; title=&quot;Alibaba Dragonwell&quot;&gt;&lt;/a&gt;Alibaba Dragonwell&lt;/h3&gt;&lt;figure c
      
    
    </summary>
    
      <category term="Docker" scheme="https://sulangsss.github.io/categories/Docker/"/>
    
      <category term="Dockerfile" scheme="https://sulangsss.github.io/categories/Docker/Dockerfile/"/>
    
    
      <category term="Docker" scheme="https://sulangsss.github.io/tags/Docker/"/>
    
      <category term="Dockerfile" scheme="https://sulangsss.github.io/tags/Dockerfile/"/>
    
      <category term="JDK" scheme="https://sulangsss.github.io/tags/JDK/"/>
    
  </entry>
  
  <entry>
    <title>Java Date</title>
    <link href="https://sulangsss.github.io/2019/07/13/Java/Date/"/>
    <id>https://sulangsss.github.io/2019/07/13/Java/Date/</id>
    <published>2019-07-13T03:52:22.000Z</published>
    <updated>2019-07-16T07:22:08.876Z</updated>
    
    <content type="html"><![CDATA[<hr><h3 id="LocalDate-和-LocalTime"><a href="#LocalDate-和-LocalTime" class="headerlink" title="LocalDate 和 LocalTime"></a>LocalDate 和 LocalTime</h3><p>Java 8一个新增的重要特性就是引入了新的时间和日期API，它们被包含在java.time包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。</p><p>在Java 8之前，所有关于时间和日期的API都存在各种使用方面的缺陷，主要有：</p><ol><li>Java的java.util.Date和java.util.Calendar类易用性差，不支持时区，而且他们都不是线程安全的；</li><li>用于格式化日期的类DateFormat被放在java.text包中，它是一个抽象类，所以我们需要实例化一个SimpleDateFormat对象来处理日期格式化，并且DateFormat也是非线程安全，这意味着如果你在多线程程序中调用同一个DateFormat对象，会得到意想不到的结果。</li><li>对日期的计算方式繁琐，而且容易出错，因为月份是从0开始的，从Calendar中获取的月份需要加一才能表示当前月份。</li></ol><blockquote><p>在阿里巴巴规约手册里，强制规定SimpleDateFormat是线程不安全的类，当定义为静态变量时，必须加锁处理。忽略线程安全问题，正是大多数Java初学者在进行时间转化时容易踩坑的点。<br>Java 8的日期和时间类包含LocalDate、LocalTime、Instant、Duration以及Period，这些类都包含在java.time包中。</p></blockquote><p>LocalDate类表示一个具体的日期，但不包含具体时间，也不包含时区信息。可以通过LocalDate的静态方法of()创建一个实例，LocalDate也包含一些方法用来获取年份，月份，天，星期几等：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LocalDate localDate = LocalDate.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">4</span>);     <span class="comment">// 初始化一个日期：2017-01-04</span></span><br><span class="line"><span class="keyword">int</span> year = localDate.getYear();                     <span class="comment">// 年份：2017</span></span><br><span class="line">Month month = localDate.getMonth();                 <span class="comment">// 月份：JANUARY</span></span><br><span class="line"><span class="keyword">int</span> dayOfMonth = localDate.getDayOfMonth();         <span class="comment">// 月份中的第几天：4</span></span><br><span class="line">DayOfWeek dayOfWeek = localDate.getDayOfWeek();     <span class="comment">// 一周的第几天：WEDNESDAY</span></span><br><span class="line"><span class="keyword">int</span> length = localDate.lengthOfMonth();             <span class="comment">// 月份的天数：31</span></span><br><span class="line"><span class="keyword">boolean</span> leapYear = localDate.isLeapYear();          <span class="comment">// 是否为闰年：false</span></span><br><span class="line"></span><br><span class="line">LocalDate now = LocalDate.now();                    <span class="comment">// 调用静态方法now()来获取当前日期</span></span><br></pre></td></tr></table></figure><p>LocalTime和LocalDate类似，他们之间的区别在于LocalDate不包含具体时间，而LocalTime包含具体时间，例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LocalTime localTime = LocalTime.of(<span class="number">17</span>, <span class="number">23</span>, <span class="number">52</span>);     <span class="comment">// 初始化一个时间：17:23:52</span></span><br><span class="line"><span class="keyword">int</span> hour = localTime.getHour();                     <span class="comment">// 时：17</span></span><br><span class="line"><span class="keyword">int</span> minute = localTime.getMinute();                 <span class="comment">// 分：23</span></span><br><span class="line"><span class="keyword">int</span> second = localTime.getSecond();                 <span class="comment">// 秒：52</span></span><br></pre></td></tr></table></figure><hr><h3 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h3><p>LocalDateTime类是LocalDate和LocalTime的结合体，可以通过of()方法直接创建，也可以调用LocalDate的atTime()方法或LocalTime的atDate()方法将LocalDate或LocalTime合并成一个LocalDateTime：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime ldt1 = LocalDateTime.of(<span class="number">2017</span>, Month.JANUARY, <span class="number">4</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">52</span>);</span><br><span class="line"></span><br><span class="line">LocalDate localDate = LocalDate.of(<span class="number">2017</span>, Month.JANUARY, <span class="number">4</span>);</span><br><span class="line">LocalTime localTime = LocalTime.of(<span class="number">17</span>, <span class="number">23</span>, <span class="number">52</span>);</span><br><span class="line">LocalDateTime ldt2 = localDate.atTime(localTime);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  LocalDateTime也提供用于向LocalDate 和 LocalTime的 转化</span></span><br><span class="line">LocalDate date = ldt1.toLocalDate();</span><br><span class="line">LocalTime time = ldt1.toLocalTime();</span><br></pre></td></tr></table></figure><hr><h3 id="TemporalAdjusters"><a href="#TemporalAdjusters" class="headerlink" title="TemporalAdjusters"></a>TemporalAdjusters</h3><p>增加或减少日期操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LocalDate date = LocalDate.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">5</span>);          <span class="comment">// 2017-01-05</span></span><br><span class="line"></span><br><span class="line">LocalDate date1 = date.withYear(<span class="number">2016</span>);              <span class="comment">// 修改为 2016-01-05</span></span><br><span class="line">LocalDate date2 = date.withMonth(<span class="number">2</span>);                <span class="comment">// 修改为 2017-02-05</span></span><br><span class="line">LocalDate date3 = date.withDayOfMonth(<span class="number">1</span>);           <span class="comment">// 修改为 2017-01-01</span></span><br><span class="line"></span><br><span class="line">LocalDate date4 = date.plusYears(<span class="number">1</span>);                <span class="comment">// 增加一年 2018-01-05</span></span><br><span class="line">LocalDate date5 = date.minusMonths(<span class="number">2</span>);              <span class="comment">// 减少两个月 2016-11-05</span></span><br><span class="line">LocalDate date6 = date.plus(<span class="number">5</span>, ChronoUnit.DAYS);    <span class="comment">// 增加5天 2017-01-10</span></span><br></pre></td></tr></table></figure><p>些时候我们要面临更复杂的时间操作，比如将时间调到下一个工作日，或者是下个月的最后一天，这时候我们可以使用with()方法的另一个重载方法，它接收一个TemporalAdjuster参数，可以使我们更加灵活的调整日期：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.temporal.TemporalAdjusters.*;</span><br><span class="line"><span class="comment">//  dayOfWeekInMonth    返回同一个月中每周的第几天</span></span><br><span class="line"><span class="comment">//  firstDayOfMonth 返回当月的第一天</span></span><br><span class="line"><span class="comment">//  firstDayOfNextMonth 返回下月的第一天</span></span><br><span class="line"><span class="comment">//  firstDayOfNextYear 返回下一年的第一天</span></span><br><span class="line"><span class="comment">//  firstDayOfYear 返回本年的第一天</span></span><br><span class="line"><span class="comment">//  firstInMonth 返回同一个月中第一个星期几</span></span><br><span class="line"><span class="comment">//  lastDayOfMonth 返回当月的最后一天</span></span><br><span class="line"><span class="comment">//  lastDayOfNextMonth 返回下月的最后一天</span></span><br><span class="line"><span class="comment">//  lastDayOfNextYear 返回下一年的最后一天</span></span><br><span class="line"><span class="comment">//  lastDayOfYear 返回本年的最后一天</span></span><br><span class="line"><span class="comment">//  lastInMonth 返回同一个月中最后一个星期几</span></span><br><span class="line"><span class="comment">//  next / previous 返回后一个/前一个给定的星期几</span></span><br><span class="line"><span class="comment">//  nextOrSame / previousOrSame 返回后一个/前一个给定的星期几，如果这个值满足条件，直接返回</span></span><br><span class="line"></span><br><span class="line">LocalDate date7 = date.with(nextOrSame(DayOfWeek.SUNDAY));      <span class="comment">// 返回下一个距离当前时间最近的星期日</span></span><br><span class="line">LocalDate date9 = date.with(lastInMonth(DayOfWeek.SATURDAY));   <span class="comment">// 返回本月最后一个星期六</span></span><br></pre></td></tr></table></figure><p>如果上面表格中列出的方法不能满足你的需求，你还可以创建自定义的TemporalAdjuster接口的实现，TemporalAdjuster也是一个函数式接口，所以我们可以使用Lambda表达式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TemporalAdjuster</span> </span>&#123;</span><br><span class="line">    <span class="function">Temporal <span class="title">adjustInto</span><span class="params">(Temporal temporal)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  比如给定一个日期，计算该日期的下一个工作日（不包括星期六和星期天）：</span></span><br><span class="line">LocalDate date = LocalDate.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">date.with(temporal -&gt; &#123;</span><br><span class="line">    <span class="comment">// 当前日期</span></span><br><span class="line">    DayOfWeek dayOfWeek = DayOfWeek.of(temporal.get(ChronoField.DAY_OF_WEEK));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正常情况下，每次增加一天</span></span><br><span class="line">    <span class="keyword">int</span> dayToAdd = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是星期五，增加三天</span></span><br><span class="line">    <span class="keyword">if</span> (dayOfWeek == DayOfWeek.FRIDAY) &#123;</span><br><span class="line">        dayToAdd = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是星期六，增加两天</span></span><br><span class="line">    <span class="keyword">if</span> (dayOfWeek == DayOfWeek.SATURDAY) &#123;</span><br><span class="line">        dayToAdd = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temporal.plus(dayToAdd, ChronoUnit.DAYS);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h3 id="DateTimeFormatter"><a href="#DateTimeFormatter" class="headerlink" title="DateTimeFormatter"></a>DateTimeFormatter</h3><p>它被包含在java.time.format包中，Java 8的日期类有一个format()方法用于将日期格式化为字符串，该方法接收一个DateTimeFormatter类型参数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime dateTime = LocalDateTime.now();</span><br><span class="line">String strDate1 = dateTime.format(DateTimeFormatter.BASIC_ISO_DATE);    <span class="comment">// 20170105</span></span><br><span class="line">String strDate2 = dateTime.format(DateTimeFormatter.ISO_LOCAL_DATE);    <span class="comment">// 2017-01-05</span></span><br><span class="line">String strDate3 = dateTime.format(DateTimeFormatter.ISO_LOCAL_TIME);    <span class="comment">// 14:20:16.998</span></span><br><span class="line">String strDate4 = dateTime.format(DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd"</span>));   <span class="comment">// 2017-01-05</span></span><br><span class="line">String strDate5 = dateTime.format(DateTimeFormatter.ofPattern(<span class="string">"今天是：YYYY年 MMMM DD日 E"</span>, Locale.CHINESE)); <span class="comment">// 今天是：2017年 一月 05日 星期四</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  同样，日期类也支持将一个字符串解析成一个日期对象</span></span><br><span class="line">String strDate6 = <span class="string">"2017-01-05"</span>;</span><br><span class="line">String strDate7 = <span class="string">"2017-01-05 12:30:05"</span>;</span><br><span class="line"></span><br><span class="line">LocalDate date = LocalDate.parse(strDate6, DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd"</span>));</span><br><span class="line">LocalDateTime dateTime1 = LocalDateTime.parse(strDate7, DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br></pre></td></tr></table></figure><hr><h3 id="ZoneId"><a href="#ZoneId" class="headerlink" title="ZoneId"></a>ZoneId</h3><p>Java 8中的时区操作被很大程度上简化了，新的时区类java.time.ZoneId是原有的java.util.TimeZone类的替代品。ZoneId对象可以通过ZoneId.of()方法创建，也可以通过ZoneId.systemDefault()获取系统默认时区：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZoneId shanghaiZoneId = ZoneId.of(<span class="string">"Asia/Shanghai"</span>);</span><br><span class="line">ZoneId systemZoneId = ZoneId.systemDefault();</span><br></pre></td></tr></table></figure><p>of()方法接收一个“区域/城市”的字符串作为参数，你可以通过getAvailableZoneIds()方法获取所有合法的“区域/城市”字符串：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; zoneIds = ZoneId.getAvailableZoneIds();</span><br><span class="line"></span><br><span class="line"><span class="comment">//  对于老的时区类TimeZone，Java 8也提供了转化方法</span></span><br><span class="line">ZoneId oldToNewZoneId = TimeZone.getDefault().toZoneId();</span><br></pre></td></tr></table></figure><p>我们就可以将一个LocalDate、LocalTime或LocalDateTime对象转化为ZonedDateTime对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime localDateTime = LocalDateTime.now();</span><br><span class="line">ZonedDateTime zonedDateTime = ZonedDateTime.of(localDateTime, shanghaiZoneId);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  zonedDateTime</span></span><br><span class="line"><span class="comment">//  2017-01-05T15:26:56.147+08:00[Asia/Shanghai]</span></span><br><span class="line"><span class="comment">//  ZonedDateTime对象由两部分构成，LocalDateTime和ZoneId，其中2017-01-05T15:26:56.147部分为LocalDateTime，+08:00[Asia/Shanghai]部分为ZoneId</span></span><br></pre></td></tr></table></figure><p>另一种表示时区的方式是使用ZoneOffset，它是以当前时间和世界标准时间（UTC）/格林威治时间（GMT）的偏差来计算，例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZoneOffset zoneOffset = ZoneOffset.of(<span class="string">"+09:00"</span>);</span><br><span class="line">LocalDateTime localDateTime = LocalDateTime.now();</span><br><span class="line">OffsetDateTime offsetDateTime = OffsetDateTime.of(localDateTime, zoneOffset);</span><br></pre></td></tr></table></figure><p>Java中使用的历法是ISO 8601日历系统，它是世界民用历法，也就是我们所说的公历。平年有365天，闰年是366天。闰年的定义是：非世纪年，能被4整除；世纪年能被400整除。为了计算的一致性，公元1年的前一年被当做公元0年，以此类推。</p><p>此外Java 8还提供了4套其他历法（很奇怪为什么没有汉族人使用的农历），每套历法都包含一个日期类，分别是：</p><ul><li>ThaiBuddhistDate：泰国佛教历</li><li>MinguoDate：中华民国历</li><li>JapaneseDate：日本历</li><li>HijrahDate：伊斯兰历</li></ul><p>由于它们都继承ChronoLocalDate类，所以在不知道具体历法情况下，可以通过ChronoLocalDate类操作日期</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chronology jpChronology = Chronology.ofLocale(Locale.JAPANESE);</span><br><span class="line">ChronoLocalDate jpChronoLocalDate = jpChronology.dateNow();</span><br></pre></td></tr></table></figure><p>我们在开发过程中应该尽量避免使用ChronoLocalDate，尽量用与历法无关的方式操作时间，因为不同的历法计算日期的方式不一样，比如开发者会在程序中做一些假设，假设一年中有12个月，如果是中国农历中包含了闰月，一年有可能是13个月，但开发者认为是12个月，多出来的一个月属于明年的。再比如假设年份是累加的，过了一年就在原来的年份上加一，但日本天皇在换代之后需要重新纪年，所以过了一年年份可能会从1开始计算。</p><p>在实际开发过程中建议使用LocalDate，包括存储、操作、业务规则的解读；除非需要将程序的输入或者输出本地化，这时可以使用ChronoLocalDate类。</p><hr><h3 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a>Instant</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  方法的第一个参数为秒，第二个参数为纳秒</span></span><br><span class="line">Instant instant = Instant.ofEpochSecond(<span class="number">120</span>, <span class="number">100000</span>);</span><br><span class="line"><span class="comment">//  从1970-01-01 00:00:00开始后两分钟的10万纳秒的时刻</span></span><br><span class="line"><span class="comment">//  1970-01-01T00:02:00.000100Z</span></span><br></pre></td></tr></table></figure><hr><h3 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h3><p>与Instant区别：Instant用于表示一个时间戳（或者说是一个时间点），而Duration表示一个时间段，所以Duration类中不包含now()静态方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime from = LocalDateTime.of(<span class="number">2017</span>, Month.JANUARY, <span class="number">5</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">0</span>);    <span class="comment">// 2017-01-05 10:07:00</span></span><br><span class="line">LocalDateTime to = LocalDateTime.of(<span class="number">2017</span>, Month.FEBRUARY, <span class="number">5</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">0</span>);     <span class="comment">// 2017-02-05 10:07:00</span></span><br><span class="line">Duration duration = Duration.between(from, to);     <span class="comment">// 表示从 2017-01-05 10:07:00 到 2017-02-05 10:07:00 这段时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> days = duration.toDays();              <span class="comment">// 这段时间的总天数</span></span><br><span class="line"><span class="keyword">long</span> hours = duration.toHours();            <span class="comment">// 这段时间的小时数</span></span><br><span class="line"><span class="keyword">long</span> minutes = duration.toMinutes();        <span class="comment">// 这段时间的分钟数</span></span><br><span class="line"><span class="keyword">long</span> seconds = duration.getSeconds();       <span class="comment">// 这段时间的秒数</span></span><br><span class="line"><span class="keyword">long</span> milliSeconds = duration.toMillis();    <span class="comment">// 这段时间的毫秒数</span></span><br><span class="line"><span class="keyword">long</span> nanoSeconds = duration.toNanos();      <span class="comment">// 这段时间的纳秒数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  Duration对象还可以通过of()方法创建，该方法接受一个时间段长度，和一个时间单位作为参数</span></span><br><span class="line">Duration duration1 = Duration.of(<span class="number">5</span>, ChronoUnit.DAYS);       <span class="comment">// 5天</span></span><br><span class="line">Duration duration2 = Duration.of(<span class="number">1000</span>, ChronoUnit.MILLIS);  <span class="comment">// 1000毫秒</span></span><br></pre></td></tr></table></figure><hr><h3 id="Period"><a href="#Period" class="headerlink" title="Period"></a>Period</h3><p>Period在概念上和Duration类似，区别在于Period是以年月日来衡量一个时间段，比如2年3个月6天：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Period period = Period.of(<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  Period对象也可以通过between()方法创建，值得注意的是，由于Period是以年月日衡量时间段，所以between()方法只能接收LocalDate类型的参数</span></span><br><span class="line">Period period = Period.between(LocalDate.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">5</span>), LocalDate.of(<span class="number">2017</span>, <span class="number">2</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://juejin.im/post/5d079fd76fb9a07ef44407d9" target="_blank" rel="noopener">https://juejin.im/post/5d079fd76fb9a07ef44407d9</a></li><li><a href="https://lw900925.github.io/java/java8-newtime-api.html" target="_blank" rel="noopener">https://lw900925.github.io/java/java8-newtime-api.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;h3 id=&quot;LocalDate-和-LocalTime&quot;&gt;&lt;a href=&quot;#LocalDate-和-LocalTime&quot; class=&quot;headerlink&quot; title=&quot;LocalDate 和 LocalTime&quot;&gt;&lt;/a&gt;LocalDate 和 LocalT
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="DateFormat" scheme="https://sulangsss.github.io/tags/DateFormat/"/>
    
      <category term="DateTime" scheme="https://sulangsss.github.io/tags/DateTime/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin coroutine</title>
    <link href="https://sulangsss.github.io/2019/07/07/Java/Kotlin/coroutine/"/>
    <id>https://sulangsss.github.io/2019/07/07/Java/Kotlin/coroutine/</id>
    <published>2019-07-07T15:04:22.000Z</published>
    <updated>2019-07-25T08:50:55.477Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basic-Practice"><a href="#Basic-Practice" class="headerlink" title="Basic Practice"></a>Basic Practice</h3><h4 id="First-Example"><a href="#First-Example" class="headerlink" title="First Example"></a>First Example</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    GlobalScope.launch &#123; <span class="comment">// launch a new coroutine in background and continue</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">"World!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>) <span class="comment">// main thread continues here immediately</span></span><br><span class="line">    runBlocking &#123;     <span class="comment">// but this expression blocks the main thread</span></span><br><span class="line">        delay(<span class="number">2000L</span>)  <span class="comment">// ... while we delay for 2 seconds to keep JVM alive</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking&lt;Unit&gt; &#123; <span class="comment">// start main coroutine</span></span><br><span class="line">    GlobalScope.launch &#123; <span class="comment">// launch a new coroutine in background and continue</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">"World!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>) <span class="comment">// main coroutine continues here immediately</span></span><br><span class="line">    delay(<span class="number">2000L</span>)      <span class="comment">// delaying for 2 seconds to keep JVM alive</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  or</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        <span class="comment">// launch a new coroutine in background and continue</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">"World!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>) <span class="comment">// main coroutine continues here immediately</span></span><br><span class="line">    delay(<span class="number">2000L</span>)      <span class="comment">// delaying for 2 seconds to keep JVM alive</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Structured-concurrency"><a href="#Structured-concurrency" class="headerlink" title="Structured concurrency"></a>Structured concurrency</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking &#123; <span class="comment">// this: CoroutineScope</span></span><br><span class="line">    launch &#123; <span class="comment">// launch a new coroutine in the scope of runBlocking</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">"World!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Scope-builder"><a href="#Scope-builder" class="headerlink" title="Scope builder"></a>Scope builder</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking &#123; <span class="comment">// this: CoroutineScope</span></span><br><span class="line">    launch &#123; </span><br><span class="line">        delay(<span class="number">200L</span>)</span><br><span class="line">        println(<span class="string">"Task from runBlocking"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    coroutineScope &#123; <span class="comment">// Creates a coroutine scope</span></span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">500L</span>) </span><br><span class="line">            println(<span class="string">"Task from nested launch"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        delay(<span class="number">100L</span>)</span><br><span class="line">        println(<span class="string">"Task from coroutine scope"</span>) <span class="comment">// This line will be printed before the nested launch</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    println(<span class="string">"Coroutine scope is over"</span>) <span class="comment">// This line is not printed until the nested launch completes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="suspending-function"><a href="#suspending-function" class="headerlink" title="suspending function"></a>suspending function</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    launch &#123; doWorld() &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this is your first suspending function</span></span><br><span class="line"><span class="function">suspend fun <span class="title">doWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    delay(<span class="number">1000L</span>)</span><br><span class="line">    println(<span class="string">"World!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    repeat(<span class="number">100_000</span>) &#123; <span class="comment">// launch a lot of coroutines</span></span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">1000L</span>)</span><br><span class="line">            print(<span class="string">"."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It launches 100K coroutines and, after a second, each coroutine prints a dot. Now, try that with threads. What would happen? (Most likely your code will produce some sort of out-of-memory error)</p><hr><h3 id="Cancellation"><a href="#Cancellation" class="headerlink" title="Cancellation"></a>Cancellation</h3><h4 id="Cancelling-coroutine-execution"><a href="#Cancelling-coroutine-execution" class="headerlink" title="Cancelling coroutine execution"></a>Cancelling coroutine execution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">val job = launch &#123;</span><br><span class="line">    repeat(<span class="number">1000</span>) &#123; i -&gt;</span><br><span class="line">        println(<span class="string">"job: I'm sleeping $i ..."</span>)</span><br><span class="line">        delay(<span class="number">500L</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">delay(<span class="number">1300L</span>) <span class="comment">// delay a bit</span></span><br><span class="line">println(<span class="string">"main: I'm tired of waiting!"</span>)</span><br><span class="line">job.cancel() <span class="comment">// cancels the job</span></span><br><span class="line">job.join() <span class="comment">// waits for job's completion </span></span><br><span class="line">println(<span class="string">"main: Now I can quit."</span>)</span><br></pre></td></tr></table></figure><h4 id="withTimeout"><a href="#withTimeout" class="headerlink" title="withTimeout"></a>withTimeout</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">withTimeout(<span class="number">1300L</span>) &#123;</span><br><span class="line">    repeat(<span class="number">1000</span>) &#123; i -&gt;</span><br><span class="line">            println(<span class="string">"I'm sleeping $i ..."</span>)</span><br><span class="line">        delay(<span class="number">500L</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="withTimeoutOrNull"><a href="#withTimeoutOrNull" class="headerlink" title="withTimeoutOrNull"></a>withTimeoutOrNull</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val result = withTimeoutOrNull(<span class="number">1300L</span>) &#123;</span><br><span class="line">        repeat(<span class="number">1000</span>) &#123; i -&gt;</span><br><span class="line">            println(<span class="string">"I'm sleeping $i ..."</span>)</span><br><span class="line">            delay(<span class="number">500L</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">"Done"</span> <span class="comment">// will get cancelled before it produces this result</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Result is $result"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I'm sleeping 0 ...</span></span><br><span class="line"><span class="comment">// I'm sleeping 1 ...</span></span><br><span class="line"><span class="comment">// I'm sleeping 2 ...</span></span><br><span class="line"><span class="comment">// Result is null</span></span><br></pre></td></tr></table></figure><hr><h3 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h3><p>Channels provide a way to transfer a stream of values.</p><p>A Channel is conceptually very similar to BlockingQueue. One key difference is that instead of a blocking put operation it has a suspending send, and instead of a blocking take operation it has a suspending receive.</p><h4 id="send-number-by-channels"><a href="#send-number-by-channels" class="headerlink" title="send number by channels"></a>send number by channels</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val channel = Channel&lt;Int&gt;()</span><br><span class="line">    launch &#123;</span><br><span class="line">        <span class="comment">// this might be heavy CPU-consuming computation or async logic, we'll just send five squares</span></span><br><span class="line">        <span class="keyword">for</span> (x in <span class="number">1</span>..<span class="number">5</span>) channel.send(x * x)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// here we print five received integers:</span></span><br><span class="line">    repeat(<span class="number">5</span>) &#123; println(channel.receive()) &#125;</span><br><span class="line">    println(<span class="string">"Done!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Closing-and-iteration-over-channels"><a href="#Closing-and-iteration-over-channels" class="headerlink" title="Closing and iteration over channels"></a>Closing and iteration over channels</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val channel = Channel&lt;Int&gt;()</span><br><span class="line">launch &#123;</span><br><span class="line">    <span class="keyword">for</span> (x in <span class="number">1</span>..<span class="number">5</span>) channel.send(x * x)</span><br><span class="line">    channel.close() <span class="comment">// we're done sending</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// here we print received values using `for` loop (until the channel is closed)</span></span><br><span class="line"><span class="keyword">for</span> (y in channel) println(y)</span><br><span class="line">println(<span class="string">"Done!"</span>)</span><br></pre></td></tr></table></figure><h4 id="channel-producers"><a href="#channel-producers" class="headerlink" title="channel producers"></a>channel producers</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> kotlinx.coroutines.guide.channel03</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"><span class="keyword">import</span> kotlinx.coroutines.channels.*</span><br><span class="line"></span><br><span class="line">fun CoroutineScope.produceSquares(): ReceiveChannel&lt;Int&gt; = produce &#123;</span><br><span class="line">    <span class="keyword">for</span> (x in <span class="number">1</span>..<span class="number">5</span>) send(x * x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    <span class="comment">//sampleStart</span></span><br><span class="line">    val squares = produceSquares()</span><br><span class="line">    squares.consumeEach &#123; println(it) &#125;</span><br><span class="line">    println(<span class="string">"Done!"</span>)</span><br><span class="line">    <span class="comment">//sampleEnd</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Fan-out"><a href="#Fan-out" class="headerlink" title="Fan-out"></a>Fan-out</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fun CoroutineScope.produceNumbers() = produce&lt;Int&gt; &#123;</span><br><span class="line">        var x = <span class="number">1</span> <span class="comment">// start from 1</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            send(x++) <span class="comment">// produce next</span></span><br><span class="line">            delay(<span class="number">100</span>) <span class="comment">// wait 0.1s</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">fun CoroutineScope.launchProcessor(id: Int, channel: ReceiveChannel&lt;Int&gt;) = launch &#123;</span><br><span class="line">    <span class="keyword">for</span> (msg in channel) &#123;</span><br><span class="line">        println(<span class="string">"Processor #$id received $msg"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val producer = produceNumbers()</span><br><span class="line">    repeat(<span class="number">5</span>) &#123; launchProcessor(it, producer) &#125;</span><br><span class="line">    delay(<span class="number">950</span>)</span><br><span class="line">    producer.cancel() <span class="comment">// cancel producer coroutine and thus kill them all</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Processor #0 received 1</span><br><span class="line">Processor #0 received 2</span><br><span class="line">Processor #1 received 3</span><br><span class="line">Processor #2 received 4</span><br><span class="line">Processor #3 received 5</span><br><span class="line">Processor #4 received 6</span><br><span class="line">Processor #0 received 7</span><br><span class="line">Processor #1 received 8</span><br><span class="line">Processor #2 received 9</span><br><span class="line">Processor #3 received 10</span><br></pre></td></tr></table></figure><h4 id="Fan-in"><a href="#Fan-in" class="headerlink" title="Fan-in"></a>Fan-in</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">suspend fun <span class="title">sendString</span><span class="params">(channel: SendChannel&lt;String&gt;, s: String, time: Long)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            delay(time)</span><br><span class="line">            channel.send(s)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val channel = Channel&lt;String&gt;()</span><br><span class="line">    launch &#123; sendString(channel, <span class="string">"foo"</span>, <span class="number">200L</span>) &#125;</span><br><span class="line">    launch &#123; sendString(channel, <span class="string">"BAR!"</span>, <span class="number">500L</span>) &#125;</span><br><span class="line">    repeat(<span class="number">6</span>) &#123; <span class="comment">// receive first six</span></span><br><span class="line">        println(channel.receive())</span><br><span class="line">    &#125;</span><br><span class="line">    coroutineContext.cancelChildren() <span class="comment">// cancel all children to let main finish</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">foo</span><br><span class="line">foo</span><br><span class="line">BAR!</span><br><span class="line">foo</span><br><span class="line">foo</span><br><span class="line">BAR!</span><br></pre></td></tr></table></figure><h4 id="Buffered-channels"><a href="#Buffered-channels" class="headerlink" title="Buffered channels"></a>Buffered channels</h4><p> If send is invoked first, then it is suspended until receive is invoked, if receive is invoked first, it is suspended until send is invoked.</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val channel = Channel&lt;Int&gt;(<span class="number">4</span>) <span class="comment">// create buffered channel</span></span><br><span class="line">    val sender = launch &#123;</span><br><span class="line">        <span class="comment">// launch sender coroutine</span></span><br><span class="line">        repeat(<span class="number">10</span>) &#123;</span><br><span class="line">            println(<span class="string">"Sending $it"</span>) <span class="comment">// print before sending each element</span></span><br><span class="line">            channel.send(it) <span class="comment">// will suspend when buffer is full</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// don't receive anything... just wait....</span></span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    println(<span class="string">"done, then to cancel"</span>)</span><br><span class="line">    sender.cancel() <span class="comment">// cancel sender coroutine</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Channels-are-fair"><a href="#Channels-are-fair" class="headerlink" title="Channels are fair"></a>Channels are fair</h4> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function">data class <span class="title">Ball</span><span class="params">(var hits: Int)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val table = Channel&lt;Ball&gt;() <span class="comment">// a shared table</span></span><br><span class="line">    launch &#123; player(<span class="string">"ping"</span>, table) &#125;</span><br><span class="line">    launch &#123; player(<span class="string">"pong"</span>, table) &#125;</span><br><span class="line">    table.send(Ball(<span class="number">0</span>)) <span class="comment">// serve the ball</span></span><br><span class="line">    delay(<span class="number">1000</span>) <span class="comment">// delay 1 second</span></span><br><span class="line">    coroutineContext.cancelChildren() <span class="comment">// game over, cancel them</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">suspend fun <span class="title">player</span><span class="params">(name: String, table: Channel&lt;Ball&gt;)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (ball in table) &#123; <span class="comment">// receive the ball in a loop</span></span><br><span class="line">        ball.hits++</span><br><span class="line">        println(<span class="string">"$name $ball"</span>)</span><br><span class="line">        delay(<span class="number">300</span>) <span class="comment">// wait a bit</span></span><br><span class="line">        table.send(ball) <span class="comment">// send the ball back</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ping Ball(hits=1)</span><br><span class="line">pong Ball(hits=2)</span><br><span class="line">ping Ball(hits=3)</span><br><span class="line">pong Ball(hits=4)</span><br></pre></td></tr></table></figure><h4 id="Ticker-channels"><a href="#Ticker-channels" class="headerlink" title="Ticker channels"></a>Ticker channels</h4><p> Ticker channel is a special rendezvous channel that produces Unit every time given delay passes since last consumption from this channel. </p><p> Though it may seem to be useless standalone, it is a useful building block to create complex time-based produce pipelines and operators that do windowing and other time-dependent processing. </p><p> Ticker channel can be used in select to perform “on tick” action.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    val tickerChannel = ticker(delayMillis = <span class="number">100</span>, initialDelayMillis = <span class="number">0</span>) <span class="comment">// create ticker channel</span></span><br><span class="line">    var nextElement = withTimeoutOrNull(<span class="number">1</span>) &#123; tickerChannel.receive() &#125;</span><br><span class="line">    println(<span class="string">"Initial element is available immediately: $nextElement"</span>) <span class="comment">// initial delay hasn't passed yet</span></span><br><span class="line"></span><br><span class="line">    nextElement = withTimeoutOrNull(<span class="number">50</span>) &#123; tickerChannel.receive() &#125; <span class="comment">// all subsequent elements has 100ms delay</span></span><br><span class="line">    println(<span class="string">"Next element is not ready in 50 ms: $nextElement"</span>)</span><br><span class="line"></span><br><span class="line">    nextElement = withTimeoutOrNull(<span class="number">60</span>) &#123; tickerChannel.receive() &#125;</span><br><span class="line">    println(<span class="string">"Next element is ready in 100 ms: $nextElement"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Emulate large consumption delays</span></span><br><span class="line">    println(<span class="string">"Consumer pauses for 150ms"</span>)</span><br><span class="line">    delay(<span class="number">150</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Next element is available immediately</span></span><br><span class="line">    nextElement = withTimeoutOrNull(<span class="number">1</span>) &#123; tickerChannel.receive() &#125;</span><br><span class="line">    println(<span class="string">"Next element is available immediately after large consumer delay: $nextElement"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note that the pause between `receive` calls is taken into account and next element arrives faster</span></span><br><span class="line">    nextElement = withTimeoutOrNull(<span class="number">60</span>) &#123; tickerChannel.receive() &#125;</span><br><span class="line">    println(<span class="string">"Next element is ready in 50ms after consumer pause in 150ms: $nextElement"</span>)</span><br><span class="line"></span><br><span class="line">    tickerChannel.cancel() <span class="comment">// indicate that no more elements are needed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Initial element is available immediately: kotlin.Unit</span><br><span class="line">Next element is not ready in 50 ms: null</span><br><span class="line">Next element is ready in 100 ms: kotlin.Unit</span><br><span class="line">Consumer pauses for 150ms</span><br><span class="line">Next element is available immediately after large consumer delay: kotlin.Unit</span><br><span class="line">Next element is ready in 50ms after consumer pause in 150ms: kotlin.Unit</span><br></pre></td></tr></table></figure><h3 id="Composing-suspending-functions"><a href="#Composing-suspending-functions" class="headerlink" title="Composing suspending functions"></a>Composing suspending functions</h3><h4 id="Sequential"><a href="#Sequential" class="headerlink" title="Sequential"></a>Sequential</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">suspend fun <span class="title">doSomethingUsefulOne</span><span class="params">()</span>: Int </span>&#123;</span><br><span class="line">    delay(<span class="number">1000L</span>) <span class="comment">// pretend we are doing something useful here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">suspend fun <span class="title">doSomethingUsefulTwo</span><span class="params">()</span>: Int </span>&#123;</span><br><span class="line">    delay(<span class="number">1000L</span>) <span class="comment">// pretend we are doing something useful here, too</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">29</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val time = measureTimeMillis &#123;</span><br><span class="line">    val one = doSomethingUsefulOne()</span><br><span class="line">    val two = doSomethingUsefulTwo()</span><br><span class="line">    println(<span class="string">"The answer is $&#123;one + two&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">"Completed in $time ms"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The answer is 42</span><br><span class="line">Completed in 2013 ms</span><br></pre></td></tr></table></figure><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val time = measureTimeMillis &#123;</span><br><span class="line">    val one = async &#123; doSomethingUsefulOne() &#125;</span><br><span class="line">    val two = async &#123; doSomethingUsefulTwo() &#125;</span><br><span class="line">    println(<span class="string">"The answer is $&#123;one.await() + two.await()&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">"Completed in $time ms"</span>)</span><br></pre></td></tr></table></figure><h4 id="Lazily-started-async"><a href="#Lazily-started-async" class="headerlink" title="Lazily started async"></a>Lazily started async</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val time = measureTimeMillis &#123;</span><br><span class="line">    val one = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulOne() &#125;</span><br><span class="line">    val two = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulTwo() &#125;</span><br><span class="line">    <span class="comment">// some computation</span></span><br><span class="line">    one.start() <span class="comment">// start the first one</span></span><br><span class="line">    two.start() <span class="comment">// start the second one</span></span><br><span class="line">    println(<span class="string">"The answer is $&#123;one.await() + two.await()&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">"Completed in $time ms"</span>)</span><br></pre></td></tr></table></figure><h4 id="Async-style-functions"><a href="#Async-style-functions" class="headerlink" title="Async-style functions"></a>Async-style functions</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The result type of somethingUsefulOneAsync is Deferred&lt;Int&gt;</span></span><br><span class="line"><span class="function">fun <span class="title">somethingUsefulOneAsync</span><span class="params">()</span> </span>= GlobalScope.async &#123;</span><br><span class="line">    doSomethingUsefulOne()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The result type of somethingUsefulTwoAsync is Deferred&lt;Int&gt;</span></span><br><span class="line"><span class="function">fun <span class="title">somethingUsefulTwoAsync</span><span class="params">()</span> </span>= GlobalScope.async &#123;</span><br><span class="line">    doSomethingUsefulTwo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val time = measureTimeMillis &#123;</span><br><span class="line">        <span class="comment">// we can initiate async actions outside of a coroutine</span></span><br><span class="line">        val one = somethingUsefulOneAsync()</span><br><span class="line">        val two = somethingUsefulTwoAsync()</span><br><span class="line">        <span class="comment">// but waiting for a result must involve either suspending or blocking.</span></span><br><span class="line">        <span class="comment">// here we use `runBlocking &#123; ... &#125;` to block the main thread while waiting for the result</span></span><br><span class="line">        runBlocking &#123;</span><br><span class="line">            println(<span class="string">"The answer is $&#123;one.await() + two.await()&#125;"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Completed in $time ms"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Coroutine-context-and-dispatchers"><a href="#Coroutine-context-and-dispatchers" class="headerlink" title="Coroutine context and dispatchers"></a>Coroutine context and dispatchers</h3><ul><li>Dispatchers and threads: Coroutine context includes a coroutine dispatcher that determines what thread or threads the corresponding coroutine uses for its execution. Coroutine dispatcher can confine coroutine execution to a specific thread, dispatch it to a thread pool, or let it run unconfined.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">launch &#123; <span class="comment">// context of the parent, main runBlocking coroutine</span></span><br><span class="line">    println(<span class="string">"main runBlocking      : I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">launch(Dispatchers.Unconfined) &#123; <span class="comment">// not confined -- will work with main thread</span></span><br><span class="line">    println(<span class="string">"Unconfined            : I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">launch(Dispatchers.Default) &#123; <span class="comment">// will get dispatched to DefaultDispatcher </span></span><br><span class="line">    println(<span class="string">"Default               : I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line">launch(newSingleThreadContext(<span class="string">"MyOwnThread"</span>)) &#123; <span class="comment">// will get its own new thread</span></span><br><span class="line">    println(<span class="string">"newSingleThreadContext: I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unconfined            : I'm working in thread main @coroutine#3</span><br><span class="line">Default               : I'm working in thread DefaultDispatcher-worker-1 @coroutine#4</span><br><span class="line">main runBlocking      : I'm working in thread main @coroutine#2</span><br><span class="line">newSingleThreadContext: I'm working in thread MyOwnThread @coroutine#5</span><br></pre></td></tr></table></figure><p>When launch { … } is used without parameters, it inherits the context (and thus dispatcher) from the CoroutineScope that it is being launched from. In this case, it inherits the context of the main runBlocking coroutine which runs in the main thread.</p><ol><li><p>Dispatchers.Unconfined is a special dispatcher that also appears to run in the main thread, but it is, in fact, a different mechanism that is explained later.</p></li><li><p>The default dispatcher, that is used when coroutines are launched in GlobalScope, is represented by Dispatchers.Default and uses shared background pool of threads, so launch(Dispatchers.Default) { … } uses the same dispatcher as GlobalScope.launch { … }.</p></li><li><p>newSingleThreadContext creates a thread for the coroutine to run. A dedicated thread is a very expensive resource. In a real application it must be either released, when no longer needed, using close function, or stored in a top-level variable and reused throughout the application.</p></li></ol><h4 id="Unconfined-vs-confined-dispatcher"><a href="#Unconfined-vs-confined-dispatcher" class="headerlink" title="Unconfined vs confined dispatcher"></a>Unconfined vs confined dispatcher</h4><p>The Dispatchers.Unconfined coroutine dispatcher starts coroutine in the caller thread, but only until the first suspension point. After suspension it resumes in the thread that is fully determined by the suspending function that was invoked. Unconfined dispatcher is appropriate when coroutine does not consume CPU time nor updates any shared data (like UI) that is confined to a specific thread.</p><p>On the other side, by default, a dispatcher for the outer CoroutineScope is inherited. The default dispatcher for runBlocking coroutine, in particular, is confined to the invoker thread, so inheriting it has the effect of confining execution to this thread with a predictable FIFO scheduling.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function">fun <span class="title">test</span><span class="params">()</span> </span>= runBlocking &#123;</span><br><span class="line">    <span class="comment">//sampleStart</span></span><br><span class="line">    launch(Dispatchers.Unconfined) &#123;</span><br><span class="line">        <span class="comment">// not confined -- will work with main thread</span></span><br><span class="line">        println(<span class="string">"Unconfined      : I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">        delay(<span class="number">500</span>)</span><br><span class="line">        println(<span class="string">"Unconfined      : After delay in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    launch &#123;</span><br><span class="line">        <span class="comment">// context of the parent, main runBlocking coroutine</span></span><br><span class="line">        println(<span class="string">"main runBlocking: I'm working in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">"main runBlocking: After delay in thread $&#123;Thread.currentThread().name&#125;"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//sampleEnd</span></span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unconfined      : I'm working in thread main @coroutine#2</span><br><span class="line">main runBlocking: I'm working in thread main @coroutine#3</span><br><span class="line">Unconfined      : After delay in thread kotlinx.coroutines.DefaultExecutor @coroutine#2</span><br><span class="line">main runBlocking: After delay in thread main @coroutine#3</span><br></pre></td></tr></table></figure><h4 id="Debugging-coroutines-and-threads"><a href="#Debugging-coroutines-and-threads" class="headerlink" title="Debugging coroutines and threads"></a>Debugging coroutines and threads</h4><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://kotlinlang.org/docs/reference/coroutines/basics.html" target="_blank" rel="noopener">https://kotlinlang.org/docs/reference/coroutines/basics.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Basic-Practice&quot;&gt;&lt;a href=&quot;#Basic-Practice&quot; class=&quot;headerlink&quot; title=&quot;Basic Practice&quot;&gt;&lt;/a&gt;Basic Practice&lt;/h3&gt;&lt;h4 id=&quot;First-Example&quot;&gt;&lt;a
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Kotlin" scheme="https://sulangsss.github.io/categories/Java/Kotlin/"/>
    
    
      <category term="Java" scheme="https://sulangsss.github.io/tags/Java/"/>
    
      <category term="Kotlin" scheme="https://sulangsss.github.io/tags/Kotlin/"/>
    
      <category term="coroutine" scheme="https://sulangsss.github.io/tags/coroutine/"/>
    
  </entry>
  
  <entry>
    <title>RxJava Quick Start</title>
    <link href="https://sulangsss.github.io/2019/07/06/Java/Rx/Rx-Quick-Start/"/>
    <id>https://sulangsss.github.io/2019/07/06/Java/Rx/Rx-Quick-Start/</id>
    <published>2019-07-06T06:22:22.000Z</published>
    <updated>2019-07-16T14:30:12.961Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basic-Theory"><a href="#Basic-Theory" class="headerlink" title="Basic Theory"></a>Basic Theory</h3><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/components-of-the-rxjava.png"><ul><li>Flowable: 多个流，响应式流和背压</li><li>Observable: 多个流，无背压</li><li>Single: 只有一个元素或者错误的流</li></ul><h3 id="Testing-Model"><a href="#Testing-Model" class="headerlink" title="Testing Model"></a>Testing Model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class DataManager(size: Int = 16) &#123;</span><br><span class="line">    <span class="keyword">private</span> val data = mutableListOf&lt;Student&gt;()</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        <span class="keyword">for</span> (index in <span class="number">0</span> until size) &#123;</span><br><span class="line">            val student = Student(<span class="string">"Jack-$index"</span>, mutableListOf(Course(<span class="string">"English-$index"</span>)))</span><br><span class="line">            data.add(student)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">fun <span class="title">queryOrigin</span><span class="params">()</span>: MutableList&lt;Student&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">data class <span class="title">Student</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    var name: String,</span></span></span><br><span class="line"><span class="function"><span class="params">    var courses: MutableList&lt;Course&gt; = mutableListOf()</span></span></span><br><span class="line"><span class="function">)</span></span><br><span class="line"><span class="function">data class <span class="title">Course</span><span class="params">(var name: String)</span></span></span><br></pre></td></tr></table></figure><hr><h3 id="Transforming-Observables"><a href="#Transforming-Observables" class="headerlink" title="Transforming Observables"></a>Transforming Observables</h3><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>transform the items emitted by an Observable by applying a function to each item</p><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/map-execution.png"><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .map &#123; it.toDouble() &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            println(it)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="flatMap-vs-concatMap"><a href="#flatMap-vs-concatMap" class="headerlink" title="flatMap vs concatMap"></a>flatMap vs concatMap</h4><p>transform the items emitted by an Observable into Observables, then <strong>flatten the emissions from those into a single Observable</strong></p><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/rx-flatmap.png"><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">val dataManager = DataManager()</span><br><span class="line">val flatCourse = mutableListOf&lt;Course&gt;()</span><br><span class="line">val queryOrigin = dataManager.queryOrigin()</span><br><span class="line">Observable.fromIterable(queryOrigin)</span><br><span class="line">        .flatMap &#123; stu -&gt;</span><br><span class="line">            Observable.fromIterable(stu.courses)</span><br><span class="line">        &#125;.subscribeOn(Schedulers.newThread())</span><br><span class="line">        .blockingSubscribe &#123; course -&gt;</span><br><span class="line">            flatCourse.add(course)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">val concatCourse = mutableListOf&lt;Course&gt;()</span><br><span class="line">Observable.fromIterable(queryOrigin)</span><br><span class="line">        .concatMap &#123; stu -&gt;</span><br><span class="line">            Observable.fromIterable(stu.courses)</span><br><span class="line">        &#125;.subscribeOn(Schedulers.newThread())</span><br><span class="line">        .blockingSubscribe &#123; course -&gt;</span><br><span class="line">            concatCourse.add(course)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">println(<span class="string">"origin = $&#123;dataManager.queryOrigin()&#125;"</span>)</span><br><span class="line">println(<span class="string">"flatMap = $flatCourse"</span>)</span><br><span class="line">println(<span class="string">"concatMap = $concatCourse"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">origin = [Student(name=Jack-<span class="number">0</span>, courses=[Course(name=English-<span class="number">0</span>)]), Student(name=Jack-<span class="number">1</span>, courses=[Course(name=English-<span class="number">1</span>)]), Student(name=Jack-<span class="number">2</span>, courses=[Course(name=English-<span class="number">2</span>)])]</span><br><span class="line">flatMap = [Course(name=English-<span class="number">0</span>), Course(name=English-<span class="number">1</span>), Course(name=English-<span class="number">2</span>)]</span><br><span class="line">concatMap = [Course(name=English-<span class="number">0</span>), Course(name=English-<span class="number">1</span>), Course(name=English-<span class="number">2</span>)]</span><br></pre></td></tr></table></figure><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/concat_vs_flatmap_1.png"><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/concat_vs_flatmap_2.png"><p>flatMap将一个发送事件的上游Observable变换为多个发送事件的Observables，然后将它们发射的事件合并后放进一个单独的Observable里。需要注意的是, flatMap并不保证事件的顺序，也就是说转换之后的Observables的顺序不必与转换之前的序列的顺序一致。</p><p>与flatMap对应的方法是contactMap，后者能够保证最终输出的顺序与上游发送的顺序一致。</p><blockquote><p>Both methods look pretty much the same, but there is a difference: operator usage when merging the final results.</p></blockquote><blockquote><p>The <strong>flatMap()</strong> method creates a new Observable by applying a function that you supply to each item emitted by the original Observable, where that function is itself an Observable that emits items, and then merges the results of that function applied to every item emitted by the original Observable, emitting these merged results.</p></blockquote><blockquote><p>Note that <strong>flatMap()</strong> may interleave the items emitted by the Observables that result from transforming the items emitted by the source Observable.</p></blockquote><blockquote><p>If it is important that these items not be <strong>interleaved</strong>, you can instead use the similar <strong>concatMap()</strong> method.</p></blockquote><blockquote><p>FlatMap对这些Observables发射的数据做的是合并(merge)操作，因此它们可能是交错的。也就说，传入的顺序可能跟出来的顺序不一样。如果要保证顺的的话，可以使用concatMap。</p></blockquote><h4 id="flatMapIterable"><a href="#flatMapIterable" class="headerlink" title="flatMapIterable"></a>flatMapIterable</h4><h4 id="switchMap"><a href="#switchMap" class="headerlink" title="switchMap"></a>switchMap</h4><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">val dataManager = DataManager()</span><br><span class="line"></span><br><span class="line">val switchMapCourse = mutableListOf&lt;String&gt;()</span><br><span class="line">val queryOrigin = dataManager.queryOrigin()</span><br><span class="line"></span><br><span class="line">Observable.fromIterable(queryOrigin)</span><br><span class="line">        .switchMap &#123; stu -&gt;</span><br><span class="line">            Observable.timer(<span class="number">1</span>, TimeUnit.SECONDS)</span><br><span class="line">                    .map &#123; stu.name &#125;</span><br><span class="line">        &#125;.subscribeOn(Schedulers.newThread())</span><br><span class="line">        .blockingSubscribe &#123; course -&gt;</span><br><span class="line">            switchMapCourse.add(course)</span><br><span class="line">        &#125;</span><br><span class="line">println(<span class="string">"origin = $&#123;dataManager.queryOrigin()&#125;"</span>)</span><br><span class="line">println(<span class="string">"switchMap = $switchMapCourse"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">origin = [Student(name=Jack-<span class="number">0</span>, courses=[Course(name=English-<span class="number">0</span>)]), Student(name=Jack-<span class="number">1</span>, courses=[Course(name=English-<span class="number">1</span>)]), Student(name=Jack-<span class="number">2</span>, courses=[Course(name=English-<span class="number">2</span>)])]</span><br><span class="line">switchMap = [Jack-<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>If just return a normal observable on switchMap(), example:</p><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromIterable(queryOrigin)</span><br><span class="line">        .switchMap &#123; stu -&gt;</span><br><span class="line">            Observable.just(stu.name)</span><br><span class="line">        &#125;.subscribeOn(Schedulers.newThread())</span><br><span class="line">        .blockingSubscribe &#123; course -&gt;</span><br><span class="line">            switchMapCourse.add(course)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">origin = [Student(name=Jack-<span class="number">0</span>, courses=[Course(name=English-<span class="number">0</span>)]), Student(name=Jack-<span class="number">1</span>, courses=[Course(name=English-<span class="number">1</span>)]), Student(name=Jack-<span class="number">2</span>, courses=[Course(name=English-<span class="number">2</span>)])]</span><br><span class="line">switchMap = [Jack-<span class="number">0</span>, Jack-<span class="number">1</span>, Jack-<span class="number">2</span>]</span><br></pre></td></tr></table></figure><h4 id="cast"><a href="#cast" class="headerlink" title="cast"></a>cast</h4><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        .cast(Number.class)</span><br><span class="line">        .subscribe(num -&gt; println(num)));</span><br></pre></td></tr></table></figure><h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p>apply a function to each item emitted by an Observable, sequentially, and emit each successive value</p><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">val dataManager = DataManager()</span><br><span class="line"></span><br><span class="line">val scanStudent = mutableListOf&lt;Student&gt;()</span><br><span class="line">val queryOrigin = dataManager.queryOrigin()</span><br><span class="line"></span><br><span class="line">Observable.fromIterable(queryOrigin)</span><br><span class="line">        .scan &#123; lastStu: Student, student: Student -&gt;</span><br><span class="line">            println(<span class="string">"---------------------"</span>)</span><br><span class="line">            println(<span class="string">"lastStu $&#123;lastStu.name&#125;"</span>)</span><br><span class="line">            println(<span class="string">"current Stu $&#123;student.name&#125;"</span>)</span><br><span class="line">            println(<span class="string">"next Stu $&#123;lastStu.name&#125; + $&#123;student.name&#125;"</span>)</span><br><span class="line">            Student(name = <span class="string">"$&#123;lastStu.name&#125; + $&#123;student.name&#125;"</span>)</span><br><span class="line">        &#125;.subscribe &#123;</span><br><span class="line">            scanStudent.add(it)</span><br><span class="line">        &#125;</span><br><span class="line">println(<span class="string">"===================================================================================="</span>)</span><br><span class="line">println(<span class="string">"origin = $&#123;dataManager.queryOrigin()&#125;"</span>)</span><br><span class="line">println(<span class="string">"===================================================================================="</span>)</span><br><span class="line"><span class="keyword">for</span> (student in scanStudent) &#123;</span><br><span class="line">    println(<span class="string">"student $&#123;student.name&#125;"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---------------------</span><br><span class="line">lastStu Jack-<span class="number">0</span></span><br><span class="line">current Stu Jack-<span class="number">1</span></span><br><span class="line">next Stu Jack-<span class="number">0</span> + Jack-<span class="number">1</span></span><br><span class="line">---------------------</span><br><span class="line">lastStu Jack-<span class="number">0</span> + Jack-<span class="number">1</span></span><br><span class="line">current Stu Jack-<span class="number">2</span></span><br><span class="line">next Stu Jack-<span class="number">0</span> + Jack-<span class="number">1</span> + Jack-<span class="number">2</span></span><br><span class="line">====================================================================================</span><br><span class="line">origin = [Student(name=Jack-<span class="number">0</span>, courses=[Course(name=English-<span class="number">0</span>)]), Student(name=Jack-<span class="number">1</span>, courses=[Course(name=English-<span class="number">1</span>)]), Student(name=Jack-<span class="number">2</span>, courses=[Course(name=English-<span class="number">2</span>)])]</span><br><span class="line">====================================================================================</span><br><span class="line">student Jack-<span class="number">0</span></span><br><span class="line">student Jack-<span class="number">0</span> + Jack-<span class="number">1</span></span><br><span class="line">student Jack-<span class="number">0</span> + Jack-<span class="number">1</span> + Jack-<span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h4><p>periodically gather items from an Observable into bundles and emit these bundles rather than emitting the items one at a time</p><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>)</span><br><span class="line">        .buffer(<span class="number">2</span>)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            println(it)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>periodically subdivide items from an Observable into Observable windows and emit these windows rather than emitting the items one at a time</p><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/rx-window-theory.png"><p>Window is similar to Buffer, but rather than emitting packets of items from the source Observable, it emits Observables, each one of which emits a subset of items from the source Observable and then terminates with an onCompleted notification. </p><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/rx-buffer-vs-windwos-1.png"><img src="/2019/07/06/Java/Rx/Rx-Quick-Start/rx-buffer-vs-windwos-2.png"><p>Window和Buffer类似，但不是发射来自原始Observable的数据包，它发射的是Observable，这些Observables中的每一个都发射原始Observable数据的一个子集，最后发射一个onCompleted通知。<br>以下面的程序为例，这里我们首先生成了一个由10个数字组成的整数序列，然后使用window函数将它们每3个作为一组，每组会返回一个对应的Observable对象。<br>这里我们对该返回的结果进行订阅并进行消费，因为10个数字，所以会被分成4个组，每个对应一个Observable：</p><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(<span class="number">1</span>, <span class="number">10</span>).window(<span class="number">3</span>)</span><br><span class="line">            .subscribe &#123; observable -&gt;</span><br><span class="line">                observable.subscribe &#123; integer -&gt;</span><br><span class="line">                    println(observable.hashCode().toString() + <span class="string">" : "</span> + integer)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">901506536</span> : <span class="number">1</span></span><br><span class="line"><span class="number">901506536</span> : <span class="number">2</span></span><br><span class="line"><span class="number">901506536</span> : <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="number">747464370</span> : <span class="number">4</span></span><br><span class="line"><span class="number">747464370</span> : <span class="number">5</span></span><br><span class="line"><span class="number">747464370</span> : <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="number">1513712028</span> : <span class="number">7</span></span><br><span class="line"><span class="number">1513712028</span> : <span class="number">8</span></span><br><span class="line"><span class="number">1513712028</span> : <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="number">1018547642</span> : <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h4><p>divide an Observable into a set of Observables that each emit a different group of items from the original Observable, organized by key</p><p>groupBy用于分组元素，它可以被用来根据指定的条件将元素分成若干组。</p><p><strong>Example 1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.concat(</span><br><span class="line">            Observable.range(<span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">            Observable.range(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">    ).groupBy &#123; integer -&gt;</span><br><span class="line">        integer</span><br><span class="line">    &#125;.subscribe &#123; groupedObservable: GroupedObservable&lt;Int, Int&gt; -&gt;</span><br><span class="line">        groupedObservable.subscribe &#123; println(<span class="string">"key $&#123;groupedObservable.key&#125; -&gt; value $it"</span>) &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">key <span class="number">1</span> -&gt; value <span class="number">1</span></span><br><span class="line">key <span class="number">2</span> -&gt; value <span class="number">2</span></span><br><span class="line">key <span class="number">3</span> -&gt; value <span class="number">3</span></span><br><span class="line">key <span class="number">4</span> -&gt; value <span class="number">4</span></span><br><span class="line">key <span class="number">1</span> -&gt; value <span class="number">1</span></span><br><span class="line">key <span class="number">2</span> -&gt; value <span class="number">2</span></span><br><span class="line">key <span class="number">3</span> -&gt; value <span class="number">3</span></span><br><span class="line">key <span class="number">4</span> -&gt; value <span class="number">4</span></span><br><span class="line">key <span class="number">5</span> -&gt; value <span class="number">5</span></span><br><span class="line">key <span class="number">6</span> -&gt; value <span class="number">6</span></span><br></pre></td></tr></table></figure><hr><h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><h4 id="average"><a href="#average" class="headerlink" title="average"></a>average</h4><h4 id="count"><a href="#count" class="headerlink" title="count"></a>count</h4><h4 id="max"><a href="#max" class="headerlink" title="max"></a>max</h4><h4 id="min"><a href="#min" class="headerlink" title="min"></a>min</h4><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>apply a function to each item emitted by an Observable, sequentially, and emit the final value</p><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="http://reactivex.io/documentation/operators.html" target="_blank" rel="noopener">http://reactivex.io/documentation/operators.html</a></li><li><a href="https://maxwell-nc.github.io/android/rxjava2-6.html" target="_blank" rel="noopener">https://maxwell-nc.github.io/android/rxjava2-6.html</a></li><li><a href="https://medium.com/mindorks/rxjava-operator-map-vs-flatmap-427c09678784" target="_blank" rel="noopener">https://medium.com/mindorks/rxjava-operator-map-vs-flatmap-427c09678784</a></li><li><a href="https://fernandocejas.com/2015/01/11/rxjava-observable-tranformation-concatmap-vs-flatmap/" target="_blank" rel="noopener">https://fernandocejas.com/2015/01/11/rxjava-observable-tranformation-concatmap-vs-flatmap/</a></li><li><a href="https://my.oschina.net/u/2277632/blog/2986715" target="_blank" rel="noopener">https://my.oschina.net/u/2277632/blog/2986715</a></li><li><a href="https://juejin.im/post/5b72f76551882561354462dd" target="_blank" rel="noopener">https://juejin.im/post/5b72f76551882561354462dd</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Basic-Theory&quot;&gt;&lt;a href=&quot;#Basic-Theory&quot; class=&quot;headerlink&quot; title=&quot;Basic Theory&quot;&gt;&lt;/a&gt;Basic Theory&lt;/h3&gt;&lt;img src=&quot;/2019/07/06/Java/Rx/Rx-
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="RxJava" scheme="https://sulangsss.github.io/categories/Java/RxJava/"/>
    
    
      <category term="QuickStart" scheme="https://sulangsss.github.io/tags/QuickStart/"/>
    
      <category term="RxJava" scheme="https://sulangsss.github.io/tags/RxJava/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin sort</title>
    <link href="https://sulangsss.github.io/2019/07/06/Java/Kotlin/sort/"/>
    <id>https://sulangsss.github.io/2019/07/06/Java/Kotlin/sort/</id>
    <published>2019-07-05T16:08:22.000Z</published>
    <updated>2019-07-06T06:15:53.380Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Define-Class"><a href="#Define-Class" class="headerlink" title="Define Class"></a>Define Class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">data class <span class="title">Person</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    var name: String = <span class="string">""</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    var age: Int = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    var money: Double = <span class="number">0.0</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><hr><h3 id="sortBy"><a href="#sortBy" class="headerlink" title="sortBy"></a>sortBy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val persons = mutableListOf&lt;Person&gt;()</span><br><span class="line"></span><br><span class="line">persons.add(Person(<span class="string">"Hello-1"</span>, <span class="number">1</span>, <span class="number">10.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-5"</span>, <span class="number">5</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-3"</span>, <span class="number">3</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-2"</span>, <span class="number">2</span>, <span class="number">100.0</span>))</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br><span class="line">println(<span class="string">"========================="</span>)</span><br><span class="line">persons.sortBy &#123; it.age &#125;</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person(name=Hello-<span class="number">1</span>, age=<span class="number">1</span>, money=<span class="number">10.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">5</span>, age=<span class="number">5</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">3</span>, age=<span class="number">3</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">2</span>, age=<span class="number">2</span>, money=<span class="number">100.0</span>)</span><br><span class="line">=========================</span><br><span class="line">Person(name=Hello-<span class="number">1</span>, age=<span class="number">1</span>, money=<span class="number">10.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">2</span>, age=<span class="number">2</span>, money=<span class="number">100.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">3</span>, age=<span class="number">3</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">5</span>, age=<span class="number">5</span>, money=<span class="number">20.0</span>)</span><br></pre></td></tr></table></figure><p>sortBy 为正序排列，跟其对应的降序方法为 sortByDescending。</p><hr><h3 id="sortWith"><a href="#sortWith" class="headerlink" title="sortWith"></a>sortWith</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">val persons = mutableListOf&lt;Person&gt;()</span><br><span class="line"></span><br><span class="line">persons.add(Person(<span class="string">"Hello-1"</span>, <span class="number">1</span>, <span class="number">10.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-5"</span>, <span class="number">5</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-3"</span>, <span class="number">3</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-2"</span>, <span class="number">2</span>, <span class="number">100.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-6"</span>, <span class="number">2</span>, <span class="number">50.0</span>))</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br><span class="line">println(<span class="string">"========================="</span>)</span><br><span class="line">persons.sortWith(compareBy(&#123; it.age &#125;, &#123; it.money &#125;))</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Person(name=Hello-<span class="number">1</span>, age=<span class="number">1</span>, money=<span class="number">10.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">5</span>, age=<span class="number">5</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">3</span>, age=<span class="number">3</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">2</span>, age=<span class="number">2</span>, money=<span class="number">100.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">6</span>, age=<span class="number">2</span>, money=<span class="number">50.0</span>)</span><br><span class="line">=========================</span><br><span class="line">Person(name=Hello-<span class="number">1</span>, age=<span class="number">1</span>, money=<span class="number">10.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">6</span>, age=<span class="number">2</span>, money=<span class="number">50.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">2</span>, age=<span class="number">2</span>, money=<span class="number">100.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">3</span>, age=<span class="number">3</span>, money=<span class="number">20.0</span>)</span><br><span class="line">Person(name=Hello-<span class="number">5</span>, age=<span class="number">5</span>, money=<span class="number">20.0</span>)</span><br></pre></td></tr></table></figure><p>sortWith 方法中，传入的 compareBy({属性1},{属性2},…)参数，参数个数是可变的。但是都是默认的升序排列。</p><p>可以给sortWith传入一个Comparator对象，来达到一个更高级更复杂的逻辑。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">val persons = mutableListOf&lt;Person&gt;()</span><br><span class="line"></span><br><span class="line">persons.add(Person(<span class="string">"Hello-1"</span>, <span class="number">1</span>, <span class="number">10.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-5"</span>, <span class="number">5</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-3"</span>, <span class="number">3</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-2"</span>, <span class="number">2</span>, <span class="number">100.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-6"</span>, <span class="number">2</span>, <span class="number">50.0</span>))</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br><span class="line">println(<span class="string">"========================="</span>)</span><br><span class="line">val comparator: Comparator&lt;Person&gt; = Comparator &#123; o1, o2 -&gt;</span><br><span class="line">    <span class="keyword">if</span> (o2.age == o1.age) &#123;</span><br><span class="line">        o1.money.compareTo(o2.money)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        o1.age - o2.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">persons.sortWith(comparator)</span><br><span class="line"><span class="comment">//  persons.sortWith(compareBy(&#123; it.age &#125;, &#123; it.money &#125;))</span></span><br><span class="line">persons.forEach(::println)</span><br></pre></td></tr></table></figure><hr><h3 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">data class <span class="title">Person</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    var name: String = <span class="string">""</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    var age: Int = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    var money: Double = <span class="number">0.0</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span> : Comparable&lt;Person&gt; </span>&#123;</span><br><span class="line">    <span class="function">override fun <span class="title">compareTo</span><span class="params">(other: Person)</span>: Int </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (other.age == <span class="keyword">this</span>.age) &#123;</span><br><span class="line">            <span class="keyword">this</span>.money.compareTo(other.money)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.age - other.age</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val persons = mutableListOf&lt;Person&gt;()</span><br><span class="line"></span><br><span class="line">persons.add(Person(<span class="string">"Hello-1"</span>, <span class="number">1</span>, <span class="number">10.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-5"</span>, <span class="number">5</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-3"</span>, <span class="number">3</span>, <span class="number">20.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-2"</span>, <span class="number">2</span>, <span class="number">100.0</span>))</span><br><span class="line">persons.add(Person(<span class="string">"Hello-6"</span>, <span class="number">2</span>, <span class="number">50.0</span>))</span><br><span class="line"></span><br><span class="line">persons.forEach(::println)</span><br><span class="line">println(<span class="string">"========================="</span>)</span><br><span class="line">persons.sort()</span><br><span class="line">persons.forEach(::println)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Define-Class&quot;&gt;&lt;a href=&quot;#Define-Class&quot; class=&quot;headerlink&quot; title=&quot;Define Class&quot;&gt;&lt;/a&gt;Define Class&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;t
      
    
    </summary>
    
      <category term="Java" scheme="https://sulangsss.github.io/categories/Java/"/>
    
      <category term="Kotlin" scheme="https://sulangsss.github.io/categories/Java/Kotlin/"/>
    
    
      <category term="Kotlin" scheme="https://sulangsss.github.io/tags/Kotlin/"/>
    
      <category term="sort" scheme="https://sulangsss.github.io/tags/sort/"/>
    
  </entry>
  
  <entry>
    <title>Linux total-vm and rss</title>
    <link href="https://sulangsss.github.io/2019/06/28/Linux/Basic/total-vm-and-rss/"/>
    <id>https://sulangsss.github.io/2019/06/28/Linux/Basic/total-vm-and-rss/</id>
    <published>2019-06-28T09:00:06.000Z</published>
    <updated>2019-06-28T09:03:19.328Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Issue: GCP kill some pod at node</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Memory cgroup out of memory: Kill process 2177348 (java) score 1465 or sacrifice child Killed process 2177348 (java) total-vm:19172696kB, anon-rss:12547720kB, file-rss:17176kB, shmem-rss:57592kB</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;Issue: GCP kill some pod at no
      
    
    </summary>
    
      <category term="Linux" scheme="https://sulangsss.github.io/categories/Linux/"/>
    
      <category term="Basic" scheme="https://sulangsss.github.io/categories/Linux/Basic/"/>
    
    
      <category term="Linux" scheme="https://sulangsss.github.io/tags/Linux/"/>
    
      <category term="Basic" scheme="https://sulangsss.github.io/tags/Basic/"/>
    
      <category term="rss" scheme="https://sulangsss.github.io/tags/rss/"/>
    
      <category term="total-vm" scheme="https://sulangsss.github.io/tags/total-vm/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 如何高效地插入大量数据</title>
    <link href="https://sulangsss.github.io/2019/06/04/DB/MySQL/How-Batch-Insert-Large-Data/"/>
    <id>https://sulangsss.github.io/2019/06/04/DB/MySQL/How-Batch-Insert-Large-Data/</id>
    <published>2019-06-04T01:55:07.000Z</published>
    <updated>2019-06-04T02:48:10.143Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://www.cnblogs.com/micrari/p/7112781.html" target="_blank" rel="noopener">https://www.cnblogs.com/micrari/p/7112781.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/mic
      
    
    </summary>
    
      <category term="DB" scheme="https://sulangsss.github.io/categories/DB/"/>
    
      <category term="MySQL" scheme="https://sulangsss.github.io/categories/DB/MySQL/"/>
    
    
      <category term="DB" scheme="https://sulangsss.github.io/tags/DB/"/>
    
      <category term="MySQL" scheme="https://sulangsss.github.io/tags/MySQL/"/>
    
      <category term="Prepared-Statements" scheme="https://sulangsss.github.io/tags/Prepared-Statements/"/>
    
  </entry>
  
  <entry>
    <title>Command Query Responsibility Segregation</title>
    <link href="https://sulangsss.github.io/2019/06/04/Architecture/CQRS/Command%20Query%20Responsibility%20Segregation/"/>
    <id>https://sulangsss.github.io/2019/06/04/Architecture/CQRS/Command Query Responsibility Segregation/</id>
    <published>2019-06-03T16:47:19.000Z</published>
    <updated>2019-06-04T02:45:41.612Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://microservices.io/patterns/data/cqrs.html" target="_blank" rel="noopener">https://microservices.io/patterns/data/cqrs.html</a></li><li><a href="https://spring.io/blog/2016/03/22/springone2gx-2015-replay-building-microservices-with-event-sourcing-and-cqrs" target="_blank" rel="noopener">https://spring.io/blog/2016/03/22/springone2gx-2015-replay-building-microservices-with-event-sourcing-and-cqrs</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://microservices.io/pa
      
    
    </summary>
    
      <category term="Architecture" scheme="https://sulangsss.github.io/categories/Architecture/"/>
    
      <category term="CQRS" scheme="https://sulangsss.github.io/categories/Architecture/CQRS/"/>
    
    
      <category term="CQRS" scheme="https://sulangsss.github.io/tags/CQRS/"/>
    
  </entry>
  
  <entry>
    <title>Tools Menu</title>
    <link href="https://sulangsss.github.io/2019/06/02/Tools/Tools-Menu/"/>
    <id>https://sulangsss.github.io/2019/06/02/Tools/Tools-Menu/</id>
    <published>2019-06-02T03:34:06.000Z</published>
    <updated>2019-06-02T03:45:10.621Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><h4 id="ShellCheck"><a href="#ShellCheck" class="headerlink" title="ShellCheck"></a>ShellCheck</h4><p>ShellCheck - A shell script static analysis tool</p><blockquote><p><a href="https://github.com/koalaman/shellcheck" target="_blank" rel="noopener">https://github.com/koalaman/shellcheck</a></p></blockquote><hr><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="Dockly"><a href="#Dockly" class="headerlink" title="Dockly"></a>Dockly</h4><ol><li><p>Install</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g dockly</span><br></pre></td></tr></table></figure></li><li><p>Usage</p></li></ol><ul><li>= – Refresh the Dockly interface,</li><li>/ – Search the containers list view,</li><li>i – Display the information about the currently selected container or service,</li><li><return> – Show logs of the current container or service,</return></li><li>v – Toggle between Containers and Services view,</li><li>l – Launch a /bin/bash session on the selected Container,</li><li>r – Restart the selected Container,</li><li>s – Stop the selected Container,</li><li>h – Show HELP window,</li><li>q – Quit Dockly.</li></ul><blockquote><p><a href="https://github.com/lirantal/" target="_blank" rel="noopener">https://github.com/lirantal/</a><br><a href="https://www.ostechnix.com/install-node-js-linux/" target="_blank" rel="noopener">https://www.ostechnix.com/install-node-js-linux/</a><br><a href="https://www.ostechnix.com/dockly-manage-docker-containers-from-terminal/" target="_blank" rel="noopener">https://www.ostechnix.com/dockly-manage-docker-containers-from-terminal/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Shell&quot;&gt;&lt;a href=&quot;#Shell&quot; class=&quot;headerlink&quot; title=&quot;Shell&quot;&gt;&lt;/a&gt;Shell&lt;/h3&gt;&lt;h4 id=&quot;ShellCheck&quot;&gt;&lt;a href=&quot;#ShellCheck&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
      <category term="Tools" scheme="https://sulangsss.github.io/categories/Tools/"/>
    
    
      <category term="Tools Menu" scheme="https://sulangsss.github.io/tags/Tools-Menu/"/>
    
  </entry>
  
  <entry>
    <title>ip-masq-agent</title>
    <link href="https://sulangsss.github.io/2019/05/31/Kubenetes/GCP/ip-masq-agent/"/>
    <id>https://sulangsss.github.io/2019/05/31/Kubenetes/GCP/ip-masq-agent/</id>
    <published>2019-05-31T03:15:06.000Z</published>
    <updated>2019-05-31T03:15:38.035Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/ip-masquerade-agent#create_manual" target="_blank" rel="noopener">https://cloud.google.com/kubernetes-engine/docs/how-to/ip-masquerade-agent#create_manual</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.google.com/ku
      
    
    </summary>
    
      <category term="Kubernetes" scheme="https://sulangsss.github.io/categories/Kubernetes/"/>
    
      <category term="GCP" scheme="https://sulangsss.github.io/categories/Kubernetes/GCP/"/>
    
    
      <category term="GCP" scheme="https://sulangsss.github.io/tags/GCP/"/>
    
      <category term="ip-masq-agent" scheme="https://sulangsss.github.io/tags/ip-masq-agent/"/>
    
  </entry>
  
  <entry>
    <title>Mockito</title>
    <link href="https://sulangsss.github.io/2019/05/28/TDD/Mockito/"/>
    <id>https://sulangsss.github.io/2019/05/28/TDD/Mockito/</id>
    <published>2019-05-28T11:51:19.000Z</published>
    <updated>2019-06-18T12:00:27.014Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-1-4-39a85e42b8" target="_blank" rel="noopener">https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-1-4-39a85e42b8</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;Reference&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/joe-tsai
      
    
    </summary>
    
      <category term="TDD" scheme="https://sulangsss.github.io/categories/TDD/"/>
    
    
      <category term="TDD" scheme="https://sulangsss.github.io/tags/TDD/"/>
    
      <category term="Mockito" scheme="https://sulangsss.github.io/tags/Mockito/"/>
    
  </entry>
  
  <entry>
    <title>Red-Green-Refactor Pattern</title>
    <link href="https://sulangsss.github.io/2019/05/28/TDD/Basic/Red-Green-Refactor%20Pattern/"/>
    <id>https://sulangsss.github.io/2019/05/28/TDD/Basic/Red-Green-Refactor Pattern/</id>
    <published>2019-05-28T11:51:19.000Z</published>
    <updated>2019-06-03T16:41:51.356Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://medium.com/@syukri.mullia/basic-tdd-red-green-refactor-pattern-4046381b95a6" target="_blank" rel="noopener">https://medium.com/@syukri.mullia/basic-tdd-red-green-refactor-pattern-4046381b95a6</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;h3 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Refe
      
    
    </summary>
    
      <category term="TDD" scheme="https://sulangsss.github.io/categories/TDD/"/>
    
      <category term="Basic" scheme="https://sulangsss.github.io/categories/TDD/Basic/"/>
    
    
      <category term="TDD" scheme="https://sulangsss.github.io/tags/TDD/"/>
    
      <category term="Basic-TDD" scheme="https://sulangsss.github.io/tags/Basic-TDD/"/>
    
      <category term="Red-Green" scheme="https://sulangsss.github.io/tags/Red-Green/"/>
    
  </entry>
  
  <entry>
    <title>Java JVM On Docker</title>
    <link href="https://sulangsss.github.io/2019/05/28/Docker/JVM/Java-JVM-On-Docker/"/>
    <id>https://sulangsss.github.io/2019/05/28/Docker/JVM/Java-JVM-On-Docker/</id>
    <published>2019-05-28T11:51:19.000Z</published>
    <updated>2019-05-28T12:30:45.110Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>你是否曾经经历过在Docker中运行基于JVM的应用程序时出现“随机”故障？或者一些奇怪的死机？两者都有可能是由于Java 8中的糟糕的Docker支持引起。</p><p>Docker使用控制组(cgroups)来限制对资源的使用。在容器中运行应用程序时限制其对内存和CPU的使用绝对是一个好主意，它可以防止应用程序占用全部可用的内存和/或CPU，因而导致在同一系统上运行的其他容器无法响应。限制资源的使用可以提高应用程序的可靠性和稳定性。它还为硬件容量的规划提供了依据。在像诸如Kubernetes或DC/OS这样的编排系统上运行容器时，这一点尤为重要。</p><p>JVM 可以“看到”系统上所有可用的内存和 CPU 内核，并保持与这些资源的一致。在默认情况下，JVM 会将 max heap size 设置为系统内存的 1/4，并将一些线程池个数(比如GC)设置为与物理 CPU 内核的数量一致。</p><blockquote><p>本文中使用的是遵循GNU GPL v2 许可授权的OpenJDK官方Docker镜像。这里描述的对Docker的支持在Oracle Java SE 开发工具包(JDK)版本8的更新191中被引入。Oracle在2019年4月修改了Java 8更新的许可政策，自Java SE 8更新211后的商业使用不再免费。    </p></blockquote><hr><h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>我们一起来看看下面的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryEater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Vector v = <span class="keyword">new</span> Vector();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1048576</span>];</span><br><span class="line">      v.add(b);</span><br><span class="line">      Runtime rt = Runtime.getRuntime();</span><br><span class="line">      System.out.println( <span class="string">"free memory: "</span> + rt.freeMemory() );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We run it on a system with 64GB of memory, so let’s check the default maximum heap size:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti openjdk:8u181-jdk</span><br><span class="line">java -XX:+PrintFlagsFinal -version | grep MaxHeap</span><br><span class="line">    uintx MaxHeapFreeRatio = 100</span><br><span class="line">    uintx MaxHeapSize := 16819159040 &#123;product&#125;</span><br><span class="line"></span><br><span class="line">openjdk version <span class="string">"1.8.0_181"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-2~deb9u1-b13)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure><p>As said — it’s 1/4 of physical memory — 16GB. What will happen if we limit the memory using docker cgroups? Let’s check:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti -m 512M openjdk:8u181-jdk</span><br><span class="line">javac MemoryEater.java</span><br><span class="line"></span><br><span class="line">Note: MemoryEater.java uses unchecked or unsafe operations.</span><br><span class="line">Note: Recompile with -Xlint:unchecked <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">java MemoryEater</span><br><span class="line"></span><br><span class="line">free memory: 1003980048</span><br><span class="line">free memory: 1003980048</span><br><span class="line">free memory: 1003980048</span><br><span class="line">[...]</span><br><span class="line">free memory: 803562640</span><br><span class="line">free memory: 802514048</span><br><span class="line">free memory: 801465456</span><br><span class="line">free memory: 800416864</span><br><span class="line">Killed</span><br></pre></td></tr></table></figure><p>The JVM process was killed. Since it was a child process — the container itself survived, but normally when java is the only process inside a container (with PID 1) the container will crash.</p><p>Let’s look into system logs:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">dcos-agent-1 kernel: java invoked oom-killer: gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class="line">dcos-agent-1 kernel: java cpuset=eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712 mems_allowed=0</span><br><span class="line">dcos-agent-1 kernel: CPU: 6 PID: 4142 Comm: java Tainted: G               ------------ T 3.10.0-693.17.1.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">dcos-agent-1 kernel: Hardware name: Supermicro Super Server/X10SRi-F, BIOS 2.0 12/17/2015</span><br><span class="line">dcos-agent-1 kernel: Call Trace:</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816a6071&gt;] dump_stack+0x19/0x1b</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816a1466&gt;] dump_header+0x90/0x229</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81187dc6&gt;] ? find_lock_task_mm+0x56/0xc0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f36a8&gt;] ? try_get_mem_cgroup_from_mm+0x28/0x60</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81188274&gt;] oom_kill_process+0x254/0x3d0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff812ba2fc&gt;] ? selinux_capable+0x1c/0x40</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f73c6&gt;] mem_cgroup_oom_synchronize+0x546/0x570</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f6840&gt;] ? mem_cgroup_charge_common+0xc0/0xc0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81188b04&gt;] pagefault_out_of_memory+0x14/0x90</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff8169f82e&gt;] mm_fault_error+0x68/0x12b</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816b3a21&gt;] __do_page_fault+0x391/0x450</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816b3b15&gt;] do_page_fault+0x35/0x90</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816af8f8&gt;] page_fault+0x28/0x30</span><br><span class="line">dcos-agent-1 kernel: Task <span class="keyword">in</span> /docker/eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712 killed as a result of <span class="built_in">limit</span> of /docker/eca214e0fc</span><br><span class="line">5e9d7f8688fc36979c510d2fb9afab2ce55712</span><br><span class="line">dcos-agent-1 kernel: memory: usage 524180kB, <span class="built_in">limit</span> 524288kB, failcnt 314788</span><br><span class="line">dcos-agent-1 kernel: memory+swap: usage 1048576kB, <span class="built_in">limit</span> 1048576kB, failcnt 6</span><br><span class="line">dcos-agent-1 kernel: kmem: usage 0kB, <span class="built_in">limit</span> 9007199254740988kB, failcnt 0</span><br><span class="line">dcos-agent-1 kernel: Memory cgroup stats <span class="keyword">for</span> /docker/eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712: cache:28KB rss:524152KB rss_huge</span><br><span class="line">:0KB swap:524396KB inactive_anon:262176KB active_anon:261976KB inactive_file:8KB active_file:4KB unevictable:0KB</span><br><span class="line">dcos-agent-1 kernel: [ pid ]   uid  tgid total_vm      rss nr_ptes swapents oom_score_adj name</span><br><span class="line">dcos-agent-1 kernel: [ 1400]     0  1400     4985      418      14      139             0 bash</span><br><span class="line">dcos-agent-1 kernel: [ 4141]     0  4141  4956003   126966     606   137837             0 java</span><br><span class="line">dcos-agent-1 kernel: Memory cgroup out of memory: Kill process 4162 (java) score 1012 or sacrifice child</span><br><span class="line">dcos-agent-1 kernel: Killed process 4141 (java) total-vm:19824012kB, anon-rss:495748kB, file-rss:12116kB, shmem-rss:0kB</span><br></pre></td></tr></table></figure><p>Failures like these can be very difficult to debug — there is nothing in the application logs. It can be especially difficult on managed systems like AWS ECS.</p><p>And how about CPUs? Let’s check it again running a small program which displays the number of available processors:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AvailableProcessors</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// check the number of processors available</span></span><br><span class="line">      System.out.println(<span class="string">""</span>+Runtime.getRuntime().availableProcessors());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Let’s run it in a docker container with cpu number set to 1:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -ti --cpus 1 openjdk:8u181-jdk</span><br><span class="line">javac AvailableProcessors.java</span><br><span class="line">java AvailableProcessors</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>Not good — there are 12 CPUs on this system indeed. So even the number of available processors is limited to 1, the JVM will try to use 12.</p><blockquote><p>for example the GC threads number is set by this formula: On a machine with N hardware threads where N is greater than 8, the parallel collector uses a fixed fraction of N as the number of garbage collector threads. The fraction is approximately 5/8 for large values of N. At values of N below 8, the number used is N.</p></blockquote><p>In our case:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsFinal -version | grep ParallelGCThreads</span><br><span class="line">uintx ParallelGCThreads = 10 &#123;product&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The new Java version (10 and above) docker support is already built-in. But sometimes upgrading is not an option — for example if the application is incompatible with the new JVM.</p><p>The good news: Docker support was also backported to Java 8. Let’s check the newest openjdk image tagged as <strong>8u212</strong>. </p><p>We’ll limit the memory to 1G and use 1 CPU: <strong>docker run -ti –cpus 1 -m 1G openjdk:8u212-jdk</strong></p><p>The memory:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsFinal -version | grep MaxHeap</span><br><span class="line">    uintx MaxHeapFreeRatio                          = 70                                  &#123;manageable&#125;</span><br><span class="line">    uintx MaxHeapSize                              := 268435456                           &#123;product&#125;</span><br><span class="line">openjdk version <span class="string">"1.8.0_212"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_212-8u212-b01-1~deb9u1-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.212-b01, mixed mode)</span><br><span class="line"><span class="comment"># It’s 256M — exactly 1/4 of allocated memory.</span></span><br><span class="line"></span><br><span class="line">java AvailableProcessors</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>Moreover, there are some new settings:</p><ul><li>-XX:InitialRAMPercentage</li><li>-XX:MaxRAMPercentage</li><li>-XX:MinRAMPercentage</li></ul><p>If for some reason the new JVM behaviour is not desired it can be switched off using <strong>-XX:-UseContainerSupport</strong>.</p><blockquote><p>On Kuberntes<br>imits.cpu  &lt;==&gt;  –cpu-quota  # docker inspect中的CpuQuota值<br>requests.cpu  &lt;==&gt;  –cpu-shares  # docker inspect中的CpuShares值</p></blockquote><hr><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://blog.softwaremill.com/docker-support-in-new-java-8-finally-fd595df0ca54" target="_blank" rel="noopener">https://blog.softwaremill.com/docker-support-in-new-java-8-finally-fd595df0ca54</a></li><li><a href="https://www.chainnews.com/articles/631552101870.htm" target="_blank" rel="noopener">https://www.chainnews.com/articles/631552101870.htm</a></li><li><a href="https://stackoverflow.com/questions/54292282/clarification-of-meaning-new-jvm-memory-parameters-initialrampercentage-and-minr/54297753#54297753" target="_blank" rel="noopener">https://stackoverflow.com/questions/54292282/clarification-of-meaning-new-jvm-memory-parameters-initialrampercentage-and-minr/54297753#54297753</a></li><li><a href="https://www.cnblogs.com/yehaifeng/p/9596399.html" target="_blank" rel="noopener">https://www.cnblogs.com/yehaifeng/p/9596399.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;你是否曾经经历过在Docker中运行基于JVM的应用程序时出
      
    
    </summary>
    
      <category term="Docker" scheme="https://sulangsss.github.io/categories/Docker/"/>
    
      <category term="JVM" scheme="https://sulangsss.github.io/categories/Docker/JVM/"/>
    
    
      <category term="Docker" scheme="https://sulangsss.github.io/tags/Docker/"/>
    
      <category term="JVM" scheme="https://sulangsss.github.io/tags/JVM/"/>
    
  </entry>
  
</feed>
