<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="true">








  <meta name="baidu-site-verification" content="true">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="A Big Boy Blog -  Tech Articls & Notes" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta property="og:type" content="website">
<meta property="og:title" content="A Big Boy Blog -  Tech Articls &amp; Notes">
<meta property="og:url" content="https://sulangsss.github.io/page/2/index.html">
<meta property="og:site_name" content="A Big Boy Blog -  Tech Articls &amp; Notes">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Big Boy Blog -  Tech Articls &amp; Notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://sulangsss.github.io/page/2/">





<meta name="baidu-site-verification" content="xV2vphJ53Q">


  <title>A Big Boy Blog -  Tech Articls & Notes</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?344f3e8f33d176fceb44e65d30a341dc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">A Big Boy Blog -  Tech Articls & Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Python Java Android Django Web -> sulang357159@gmail.com</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/06/04/DB/MySQL/How-Batch-Insert-Large-Data/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/04/DB/MySQL/How-Batch-Insert-Large-Data/" itemprop="url">MySQL 如何高效地插入大量数据</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-04T09:55:07+08:00">
                2019-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://www.cnblogs.com/micrari/p/7112781.html" target="_blank" rel="noopener">https://www.cnblogs.com/micrari/p/7112781.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/06/04/Architecture/CQRS/Command Query Responsibility Segregation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/04/Architecture/CQRS/Command Query Responsibility Segregation/" itemprop="url">Command Query Responsibility Segregation</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-04T00:47:19+08:00">
                2019-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index">
                    <span itemprop="name">Architecture</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/CQRS/" itemprop="url" rel="index">
                    <span itemprop="name">CQRS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://microservices.io/patterns/data/cqrs.html" target="_blank" rel="noopener">https://microservices.io/patterns/data/cqrs.html</a></li>
<li><a href="https://spring.io/blog/2016/03/22/springone2gx-2015-replay-building-microservices-with-event-sourcing-and-cqrs" target="_blank" rel="noopener">https://spring.io/blog/2016/03/22/springone2gx-2015-replay-building-microservices-with-event-sourcing-and-cqrs</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/06/02/Tools/Tools-Menu/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/02/Tools/Tools-Menu/" itemprop="url">Tools Menu</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-02T11:34:06+08:00">
                2019-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index">
                    <span itemprop="name">Tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><h4 id="ShellCheck"><a href="#ShellCheck" class="headerlink" title="ShellCheck"></a>ShellCheck</h4><p>ShellCheck - A shell script static analysis tool</p>
<blockquote>
<p><a href="https://github.com/koalaman/shellcheck" target="_blank" rel="noopener">https://github.com/koalaman/shellcheck</a></p>
</blockquote>
<hr>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="Dockly"><a href="#Dockly" class="headerlink" title="Dockly"></a>Dockly</h4><ol>
<li><p>Install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g dockly</span><br></pre></td></tr></table></figure>
</li>
<li><p>Usage</p>
</li>
</ol>
<ul>
<li>= – Refresh the Dockly interface,</li>
<li>/ – Search the containers list view,</li>
<li>i – Display the information about the currently selected container or service,</li>
<li><return> – Show logs of the current container or service,</return></li>
<li>v – Toggle between Containers and Services view,</li>
<li>l – Launch a /bin/bash session on the selected Container,</li>
<li>r – Restart the selected Container,</li>
<li>s – Stop the selected Container,</li>
<li>h – Show HELP window,</li>
<li>q – Quit Dockly.</li>
</ul>
<blockquote>
<p><a href="https://github.com/lirantal/" target="_blank" rel="noopener">https://github.com/lirantal/</a><br><a href="https://www.ostechnix.com/install-node-js-linux/" target="_blank" rel="noopener">https://www.ostechnix.com/install-node-js-linux/</a><br><a href="https://www.ostechnix.com/dockly-manage-docker-containers-from-terminal/" target="_blank" rel="noopener">https://www.ostechnix.com/dockly-manage-docker-containers-from-terminal/</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/31/Kubenetes/GCP/ip-masq-agent/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/31/Kubenetes/GCP/ip-masq-agent/" itemprop="url">ip-masq-agent</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-31T11:15:06+08:00">
                2019-05-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Kubernetes/GCP/" itemprop="url" rel="index">
                    <span itemprop="name">GCP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/ip-masquerade-agent#create_manual" target="_blank" rel="noopener">https://cloud.google.com/kubernetes-engine/docs/how-to/ip-masquerade-agent#create_manual</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/28/Docker/JVM/Java-JVM-On-Docker/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/Docker/JVM/Java-JVM-On-Docker/" itemprop="url">Java JVM On Docker</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-28T19:51:19+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>你是否曾经经历过在Docker中运行基于JVM的应用程序时出现“随机”故障？或者一些奇怪的死机？两者都有可能是由于Java 8中的糟糕的Docker支持引起。</p>
<p>Docker使用控制组(cgroups)来限制对资源的使用。在容器中运行应用程序时限制其对内存和CPU的使用绝对是一个好主意，它可以防止应用程序占用全部可用的内存和/或CPU，因而导致在同一系统上运行的其他容器无法响应。限制资源的使用可以提高应用程序的可靠性和稳定性。它还为硬件容量的规划提供了依据。在像诸如Kubernetes或DC/OS这样的编排系统上运行容器时，这一点尤为重要。</p>
<p>JVM 可以“看到”系统上所有可用的内存和 CPU 内核，并保持与这些资源的一致。在默认情况下，JVM 会将 max heap size 设置为系统内存的 1/4，并将一些线程池个数(比如GC)设置为与物理 CPU 内核的数量一致。</p>
<blockquote>
<p>本文中使用的是遵循GNU GPL v2 许可授权的OpenJDK官方Docker镜像。这里描述的对Docker的支持在Oracle Java SE 开发工具包(JDK)版本8的更新191中被引入。Oracle在2019年4月修改了Java 8更新的许可政策，自Java SE 8更新211后的商业使用不再免费。    </p>
</blockquote>
<hr>
<h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>我们一起来看看下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryEater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Vector v = <span class="keyword">new</span> Vector();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1048576</span>];</span><br><span class="line">      v.add(b);</span><br><span class="line">      Runtime rt = Runtime.getRuntime();</span><br><span class="line">      System.out.println( <span class="string">"free memory: "</span> + rt.freeMemory() );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We run it on a system with 64GB of memory, so let’s check the default maximum heap size:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti openjdk:8u181-jdk</span><br><span class="line">java -XX:+PrintFlagsFinal -version | grep MaxHeap</span><br><span class="line">    uintx MaxHeapFreeRatio = 100</span><br><span class="line">    uintx MaxHeapSize := 16819159040 &#123;product&#125;</span><br><span class="line"></span><br><span class="line">openjdk version <span class="string">"1.8.0_181"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-2~deb9u1-b13)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure>
<p>As said — it’s 1/4 of physical memory — 16GB. What will happen if we limit the memory using docker cgroups? Let’s check:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti -m 512M openjdk:8u181-jdk</span><br><span class="line">javac MemoryEater.java</span><br><span class="line"></span><br><span class="line">Note: MemoryEater.java uses unchecked or unsafe operations.</span><br><span class="line">Note: Recompile with -Xlint:unchecked <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">java MemoryEater</span><br><span class="line"></span><br><span class="line">free memory: 1003980048</span><br><span class="line">free memory: 1003980048</span><br><span class="line">free memory: 1003980048</span><br><span class="line">[...]</span><br><span class="line">free memory: 803562640</span><br><span class="line">free memory: 802514048</span><br><span class="line">free memory: 801465456</span><br><span class="line">free memory: 800416864</span><br><span class="line">Killed</span><br></pre></td></tr></table></figure>
<p>The JVM process was killed. Since it was a child process — the container itself survived, but normally when java is the only process inside a container (with PID 1) the container will crash.</p>
<p>Let’s look into system logs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">dcos-agent-1 kernel: java invoked oom-killer: gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class="line">dcos-agent-1 kernel: java cpuset=eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712 mems_allowed=0</span><br><span class="line">dcos-agent-1 kernel: CPU: 6 PID: 4142 Comm: java Tainted: G               ------------ T 3.10.0-693.17.1.el7.x86_64 <span class="comment">#1</span></span><br><span class="line">dcos-agent-1 kernel: Hardware name: Supermicro Super Server/X10SRi-F, BIOS 2.0 12/17/2015</span><br><span class="line">dcos-agent-1 kernel: Call Trace:</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816a6071&gt;] dump_stack+0x19/0x1b</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816a1466&gt;] dump_header+0x90/0x229</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81187dc6&gt;] ? find_lock_task_mm+0x56/0xc0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f36a8&gt;] ? try_get_mem_cgroup_from_mm+0x28/0x60</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81188274&gt;] oom_kill_process+0x254/0x3d0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff812ba2fc&gt;] ? selinux_capable+0x1c/0x40</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f73c6&gt;] mem_cgroup_oom_synchronize+0x546/0x570</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff811f6840&gt;] ? mem_cgroup_charge_common+0xc0/0xc0</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff81188b04&gt;] pagefault_out_of_memory+0x14/0x90</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff8169f82e&gt;] mm_fault_error+0x68/0x12b</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816b3a21&gt;] __do_page_fault+0x391/0x450</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816b3b15&gt;] do_page_fault+0x35/0x90</span><br><span class="line">dcos-agent-1 kernel: [&lt;ffffffff816af8f8&gt;] page_fault+0x28/0x30</span><br><span class="line">dcos-agent-1 kernel: Task <span class="keyword">in</span> /docker/eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712 killed as a result of <span class="built_in">limit</span> of /docker/eca214e0fc</span><br><span class="line">5e9d7f8688fc36979c510d2fb9afab2ce55712</span><br><span class="line">dcos-agent-1 kernel: memory: usage 524180kB, <span class="built_in">limit</span> 524288kB, failcnt 314788</span><br><span class="line">dcos-agent-1 kernel: memory+swap: usage 1048576kB, <span class="built_in">limit</span> 1048576kB, failcnt 6</span><br><span class="line">dcos-agent-1 kernel: kmem: usage 0kB, <span class="built_in">limit</span> 9007199254740988kB, failcnt 0</span><br><span class="line">dcos-agent-1 kernel: Memory cgroup stats <span class="keyword">for</span> /docker/eca214e0fcd4b245eecb2a80c05e9d7f8688fc36979c510d2fb9afab2ce55712: cache:28KB rss:524152KB rss_huge</span><br><span class="line">:0KB swap:524396KB inactive_anon:262176KB active_anon:261976KB inactive_file:8KB active_file:4KB unevictable:0KB</span><br><span class="line">dcos-agent-1 kernel: [ pid ]   uid  tgid total_vm      rss nr_ptes swapents oom_score_adj name</span><br><span class="line">dcos-agent-1 kernel: [ 1400]     0  1400     4985      418      14      139             0 bash</span><br><span class="line">dcos-agent-1 kernel: [ 4141]     0  4141  4956003   126966     606   137837             0 java</span><br><span class="line">dcos-agent-1 kernel: Memory cgroup out of memory: Kill process 4162 (java) score 1012 or sacrifice child</span><br><span class="line">dcos-agent-1 kernel: Killed process 4141 (java) total-vm:19824012kB, anon-rss:495748kB, file-rss:12116kB, shmem-rss:0kB</span><br></pre></td></tr></table></figure>
<p>Failures like these can be very difficult to debug — there is nothing in the application logs. It can be especially difficult on managed systems like AWS ECS.</p>
<p>And how about CPUs? Let’s check it again running a small program which displays the number of available processors:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AvailableProcessors</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// check the number of processors available</span></span><br><span class="line">      System.out.println(<span class="string">""</span>+Runtime.getRuntime().availableProcessors());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s run it in a docker container with cpu number set to 1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -ti --cpus 1 openjdk:8u181-jdk</span><br><span class="line">javac AvailableProcessors.java</span><br><span class="line">java AvailableProcessors</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>Not good — there are 12 CPUs on this system indeed. So even the number of available processors is limited to 1, the JVM will try to use 12.</p>
<blockquote>
<p>for example the GC threads number is set by this formula: On a machine with N hardware threads where N is greater than 8, the parallel collector uses a fixed fraction of N as the number of garbage collector threads. The fraction is approximately 5/8 for large values of N. At values of N below 8, the number used is N.</p>
</blockquote>
<p>In our case:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsFinal -version | grep ParallelGCThreads</span><br><span class="line">uintx ParallelGCThreads = 10 &#123;product&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The new Java version (10 and above) docker support is already built-in. But sometimes upgrading is not an option — for example if the application is incompatible with the new JVM.</p>
<p>The good news: Docker support was also backported to Java 8. Let’s check the newest openjdk image tagged as <strong>8u212</strong>. </p>
<p>We’ll limit the memory to 1G and use 1 CPU: <strong>docker run -ti –cpus 1 -m 1G openjdk:8u212-jdk</strong></p>
<p>The memory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsFinal -version | grep MaxHeap</span><br><span class="line">    uintx MaxHeapFreeRatio                          = 70                                  &#123;manageable&#125;</span><br><span class="line">    uintx MaxHeapSize                              := 268435456                           &#123;product&#125;</span><br><span class="line">openjdk version <span class="string">"1.8.0_212"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_212-8u212-b01-1~deb9u1-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.212-b01, mixed mode)</span><br><span class="line"><span class="comment"># It’s 256M — exactly 1/4 of allocated memory.</span></span><br><span class="line"></span><br><span class="line">java AvailableProcessors</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>Moreover, there are some new settings:</p>
<ul>
<li>-XX:InitialRAMPercentage</li>
<li>-XX:MaxRAMPercentage</li>
<li>-XX:MinRAMPercentage</li>
</ul>
<p>If for some reason the new JVM behaviour is not desired it can be switched off using <strong>-XX:-UseContainerSupport</strong>.</p>
<blockquote>
<p>On Kuberntes<br>imits.cpu  &lt;==&gt;  –cpu-quota  # docker inspect中的CpuQuota值<br>requests.cpu  &lt;==&gt;  –cpu-shares  # docker inspect中的CpuShares值</p>
</blockquote>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://blog.softwaremill.com/docker-support-in-new-java-8-finally-fd595df0ca54" target="_blank" rel="noopener">https://blog.softwaremill.com/docker-support-in-new-java-8-finally-fd595df0ca54</a></li>
<li><a href="https://www.chainnews.com/articles/631552101870.htm" target="_blank" rel="noopener">https://www.chainnews.com/articles/631552101870.htm</a></li>
<li><a href="https://stackoverflow.com/questions/54292282/clarification-of-meaning-new-jvm-memory-parameters-initialrampercentage-and-minr/54297753#54297753" target="_blank" rel="noopener">https://stackoverflow.com/questions/54292282/clarification-of-meaning-new-jvm-memory-parameters-initialrampercentage-and-minr/54297753#54297753</a></li>
<li><a href="https://www.cnblogs.com/yehaifeng/p/9596399.html" target="_blank" rel="noopener">https://www.cnblogs.com/yehaifeng/p/9596399.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/28/TDD/Basic/Red-Green-Refactor Pattern/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/TDD/Basic/Red-Green-Refactor Pattern/" itemprop="url">Red-Green-Refactor Pattern</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-28T19:51:19+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/TDD/" itemprop="url" rel="index">
                    <span itemprop="name">TDD</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/TDD/Basic/" itemprop="url" rel="index">
                    <span itemprop="name">Basic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://medium.com/@syukri.mullia/basic-tdd-red-green-refactor-pattern-4046381b95a6" target="_blank" rel="noopener">https://medium.com/@syukri.mullia/basic-tdd-red-green-refactor-pattern-4046381b95a6</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/28/TDD/Mockito/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/TDD/Mockito/" itemprop="url">Mockito</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-28T19:51:19+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/TDD/" itemprop="url" rel="index">
                    <span itemprop="name">TDD</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-1-4-39a85e42b8" target="_blank" rel="noopener">https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-1-4-39a85e42b8</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/28/Futures/How-to-calculate-margin/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/Futures/How-to-calculate-margin/" itemprop="url">How to calculate margin?</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-28T10:25:22+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Futures/" itemprop="url" rel="index">
                    <span itemprop="name">Futures</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Margin = Collateral + uGnL + eGnL</p>
<blockquote>
<p>uGnL ：Unrealized Gains and Losses; eGnL ：Estimated Gains and Losses.</p>
</blockquote>
<ul>
<li>Margin Requirements are requirements on margins for the user to perform certain actions. </li>
<li>Initial Margin is required to increase a position.</li>
<li>Maintenance Margin to keep a position. </li>
</ul>
<hr>
<h3 id="Margin-Impacts"><a href="#Margin-Impacts" class="headerlink" title="Margin Impacts"></a>Margin Impacts</h3><img src="/2019/05/28/Futures/How-to-calculate-margin/margin_impact.png">
<p>Positions and orders all require a certain amount of margin and, at the same time(同时), impact(影响) available margin. In the table above, we categorize positions and orders and show how their requirements and impacts are determined when considered separately.</p>
<p>Under margin impact, we further classify different impacts into 3 sub-categories: <strong>settled</strong>, <strong>unsettled</strong>, and <strong>probable</strong>.</p>
<ul>
<li><p>Settled margin impacts have already been settled. So to calculate available margin, settled margin impacts should be left out(忽略，不考虑), as they have already been incorporated(合并的) into collateral balance. </p>
</li>
<li><p>Unsettled margin impacts are <strong>unrealized PnL</strong>, <strong>accrued interests</strong>, and <strong>fee</strong>, <strong>unsettled</strong>, but payable if a settlement occurs right away. </p>
</li>
<li><p>Probable margin impact consider a probable scenario or a possible scenario where most negative impact happens.</p>
</li>
</ul>
<hr>
<h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>A container is a collection of positions and open orders under the same Portfolio, sharing the same margin pool in their common settlement currency.</p>
<p>Under a portfolio, positions settled in the same currency will be collected into the same container with a communal margin shared among them. A winning position’s unrealized profit adds to collateral, bolsters(支持,支撑) the shared margin, and helps avoid liquidation of other losing positions in the container.</p>
<p>To segregate  positions settled in a common currency, consider allocate them to different portfolios.</p>
<h4 id="Aggregate-总体的-合计的-Requirements-amp-Impacts"><a href="#Aggregate-总体的-合计的-Requirements-amp-Impacts" class="headerlink" title="Aggregate(总体的,合计的) Requirements &amp; Impacts"></a>Aggregate(总体的,合计的) Requirements &amp; Impacts</h4><p>Aggregating margin requirements and impacts at the portfolio level isn’t simply adding them up. Instead, it is another exercise of finding out the worst scenario(情形,情况) that demands the most collateral. The aggregation is done at 2 layers.</p>
<p><strong>Contract Level</strong></p>
<p>At the contract level, we collect all orders and position for the contract and then:</p>
<ol>
<li>Convert incoming market orders into incoming limit orders;</li>
<li>Categorize open orders and incoming limit orders buy orders and sell orders;</li>
<li>With everything else (market price, model price, etc.) held equal, consider 2 scenarios<ol>
<li>All buy orders filled at their limit prices;</li>
<li>All sell orders filled at their limit prices;</li>
</ol>
</li>
</ol>
<p>Given current position holdings, either of the scenarios where a bigger collateral is demanded shall be considered in checking margin sufficiency and determining free collateral.</p>

<p>In the expression above, <strong>subscript o denotes orders on either buy or sell side</strong>. The scenario under which the expression evaluates to be bigger, In the following calculation.</p>
<p>At contract level, the required margin and margin impact are the following formula evaluated in the worse scenario.</p>
<img src="/2019/05/28/Futures/How-to-calculate-margin/worst_required_margin_and_impact_margin_formula.png">
<p><strong>Portfolio Level</strong></p>
<p>At the portfolio level, contracts are grouped by their settlement currency into containers. So the Required Margin and Margin Impact for a portfolio and specific settlement currency, is the summations of contract level RM and MI.</p>
<p><strong>Margin Sufficiency</strong></p>
<p>When checking for margin sufficiency at portfolio level (i.e. container level), we simply evaluate the inequality below across contracts under the container in question.</p>
<img src="/2019/05/28/Futures/How-to-calculate-margin/margin_suffiency.png">
<p>The left hand side is simply collateral adjusted by <strong>margin impacts</strong> from positions and their related orders in the container.</p>
<p>The right hand side of the inequality computes the required margin for the container by summing up the <strong>required margin for each contract</strong>.</p>
<p><strong>Free Collateral</strong></p>
<p>Free collateral is the amount of collateral that can be removed from a container. Removing such amount must not:</p>
<ul>
<li>Immediately cause <strong>liquidation</strong> or auto deleveraging of positions in the container;</li>
<li>Cause the container to be <strong>insufficient</strong> for the initial margin requirement;</li>
<li>Exceed the total collateral in the container.</li>
</ul>
<p>So the free collateral value for a container is the smaller of the 2 values below:</p>
<img src="/2019/05/28/Futures/How-to-calculate-margin/free_collateral_formula.png">
<p><strong>Margin Coverage</strong></p>
<p>Margin coverage ratios show how much margin one has to cover the margin requirements imposed on a container. They are defined as <strong>IMC</strong> and <strong>MMC</strong>.</p>
<img src="/2019/05/28/Futures/How-to-calculate-margin/IMC_MMC_formula.png">
<p>When a container’s <strong>IMC falls below 1</strong>, a trader will not be able to increase the size of positions in it. And so on our trading terminal, when <strong>IMC falls lower than 1</strong>, its indicator will lit up in red.</p>
<p>When a container’s MMC falls towards 1, a liquidation looms imminent. Unlike IMC, which can stay below 1 for a period, once MMC touches 1, liquidation kicks in and almost instantly brings MMC above 1. To warning users about the approaching liquidation, <strong>we lit the MMC indicator in red when the following ratio falls below 1</strong>.</p>
<img src="/2019/05/28/Futures/How-to-calculate-margin/MMC_formula.png">
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/26/Java/Log/正确输出Log的姿势/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/26/Java/Log/正确输出Log的姿势/" itemprop="url">正确输出Log的姿势</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-26T18:54:22+08:00">
                2019-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Log/" itemprop="url" rel="index">
                    <span itemprop="name">Log</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Slf4j"><a href="#Slf4j" class="headerlink" title="Slf4j"></a>Slf4j</h3><p>全称：Simple Logging Facade for Java，即简单日志门面接口，和 Apache 的 commons-logging 是一样的概念，它们都不是具体的日志框架，你可以指定其他主流的日志实现框架。</p>
<hr>
<h3 id="Log级别及使用说明"><a href="#Log级别及使用说明" class="headerlink" title="Log级别及使用说明"></a>Log级别及使用说明</h3><img src="/2019/05/26/Java/Log/正确输出Log的姿势/log-level.png">
<table>
<thead>
<tr>
<th>日志级别</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>OFF</td>
<td>关闭：最高级别，不输出日志。</td>
</tr>
<tr>
<td>FATAL</td>
<td>致命：输出非常严重的可能会导致应用程序终止的错误。</td>
</tr>
<tr>
<td>ERROR</td>
<td>错误：输出错误，但应用还能继续运行。</td>
</tr>
<tr>
<td>WARN</td>
<td>警告：输出可能潜在的危险状况。</td>
</tr>
<tr>
<td>INFO</td>
<td>信息：输出应用运行过程的详细信息。</td>
</tr>
<tr>
<td>DEBUG</td>
<td>调试：输出更细致的对调试应用有用的信息。</td>
</tr>
<tr>
<td>TRACE</td>
<td>跟踪：输出更细致的程序运行轨迹。</td>
</tr>
<tr>
<td>ALL</td>
<td>所有：输出所有级别信息。</td>
</tr>
</tbody>
</table>
<p>日志输出关系，如下图所示：</p>
<img src="/2019/05/26/Java/Log/正确输出Log的姿势/output-level.png">
<h4 id="日志场景说明"><a href="#日志场景说明" class="headerlink" title="日志场景说明"></a>日志场景说明</h4><ul>
<li>DEBUG：记录对调试程序有帮助的信息。</li>
<li>INFO：用来记录程序运行现场，虽然此处并未发生错误，但是对排查其他错误具有指导意义。</li>
<li>WARN：可以用来记录程序运行现场，但是更偏向于表明此处有出现潜在错误的可能。</li>
<li>ERROR：表明当前程序运行发生了错误，需要被关注。但是当前发生的错误，没有影响系统的继续运行。</li>
<li>FATAL：表明当前程序运行出现了严重的错误事件，并且将会导致应用程序中断。</li>
</ul>
<p>需要注意点：</p>
<ul>
<li>避免无效日志打印：日志配置设置 additivity=”false”。</li>
<li>区别对待错误日志：WARN 与 ERROR 都是与错误有关的日志级别，但不要一发生错误就笼统地输出 ERROR 级别日志。一些业务异常是可以通过引导重试就能恢复正常的，例如用户输入参数错误。在这种情况下，记录日志是为了在用户咨询时可以还原现场，如果输出为 ERROR 级别就不适合了。ERROR 级别只记录系统逻辑错误、异常或者违反重要的业务规则，其他错误都可以归为 WARN 级别。</li>
<li>保证记录内容完整：日志记录的内容包括现场上下文信息与异常堆栈信息。记录异常时，一定要输出异常堆栈，例如，logger.error(“xxxx: ${e.message}”, e)；日志中如果输出对象实例，要确保实例类重写了 toString() 方法，否则只输出对象的 hash code 值，没有意义。</li>
</ul>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://juejin.im/post/5b9871895188255c57212459" target="_blank" rel="noopener">https://juejin.im/post/5b9871895188255c57212459</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2019/05/26/读书笔记/认知/修昔底德陷阱/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason - sulang357159@163.com">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A Big Boy Blog -  Tech Articls & Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/26/读书笔记/认知/修昔底德陷阱/" itemprop="url">修昔底德陷阱</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-26T14:24:07+08:00">
                2019-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/认知/" itemprop="url" rel="index">
                    <span itemprop="name">认知</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>“修昔底德陷阱”，是指<strong>一个新崛起的大国必然要挑战现存大国，而现存大国也必然会回应这种威胁，这样战争变得不可避免。</strong>此说法源自古希腊著名历史学家修昔底德，他认为，当一个崛起的大国与既有的统治霸主竞争时，双方面临的危险多数以战争告终。</p>
<p>这样的事例曾经发生在公元前5世纪，修昔底德自己的时代，新崛起的雅典震动了陆地霸主斯巴达，结果双方爆发了长达30年的战争，两国均遭毁灭。类似的事例也发生在16世纪的新崛起的新教英国与天主教的西班牙之间，以及19世纪末与20世纪初的老牌帝国英国与新兴强国日耳曼的德国之间。</p>
<hr>
<h3 id="修昔底德陷阱的由来"><a href="#修昔底德陷阱的由来" class="headerlink" title="修昔底德陷阱的由来"></a>修昔底德陷阱的由来</h3><p>修昔底德陷阱是古希腊大历史学家修昔底德在其不朽的名著—-《伯罗奔尼撒战争史》中阐述的一个核心思想，<strong>指新兴大国随着其力量的增强，一定会向老牌的霸权国家发起挑战，而老牌的霸权国家也一定会为了维护其霸权而全力打压新兴大国的崛起势头，甚至发动战争。</strong></p>
<p>《伯罗奔尼撒战争史》还指出：“使战争不可避免的真正原因是雅典势力的增长和因而引起斯巴达的恐惧。”但修昔底德并没有明确概括出修昔底德陷阱这个概念，而美国学者艾利森根据这一论断则提出“修昔底德陷阱”的概念，认为一个新崛起的大国必然要挑战现存大国，而现存大国也必然来回应这种威胁，这样战争变得不可避免。</p>
<p>2017年5月，这位美国著名国际问题专家、哈佛大学肯尼迪学院首任院长的格雷厄姆·艾利森（Graham Allison）出版了他的新书——《注定开战：美国和中国能否逃脱修昔底德陷阱？》（Destined for War: Can America and China Escape Thucydides’s Trap）。该书的出版，标志着这一概念的正式提出。</p>
<p>艾利森还说，我们不必成为中国的奴隶，但我们必须学会接受其强大，尽管有时它展示自己强大的方式令我们反感。而为了避免一场战争，这一点可能还不是我们必须要吞下最苦的药片。战争的风险是切实存在的，而其后果难以形容得可怕。</p>
<p>他特别强调第一次世界大战的典型性，说这次战争的根源就是新崛起的大国德国挑战了当时的现存大国英国，从而引发了世界灾难，正如同雅典挑战斯巴达，斯巴达便发动战争，导致整个希腊世界受到重创。</p>
<hr>
<h3 id="历史的回顾与思考"><a href="#历史的回顾与思考" class="headerlink" title="历史的回顾与思考"></a>历史的回顾与思考</h3><p>古希腊罗马的斯巴达和雅典的伯罗奔尼撒战争是修昔底德立论的现实基础，在艾利森看来，自是有着无可辩驳的逻辑和说服力，其他人类历史上的著名霸权兴衰交替的历史似乎也在佐证着他的论断。比如罗马和迦太基；西班牙和大英帝国；荷兰和大英帝国；法兰西帝国和大英帝国；德意志帝国和大英帝国；美利坚合众国和大日本帝国，和大英帝国，这些世界历史上著名的帝国之间的竞争和争斗，似乎也无不是如此的。再看中华帝国漫长的历史上，也是写满了霸权兴衰的斑斑血迹的，春秋五霸，战国七雄，秦汉相替，汉匈奴战争等等，都看不出有异曲不同工的妙处。</p>
<p>那么，在人类历史上究竟有没有不经过激烈的斗争甚至战争而实现的霸权的和平过渡呢？</p>
<p>应该说有的，最明显的例证就是大英帝国以和平的方式将霸权禅让给了美利坚合众国，但这一例证并不是在完全的意义上是如此的，因为大英帝国的霸权随着第二次世界大战的开始，已经处于分崩离析，土崩瓦解的局面下了，在欧洲，希特勒的德意志第三帝国横扫西欧大陆，一举打败了宿敌，号称世界第一陆上强国的法国，然后又兵锋直抵大英帝国的本土，上演了伦敦上空的大空战，之后又发动了巴巴罗莎计划，与苏维埃巨人苏联战成一团。</p>
<p>在远东，大日本帝国则早已占领中国的东北，建立了满洲国，七七事变后，又发动了全面的侵华战争，之后，又发动了太平洋战争，横扫了大英帝国在远东和东南亚的传统势力，大英帝国只剩下半条命，美利坚合众国则乘势崛起，不仅打败了所谓的大日本帝国，而且通过大西洋宪章，逼迫大英帝国的掌门人丘吉尔承诺殖民地独立，实质上也就是签下大英帝国解体的卖身契，所以说与其说是禅让，还不如说美国假途灭虢，或者说大英帝国只是将其残山剩水拿出来禅让于美国，不是将完整的霸权禅让于美国的，美利坚是以战争的手段夺得世界霸权的。这显然不同于经典的修昔底德陷阱，修昔底德陷阱过于简单地聚焦于两个大国之间的争霸，在概括第二次世界大战这样多个世界强国争霸的复杂局面时，就显得不够全面，不够贴切。</p>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://baike.baidu.com/item/%E4%BF%AE%E6%98%94%E5%BA%95%E5%BE%B7%E9%99%B7%E9%98%B1" target="_blank" rel="noopener">https://baike.baidu.com/item/%E4%BF%AE%E6%98%94%E5%BA%95%E5%BE%B7%E9%99%B7%E9%98%B1</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/45687804" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/45687804</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/57/">57</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Jason - sulang357159@163.com">
          
            <p class="site-author-name" itemprop="name">Jason - sulang357159@163.com</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">562</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">244</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">618</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason - sulang357159@163.com</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
