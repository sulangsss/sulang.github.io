<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="true">








  <meta name="baidu-site-verification" content="true">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="sulang blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta property="og:type" content="website">
<meta property="og:title" content="sulang blog">
<meta property="og:url" content="https://sulangsss.github.io/page/32/index.html">
<meta property="og:site_name" content="sulang blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sulang blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://sulangsss.github.io/page/32/">





<meta name="baidu-site-verification" content="xV2vphJ53Q">


  <title>sulang blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?344f3e8f33d176fceb44e65d30a341dc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">sulang blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">python java android django web</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/02/05/Kubenetes/Command/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/05/Kubenetes/Command/" itemprop="url">kubectl 命令</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-05T11:13:06+08:00">
                2018-02-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/" itemprop="url" rel="index">
                    <span itemprop="name">DevTools</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><h3 id="查看log"><a href="#查看log" class="headerlink" title="查看log"></a>查看log</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Display only the most recent 20 lines of output in pod nginx</span></span><br><span class="line">kubectl logs --tail=20 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show all logs from pod nginx written in the last hour</span></span><br><span class="line">kubectl logs --since=1h nginx</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Examples:</span><br><span class="line"><span class="comment"># !!!Important Note!!!</span></span><br><span class="line"><span class="comment"># Requires that the 'tar' binary is present in your container</span></span><br><span class="line"><span class="comment"># image.  If 'tar' is not present, 'kubectl cp' will fail.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy /tmp/foo_dir local directory to /tmp/bar_dir in a remote pod in the default namespace</span></span><br><span class="line">kubectl cp /tmp/foo_dir &lt;some-pod&gt;:/tmp/bar_dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy /tmp/foo local file to /tmp/bar in a remote pod in a specific container</span></span><br><span class="line">kubectl cp /tmp/foo &lt;some-pod&gt;:/tmp/bar -c &lt;specific-container&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy /tmp/foo local file to /tmp/bar in a remote pod in namespace &lt;some-namespace&gt;</span></span><br><span class="line">kubectl cp /tmp/foo &lt;some-namespace&gt;/&lt;some-pod&gt;:/tmp/bar</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy /tmp/foo from a remote pod to /tmp/bar locally</span></span><br><span class="line">kubectl cp &lt;some-namespace&gt;/&lt;some-pod&gt;:/tmp/foo /tmp/bar</span><br></pre></td></tr></table></figure>
<h3 id="查看Pod里面指定容器的log"><a href="#查看Pod里面指定容器的log" class="headerlink" title="查看Pod里面指定容器的log"></a>查看Pod里面指定容器的log</h3><p>对于有初始化init container的StatefulSet，可以查看里面不同的container的log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;init-container&gt;</span><br></pre></td></tr></table></figure>
<h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p>功能：根据文件或输入创建集群resource</p>
<p>例如，kubectl create -f filename</p>
<h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p>apply命令提供了比patch，edit等更严格的更新resource的方式。通过apply，用户可以将resource的configuration使用source control的<br>方式维护在版本库中。</p>
<p>每次有更新时，将配置文件push到server，然后使用kubectl apply将更新应用到resource。kubernetes会在引用更新前将当前配置文件中的配置同<br>已经应用的配置做比较，并只更新更改的部分，而不会主动更改任何用户未指定的部分。 </p>
<p>apply命令的使用方式同replace相同，不同的是apply不会删除原有resource，然后创建新的。apply直接在原有resource的基础上进行更新。同时<br>kubectl apply还会resource中添加一条注释，标记当前的apply。类似于git操作。</p>
<h3 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h3><p>功能：对已有资源进行更新、替换。</p>
<h3 id="rolling-update"><a href="#rolling-update" class="headerlink" title="rolling-update"></a>rolling-update</h3><p>对于已经部署并且正在运行的业务，rolling-update提供了不中断业务的更新方式。rolling-update每次起一个新的pod，等新pod完全起来后删除一个旧的pod，<br>然后再起一个新的pod替换旧的pod，直到替换掉所有的pod。rolling-update需要确保新的版本有不同的name，Version和label，否则会报错 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/deployment-name container_name=image</span><br></pre></td></tr></table></figure>
<h3 id="scale"><a href="#scale" class="headerlink" title="scale"></a>scale</h3><h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --current-replicas=1 --replicas=3 deployment/mysql</span><br></pre></td></tr></table></figure>
<h3 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h3><p>命令类似于docker的attach命令，可以直接查看容器中以daemon形式运行的进程的输出，效果类似于logs -f，退出查看使用ctrl-c。</p>
<p>如果一个pod中有多个容器，要查看具体的某个容器的的输出，需要在pod名后使用-c containers name指定运行的容器。</p>
<p>如下示例的命令为查看kube-system namespace中的kube-dns-v9-rcfuk pod中的skydns容器的输出。</p>
<p>gcloud container clusters get-credentials fintend-cloud –zone asia-southeast1-a –project fintend-cloud &amp;&amp; kubectl exec -it kafka-deployment-6798bf4956-z2b25 -c kafka-deployment – /bin/sh</p>
<h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p>访问内部Pod服务</p>
<p>格式：kubectl port-forward pod-name local-port:remote-port</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward app-deployment-9969cc4c-hntw9 8086:8086</span><br></pre></td></tr></table></figure>
<h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><h4 id="local"><a href="#local" class="headerlink" title="local"></a>local</h4><p>container-builder-local</p>
<p>./container-builder-local_{linux,darwin}_{386,amd64}-v&lt;latest_tag&gt; –dryrun=false –config=path/to/cloudbuild.yaml path/to/code</p>
<h4 id="remote"><a href="#remote" class="headerlink" title="remote"></a>remote</h4><p>gcloud container builds submit –config cloudbuild.yaml .</p>
<p>gcloud builds submit –config cloudbuild.yaml .</p>
<h2 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h2><h3 id="fetch-cluster-auth"><a href="#fetch-cluster-auth" class="headerlink" title="fetch cluster auth"></a>fetch cluster auth</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container clusters get-credentials cluster_name --zone asia-southeast1<span class="_">-a</span> --project project_id</span><br></pre></td></tr></table></figure>
<h3 id="scale-1"><a href="#scale-1" class="headerlink" title="scale"></a>scale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container clusters resize cluster-name --node-pool default-pool --size 5 --zone asia-southeast1<span class="_">-a</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="查看Service信息"><a href="#查看Service信息" class="headerlink" title="查看Service信息"></a>查看Service信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe service service_name</span><br></pre></td></tr></table></figure>
<h3 id="Service类型"><a href="#Service类型" class="headerlink" title="Service类型"></a>Service类型</h3><p>参考链接：<a href="https://segmentfault.com/a/1190000013840788" target="_blank" rel="noopener">https://segmentfault.com/a/1190000013840788</a></p>
<h4 id="headless-service"><a href="#headless-service" class="headerlink" title="headless service"></a>headless service</h4><p>当headless service有配置selector时，其对应的所有后端节点，会被记录到dns中，在访问service domain时kube-dns会将所有endpoints返回，选择哪个进行访问则是系统自己决定；</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: mysql</span><br><span class="line">    port: 3306</span><br><span class="line">  clusterIP: None</span><br><span class="line">  selector:</span><br><span class="line">    app: mysql</span><br></pre></td></tr></table></figure>
<p>如果ServiceName是mysql，则每个pod的访问地址是pod-name.mysql.default.svc.cluster.local，其中default表示默认空间</p>
<hr>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><h3 id="label"><a href="#label" class="headerlink" title="label"></a>label</h3><h4 id="add-label"><a href="#add-label" class="headerlink" title="add label"></a>add label</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="manage"><a href="#manage" class="headerlink" title="manage"></a>manage</h3><h4 id="create-1"><a href="#create-1" class="headerlink" title="create"></a>create</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container node-pools create [POOL_NAME] --zone [COMPUTE_ZONE] --cluster [CLUSTER_NAME]</span><br></pre></td></tr></table></figure>
<ul>
<li>example</li>
</ul>
<p>gcloud container node-pools create tidb-pd –zone asia-southeast1-a –cluster fintend-cloud</p>
<h4 id="view"><a href="#view" class="headerlink" title="view"></a>view</h4><hr>
<h3 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h3><h4 id="resizing-a-node-pool"><a href="#resizing-a-node-pool" class="headerlink" title="resizing a node pool"></a>resizing a node pool</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container clusters resize [CLUSTER_NAME] --node-pool [NODE_POOL] --size [SIZE] [--zone [COMPUTE_ZONE]]</span><br></pre></td></tr></table></figure>
<ul>
<li>增加node-pool数量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container clusters resize fintend-cloud --size=5 --node-pool default-pool --zone asia-southeast1<span class="_">-a</span></span><br></pre></td></tr></table></figure>
<h4 id="add-a-new-node-pool"><a href="#add-a-new-node-pool" class="headerlink" title="add a new node-pool"></a>add a new node-pool</h4><p>查看当前可用机器配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud compute machine-types list</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container node-pools create [POOL_NAME] --zone [COMPUTE_ZONE] --cluster [CLUSTER_NAME]</span><br></pre></td></tr></table></figure>
<p>例如，gcloud container node-pools create mq-broke-pool –zone asia-southeast1-a –cluster fintend-cloud –machine-type n1-highmem-4</p>
<p>文档链接：<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools" target="_blank" rel="noopener">https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools</a></p>
<hr>
<h2 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h2><h3 id="StorageClass"><a href="#StorageClass" class="headerlink" title="StorageClass"></a>StorageClass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get storageclass</span><br></pre></td></tr></table></figure>
<p>输出结果<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME                 PROVISIONER</span><br><span class="line">pd-standard          kubernetes.io/gce-pd</span><br><span class="line">standard (default)   kubernetes.io/gce-pd</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Management-PV"><a href="#Management-PV" class="headerlink" title="Management PV"></a>Management PV</h3><h4 id="查看当前PV"><a href="#查看当前PV" class="headerlink" title="查看当前PV"></a>查看当前PV</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pv</span><br></pre></td></tr></table></figure>
<h4 id="删除PV"><a href="#删除PV" class="headerlink" title="删除PV"></a>删除PV</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pv pv-name</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Management-PVC"><a href="#Management-PVC" class="headerlink" title="Management PVC"></a>Management PVC</h3><h4 id="删除PVC"><a href="#删除PVC" class="headerlink" title="删除PVC"></a>删除PVC</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pvc pvc-name</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/02/02/Tools/GoogleCloud/GCP-gcloud-command/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/02/Tools/GoogleCloud/GCP-gcloud-command/" itemprop="url">gcloud Command</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-02T12:00:06+08:00">
                2018-02-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/" itemprop="url" rel="index">
                    <span itemprop="name">DevTools</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/GCP/" itemprop="url" rel="index">
                    <span itemprop="name">GCP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><h3 id="push-pull-image"><a href="#push-pull-image" class="headerlink" title="push / pull image"></a>push / pull image</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud docker -- push [HOSTNAME]/[PROJECT-ID]/[IMAGE]</span><br></pre></td></tr></table></figure>
<p>如果出现错误<strong><a href="https://gcr.io/v2/" target="_blank" rel="noopener">https://gcr.io/v2/</a>: net/http: request canceled while waiting for connection</strong>，docker设置proxy</p>
<h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>gcloud config set project [PROJECT_ID]</p>
<p>gcloud config set compute/zone [COMPUTE_ZONE], such as us-west1-a</p>
<h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><h4 id="Bash-Shell-进入Pod"><a href="#Bash-Shell-进入Pod" class="headerlink" title="Bash Shell 进入Pod"></a>Bash Shell 进入Pod</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod pod-name</span><br><span class="line"></span><br><span class="line">kubectl <span class="built_in">exec</span> -it pod-name -- /bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="update-Pod-Image"><a href="#update-Pod-Image" class="headerlink" title="update Pod Image"></a>update Pod Image</h3><p>Deployment模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f file</span><br></pre></td></tr></table></figure>
<p>注意，Image必须不同，比如原来是redis:v1，新的不能再是v1，可以设置为v2</p>
<h3 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h3><h4 id="创建cluster"><a href="#创建cluster" class="headerlink" title="创建cluster"></a>创建cluster</h4><p>命令：gcloud container clusters create [CLUSTER_NAME]</p>
<h4 id="获取授权"><a href="#获取授权" class="headerlink" title="获取授权"></a>获取授权</h4><p>命令：gcloud container clusters get-credentials [CLUSTER_NAME]</p>
<p>例如，gcloud container clusters get-credentials cluster-name –zone us-central1-a –project project_id</p>
<p>gcloud container clusters get-credentials fintend-cloud –zone asia-southeast1-a –project fintend-cloud</p>
<h4 id="删除-cluster"><a href="#删除-cluster" class="headerlink" title="删除 cluster"></a>删除 cluster</h4><p>命令格式：gcloud container clusters delete [CLUSTER_NAME]</p>
<h4 id="upgrading-clusters"><a href="#upgrading-clusters" class="headerlink" title="upgrading clusters"></a>upgrading clusters</h4><p>查看当前Node版本配置信息，以及可选的升级版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container get-server-config --zone us-central1<span class="_">-a</span></span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">defaultClusterVersion: 1.7.12-gke.0</span><br><span class="line">defaultImageType: COS</span><br><span class="line">validImageTypes:</span><br><span class="line">- COS</span><br><span class="line">- UBUNTU</span><br><span class="line">validMasterVersions:</span><br><span class="line">- 1.8.7-gke.0</span><br><span class="line">- 1.8.6-gke.0</span><br><span class="line">- 1.8.5-gke.0</span><br><span class="line">- 1.7.12-gke.0</span><br><span class="line">- 1.7.11-gke.1</span><br><span class="line">validNodeVersions:</span><br><span class="line">- 1.8.7-gke.0</span><br><span class="line">- 1.8.6-gke.0</span><br><span class="line">- 1.8.5-gke.0</span><br><span class="line">- 1.8.4-gke.1</span><br><span class="line">- 1.8.3-gke.0</span><br><span class="line">- 1.8.2-gke.0</span><br><span class="line">- 1.8.1-gke.1</span><br><span class="line">- 1.7.12-gke.0</span><br><span class="line">- 1.7.12</span><br><span class="line">- 1.7.11-gke.1</span><br><span class="line">- 1.7.10-gke.0</span><br><span class="line">- 1.7.8-gke.0</span><br><span class="line">- 1.6.13-gke.1</span><br><span class="line">- 1.6.11-gke.0</span><br><span class="line">- 1.5.7</span><br></pre></td></tr></table></figure></p>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><h4 id="查看Node数量"><a href="#查看Node数量" class="headerlink" title="查看Node数量"></a>查看Node数量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
<p>输出结果<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NAME                                          STATUS    ROLES     AGE       VERSION</span><br><span class="line">gke-cluster-test-default-pool-07160edc-0b2w   Ready     &lt;none&gt;    3h        v1.7.12-gke.0</span><br><span class="line">gke-cluster-test-default-pool-07160edc-mtl7   Ready     &lt;none&gt;    3h        v1.7.12-gke.0</span><br><span class="line">gke-cluster-test-default-pool-07160edc-rr9z   Ready     &lt;none&gt;    3h        v1.7.12-gke.0</span><br></pre></td></tr></table></figure></p>
<h4 id="查看Node信息"><a href="#查看Node信息" class="headerlink" title="查看Node信息"></a>查看Node信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe node node-name</span><br></pre></td></tr></table></figure>
<h3 id="App"><a href="#App" class="headerlink" title="App"></a>App</h3><ul>
<li>deploy app</li>
</ul>
<p>命令：kubectl run app-name –image gcr.io/PROJECT_ID/image-name –port server-port</p>
<p>例如，kubectl run hello-server –image gcr.io/google-samples/hello-app:1.0 –port 8080</p>
<ul>
<li>exposing app</li>
</ul>
<p>命令：kubctl expose deployment app-name –type</p>
<p>–type：ClusterIP, NodePort, LoadBalancer, or ExternalName. Default is ‘ClusterIP’.</p>
<p>例如，kubectl expose deployment hello-server –type “LoadBalancer”</p>
<ul>
<li>删除LoadBalancer</li>
</ul>
<p>例如，kubectl delete service hello-server</p>
<ul>
<li>inspect app</li>
</ul>
<p>命令格式：kubectl get service app-name</p>
<ul>
<li>destroy app</li>
</ul>
<p>命令格式：kubectl delete service app-name</p>
<h2 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h2><h3 id="local"><a href="#local" class="headerlink" title="local"></a>local</h3><p>container-builder-local</p>
<p>./container-builder-local_{linux,darwin}_{386,amd64}-v&lt;latest_tag&gt; –dryrun=false –config=path/to/cloudbuild.yaml path/to/code</p>
<h3 id="remote"><a href="#remote" class="headerlink" title="remote"></a>remote</h3><p>gcloud container builds submit –config cloudbuild.yaml .</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/02/01/Tools/GoogleCloud/GCP-notification/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/Tools/GoogleCloud/GCP-notification/" itemprop="url">GCP Notification</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-01T12:37:06+08:00">
                2018-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/" itemprop="url" rel="index">
                    <span itemprop="name">DevTools</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/GCP/" itemprop="url" rel="index">
                    <span itemprop="name">GCP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>创建Bucket</li>
</ol>
<p>gsutil mb gs://[STAGING_BUCKET_NAME]</p>
<p>例如，gsutil mb gs://fintend_notification_cloudbuild</p>
<ol start="2">
<li>创建Cloud Function</li>
</ol>
<p>To deploy the subscribe function with a Cloud Pub/Sub trigger</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud beta <span class="built_in">functions</span> deploy subscribe --stage-bucket fintend_notification_cloudbuild --trigger-topic cloud-builds</span><br></pre></td></tr></table></figure>
<p>参考链接</p>
<ul>
<li><a href="https://cloud.google.com/container-builder/docs/configure-third-party-notifications" target="_blank" rel="noopener">https://cloud.google.com/container-builder/docs/configure-third-party-notifications</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/02/01/Tools/GoogleCloud/GCB-error/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/Tools/GoogleCloud/GCB-error/" itemprop="url">Google Error</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-01T12:37:06+08:00">
                2018-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/" itemprop="url" rel="index">
                    <span itemprop="name">DevTools</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DevTools/GCP/" itemprop="url" rel="index">
                    <span itemprop="name">GCP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="gcloud-container-builds-submit-HTTPError-40"><a href="#gcloud-container-builds-submit-HTTPError-40" class="headerlink" title="gcloud.container.builds.submit HTTPError 40"></a>gcloud.container.builds.submit HTTPError 40</h3><p>赋予一个新用户权限(“cloud container builder” role)，执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud container builds submit --config cloudbuild.yaml .</span><br></pre></td></tr></table></figure>
<p>创建Image成功，但是输出错误信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: (gcloud.container.builds.submit) HTTPError 403: &lt;?xml version='1.0' encoding='UTF-8'?&gt;<span class="tag">&lt;<span class="name">Error</span>&gt;</span><span class="tag">&lt;<span class="name">Code</span>&gt;</span>AccessDenied<span class="tag">&lt;/<span class="name">Code</span>&gt;</span><span class="tag">&lt;<span class="name">Message</span>&gt;</span>Access denied.<span class="tag">&lt;/<span class="name">Message</span>&gt;</span><span class="tag">&lt;<span class="name">Details</span>&gt;</span>jasonsu@fintend.com does not have storage.objects.get access to 727357779496.cloudbuild-logs.googleusercontent.com/log-2f28a385-5782-4f77-8ccb-49c1f6e9bc1d.txt.<span class="tag">&lt;/<span class="name">Details</span>&gt;</span><span class="tag">&lt;/<span class="name">Error</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>原因：GCS permissions predate IAM and thus work a little differently. To view the logs, the Service Account in question needs to be a <strong>Viewer</strong> on the project in addition to have the Builder Editor role.</p>
<p>因此解决方案：赋予用户两种role，Viewer 和 Builder Editor</p>
<h3 id="SSH方式无法连接Instance"><a href="#SSH方式无法连接Instance" class="headerlink" title="SSH方式无法连接Instance"></a>SSH方式无法连接Instance</h3><p>在instance的.ssh/authorized_keys文件里面添加public key</p>
<h3 id="gcloud-container-clusters-get-credentials-ResponseError-code-403-message-Required"><a href="#gcloud-container-clusters-get-credentials-ResponseError-code-403-message-Required" class="headerlink" title="(gcloud.container.clusters.get-credentials) ResponseError: code=403, message=Required"></a>(gcloud.container.clusters.get-credentials) ResponseError: code=403, message=Required</h3><p>使用contain builder时候，执行kubectl set命令失败，原因是@cloudbuild.gserviceaccount.com账号没有kubernetes权限。</p>
<p>解决方案：添加Kubernetes Engine Developer权限即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/30/Server/SpringBoot/Maven/mvn-command/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/30/Server/SpringBoot/Maven/mvn-command/" itemprop="url">mvn 常用命令</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-30T16:02:18+08:00">
                2018-01-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/Spring-Boot/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Boot</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/Spring-Boot/maven/" itemprop="url" rel="index">
                    <span itemprop="name">maven</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>mvn archetype:create 创建 Maven 项目</p>
<p>mvn compile 编译主程序源代码，不会编译test目录的源代码。第一次运行时，会下载相关的依赖包，可能会比较费时</p>
<p>mvn test-compile 编译测试代码，compile之后会生成target文件夹，主程序编译在classes下面，测试程序放在test-classes下</p>
<p>mvn test 运行应用程序中的单元测试 </p>
<p>mvn site 生成项目相关信息的网站</p>
<p>mvn clean 清除目标目录中的生成结果</p>
<p>mvn package 依据项目生成 jar 文件，打包之前会进行编译，测试</p>
<p>mvn install在本地 Repository 中安装 jar。</p>
<p>mvn eclipse:eclipse 生成 Eclipse 项目文件及包引用定义</p>
<p>mvn deploy 在整合或者发布环境下执行，将最终版本的包拷贝到远程 的repository，使得其他的开发者或者工程可以共享。</p>
<p><dependency>中<scope>，它主要管理依赖的部署。目前<scope>可以使用5个值：</scope></scope></dependency></p>
<ul>
<li>compile，缺省值，适用于所有阶段，会随着项目一起发布。 </li>
<li>provided，类似compile，期望JDK、容器或使用者会提供这个依赖。如servlet.jar。 </li>
<li>runtime，只在运行时使用，如JDBC驱动，适用运行和测试阶段。 </li>
<li>test，只在测试时使用，用于编译和运行测试代码。不会随项目发布。 </li>
<li>system，类似provided，需要显式提供包含依赖的jar，Maven不会在Repository中查找它。</li>
</ul>
<p>Unit Testing:<br>    Error: cannot find symbol<br>        Maven doesn’t see tested classes</p>
<p>java / kotlin 代码混合造成的，/src/test/里面只使用java代码即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/24/Server/Micro/微服务调用追踪/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/24/Server/Micro/微服务调用追踪/" itemprop="url">微服务调用追踪</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-24T11:24:18+08:00">
                2018-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/Micro/" itemprop="url" rel="index">
                    <span itemprop="name">Micro</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="微服务特点"><a href="#微服务特点" class="headerlink" title="微服务特点"></a>微服务特点</h3><p>微服务的特点决定了功能模块的部署是分布式的，以往在单应用环境下，所有的业务都在同一个服务器上，如果服务器出现错误和异常，我们只要盯住一个点，就可以快速定位和处理问题，但是在微服务的架构下，大部分功能模块都是单独部署运行的，彼此通过总线交互，都是无状态的服务，这种架构下，前后台的业务流会经过很多个微服务的处理和传递，我们难免会遇到这样的问题：</p>
<ul>
<li>分散在各个服务器上的日志怎么处理？</li>
<li>如果业务流出现了错误和异常，如何定位是哪个点出的问题？</li>
<li>如何快速定位问题？</li>
<li>如何跟踪业务流的处理顺序和结果？</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="Google-Dapper"><a href="#Google-Dapper" class="headerlink" title="Google Dapper"></a>Google Dapper</h4><p>Google公司广泛使用了分布式集群，为了应对自身大规模的复杂集群环境，Google公司研发了Dapper分布式跟踪系统，并发表了论文《Dapper, a Large-Scale Distributed Systems Tracing Infrastructure》，给行业内分布式跟踪的实现提供了非常有价值的参考，该论文也成为了当前分布式跟踪系统的理论基础。</p>
<img src="/2018/01/24/Server/Micro/微服务调用追踪/Dapper-example.jpg">
<p>这个路径由用户的X请求发起，穿过一个简单的服务系统。用字母标识的节点代表分布式系统中的不同处理过程。</p>
<p>分布式服务的跟踪系统需要记录在一次特定的请求中系统中完成的所有工作的信息。</p>
<p>举个例子，上图展现的是一个与5台服务器相关的一个服务，包括：前端（A），两个中间层（B和C），以及两个后端（D和E）。<strong>当一个用户（这个用例的发起人）发起一个请求时，首先到达前端，然后发送两个RPC调用到服务器B和C。B会马上做出反应，但是C需要和后端的D和E交互之后再返还给A，由A来响应最初的请求。对于这样一个请求，简单实用的分布式跟踪的实现，就是为服务器上每一次发送和接收动作来收集跟踪标识符（message identifiers）和时间戳（timestamped events）。</strong></p>
<p>重要概念</p>
<ul>
<li>基于标注（annotation-based），又叫植入点或埋点</li>
</ul>
<p>在应用程序或中间件中明确定义一个<strong>全局的标注（annotation）</strong>，它可以是一个特殊的ID，通过这个ID连接每一条记录和发起者的请求，当然，这需要代码植入，在生产环境中，因为所有的应用程序都使用相同的线程模型，控制流和RPC系统，可以把代码植入限制在一个很小的通用组件库中，从而达到监测系统应用对开发人员的透明。Dapper能够以对应用开发者近乎零侵入的成本对分布式控制路径进行跟踪，几乎完全依赖于少量通用组件库的改造。</p>
<ul>
<li>跟踪树和span</li>
</ul>
<img src="/2018/01/24/Server/Micro/微服务调用追踪/trace-tree-and_span.jpg">
<p>5个span在Dapper跟踪树中的关联关系</p>
<p>在Dapper跟踪树结构中，树节点是整个架构的基本单元，而每一个节点又是对span的引用。节点之间的连线表示的span和它的父span的直接关系。通过简单的parentId和spanId就可以有序地把所有的关系串联起来，达到记录业务流的作用。</p>
<h4 id="Twitter’s-Zipkin"><a href="#Twitter’s-Zipkin" class="headerlink" title="Twitter’s Zipkin"></a>Twitter’s Zipkin</h4><p>Twitter公司的Zipkin是Google Dapper系统的开源实现，Zipkin严格按照Dapper论文实现，采用Scala编写，并且紧密集成到Twitter公司自己的分布式服务Finagle中，使得跟踪做到对应用透明。</p>
<img src="/2018/01/24/Server/Micro/微服务调用追踪/Zipkin-framework.jpg">
<h4 id="淘宝鹰眼系统（EagleEye）"><a href="#淘宝鹰眼系统（EagleEye）" class="headerlink" title="淘宝鹰眼系统（EagleEye）"></a>淘宝鹰眼系统（EagleEye）</h4><p>淘宝鹰眼是基于网络调用日志的分布式跟踪系统，它可以分析网络请求在各个分布式系统之间的调用情况，从而得到处理请求的调用链上的入口URL、应用服务的调用关系，从而找到请求处理瓶颈，定位错误异常的根源位置。同时，业务方也可以在调用链上添加自己的业务埋点日志，使各个系统的网络调用与实际业务内容得到关联。</p>
<h3 id="Spring-Cloud-Sleuth-Zipkin"><a href="#Spring-Cloud-Sleuth-Zipkin" class="headerlink" title="Spring Cloud Sleuth + Zipkin"></a>Spring Cloud Sleuth + Zipkin</h3><h3 id="分布式RequestId"><a href="#分布式RequestId" class="headerlink" title="分布式RequestId"></a>分布式RequestId</h3><p>参考链接</p>
<ul>
<li><a href="http://www.infoq.com/cn/articles/how-to-realize-distributed-tracking" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/how-to-realize-distributed-tracking</a></li>
<li>Spring Cloud Sleuth：<a href="https://www.jianshu.com/p/4303385b7512" target="_blank" rel="noopener">https://www.jianshu.com/p/4303385b7512</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/17/Server/SpringBoot/Hibernate/hibernate-annotation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/17/Server/SpringBoot/Hibernate/hibernate-annotation/" itemprop="url">Hibernate Annotation</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-17T17:34:18+08:00">
                2018-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/server/Spring/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MappedSuperclass"><a href="#MappedSuperclass" class="headerlink" title="@MappedSuperclass"></a>@MappedSuperclass</h3><p>类级别注解，该注解没有任何参数，被该注解标注的类不会映射到数据库中单独的表，但该类所拥有的属性都将映射到其子类的数据库表的列中。</p>
<h3 id="AttributeOverride"><a href="#AttributeOverride" class="headerlink" title="@AttributeOverride"></a>@AttributeOverride</h3><p>对于被 @MappedSuperclass 注解标注的类派生出来的子类，可以使用 @AttributeOverride 注解重新定义以覆盖父类中的映射信息。</p>
<h3 id="AttributeOverrides"><a href="#AttributeOverrides" class="headerlink" title="@AttributeOverrides"></a>@AttributeOverrides</h3><p>如果需要重新定义父类中的多个映射信息，需要使用 @AttributeOverrides 注解。</p>
<h3 id="Temporal"><a href="#Temporal" class="headerlink" title="@Temporal"></a>@Temporal</h3><ul>
<li>DATE：等于Java.sql.Date</li>
<li>TIME：等于java.sql.Time</li>
<li>TIMESTAMP：等于java.sql.Timestamp</li>
</ul>
<h4 id="DATE"><a href="#DATE" class="headerlink" title="DATE"></a>DATE</h4><p>@Temporal(TemporalType.DATE)<br>@Column(name = “applyDate”, nullable = false, length = 10)</p>
<p>取值：2011-07-05</p>
<h4 id="TIME"><a href="#TIME" class="headerlink" title="TIME"></a>TIME</h4><p>@Temporal(TemporalType.TIME)</p>
<p>取值：22:50:30</p>
<p>参考链接</p>
<ul>
<li><a href="http://fanlychie.github.io/post/jpa-mappedsuperclass-annotation.html" target="_blank" rel="noopener">http://fanlychie.github.io/post/jpa-mappedsuperclass-annotation.html</a></li>
</ul>
<p>@Enumerated(EnumType.STRING)</p>
<p>@Entity　—&gt; 指定当前类为实体对象</p>
<p>@Table(name=”t_user”) —&gt; 设置数据库中对应的表名</p>
<p>@Column(name=”create_date”)　—&gt; Column中的name属性对应了数据库的该字段名字，里面还有其他属性，例如length，nullable等等<br>precision和scale<br>precision属性和scale属性表示精度，当字段类型为double时，precision表示数值的总长度，scale表示小数点所占的位数。</p>
<p>@Id　　—&gt;　　定义为数据库的主键ID</p>
<p>@GeneratedValue　　—&gt;　　ID的生成策略为自动生成</p>
<p>@OneToOne(mappedBy=”user”)　　—&gt;　　指定了OneToOne的关联关系，mappedBy同样指定由对方来进行维护关联关系</p>
<p>@JoinColumn(name=”pid”)　　—&gt;　　指定外键的名字 pid</p>
<p>@ManyToMany(mappedBy=”teachers”)　　—&gt;　　表示由另外一方来进行维护</p>
<p>@JoinTable(name=”t_teacher_course”, joinColumns={ @JoinColumn(name=”cid”)},<br>inverseJoinColumns={ @JoinColumn(name = “tid”) })　　—&gt;　　因为多对多之间会通过一张中间表来维护两表直接的关系，所以通过 JoinTable 这个注解来声明，name就是指定了中间表的名字，JoinColumns是一个 @JoinColumn类型的数组，表示的是我这方在对方中的外键名称，我方是Course，所以在对方外键的名称就是 rid，inverseJoinColumns也是一个 @JoinColumn类型的数组，表示的是对方在我这放中的外键名称，对方是Teacher，所以在我方外键的名称就是 tid</p>
<p>@OneToMany(mappedBy=”role”) —&gt; OneToMany指定了一对多的关系，mappedBy=”role”指定了由多方来维护关联关系，mappedBy指的是多方对这一方的依赖的属性，(注意：如果没有指定由谁来维护关联关系，则系统会给我们创建一张中间表)</p>
<p>@LazyCollection(LazyCollectionOption.EXTRA) —&gt;　　LazyCollection属性设置成EXTRA指定了当如果查询数据的个数时候，只会发出一条 count(*)的语句，提高性能</p>
<p>@ManyToOne(fetch=FetchType.LAZY) 　—&gt; ManyToOne指定了多对一的关系，fetch=FetchType.LAZY属性表示在多的那一方通过延迟加载的方式加载对象(默认不是延迟加载)</p>
<p>@JoinColumn(name=”user_id”) —&gt;　　通过 JoinColumn 的name属性指定了外键的名称 user_id(注意：如果我们不通过JoinColum来指定外键的名称，系统会给我们声明一个名称)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/17/Server/RPC/gRPC/grpc-tutorial/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/17/Server/RPC/gRPC/grpc-tutorial/" itemprop="url">gRPC 教程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-17T11:18:18+08:00">
                2018-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/RPC/" itemprop="url" rel="index">
                    <span itemprop="name">RPC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/RPC/rRPC/" itemprop="url" rel="index">
                    <span itemprop="name">rRPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Linux安装gRPC"><a href="#Linux安装gRPC" class="headerlink" title="Linux安装gRPC"></a>Linux安装gRPC</h3><h4 id="Brew安装"><a href="#Brew安装" class="headerlink" title="Brew安装"></a>Brew安装</h4><p><a href="https://github.com/Linuxbrew/brew" target="_blank" rel="noopener">https://github.com/Linuxbrew/brew</a></p>
<ul>
<li>安装命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)</span>"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>安装开发工具<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Debian, Ubuntu, etc.</span><br><span class="line">    sudo apt-get install build-essential</span><br><span class="line">Fedora, Red Hat, CentOS, etc.</span><br><span class="line">    sudo yum groupinstall <span class="string">'Development Tools'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>对于Arch系则不需要</p>
<ul>
<li>增加环境变量</li>
</ul>
<p>添加以下内容到.bashrc<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"'</span> &gt;&gt;~/.profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export MANPATH="/home/linuxbrew/.linuxbrew/share/man:$MANPATH"'</span> &gt;&gt;~/.profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export INFOPATH="/home/linuxbrew/.linuxbrew/share/info:$INFOPATH"'</span> &gt;&gt;~/.profile</span><br></pre></td></tr></table></figure></p>
<ul>
<li>安装GCC</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gcc</span><br></pre></td></tr></table></figure>
<ul>
<li>安装gRPC</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap grpc/grpc</span><br><span class="line">brew install --with-plugins grpc</span><br></pre></td></tr></table></figure>
<h3 id="定义接口文件"><a href="#定义接口文件" class="headerlink" title="定义接口文件"></a>定义接口文件</h3><p>在Protocol Buffers服务接口的方法定义中是不能使用基本类型的，方法参数和返回值都必须是自定义的 message 类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line">option java_multiple_files = <span class="keyword">true</span>;</span><br><span class="line">option java_package = <span class="string">"com.fintend.fiatgw"</span>; <span class="comment">//生成的代码必须放在这个路径上，否则启动错误</span></span><br><span class="line">                                            <span class="comment">//java.lang.IllegalArgumentException: service names != xxxx</span></span><br><span class="line"><span class="comment">// option java_outer_classname = "HelloWorldProto";</span></span><br><span class="line"><span class="comment">// option objc_class_prefix = "HLW";</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld; <span class="comment">//涉及生成的包名结构</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The greeting service definition.</span></span><br><span class="line">service Greeter &#123;</span><br><span class="line">    <span class="comment">// Sends a greeting</span></span><br><span class="line">    <span class="function">rpc <span class="title">SayHello</span> <span class="params">(HelloRequest)</span> <span class="title">returns</span> <span class="params">(HelloReply)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user's name.</span></span><br><span class="line">message HelloRequest &#123;</span><br><span class="line">    string name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line">message HelloReply &#123;</span><br><span class="line">    string message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生成序序列化和反序列化代码"><a href="#生成序序列化和反序列化代码" class="headerlink" title="生成序序列化和反序列化代码"></a>生成序序列化和反序列化代码</h3><p>格式：protoc -I=$SRC_DIR –java_out=$DST_DIR $SRC_DIR/jr.proto</p>
<p>例如，protoc -I=. –java_out=. helloworld.proto</p>
<h3 id="生成通信服务相关代码"><a href="#生成通信服务相关代码" class="headerlink" title="生成通信服务相关代码"></a>生成通信服务相关代码</h3><ul>
<li><p>编译插件protoc-gen-grpc-java</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/grpc/grpc-java</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> compiler</span><br><span class="line"></span><br><span class="line">../gradlew install</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成代码</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --plugin=protoc-gen-grpc-java=/path/protoc-gen-grpc-java --grpc-java_out=<span class="variable">$DST_DIR</span> --proto_path=<span class="variable">$SRC_DIR</span> <span class="variable">$SRC_DIR</span>/jr.proto</span><br></pre></td></tr></table></figure>
<p>例如<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --plugin=protoc-gen-grpc-java=/home/sulang/git/grpc-java/compiler/build/exe/java_plugin/protoc-gen-grpc-java --grpc-java_out=. --proto_path=. any.proto</span><br></pre></td></tr></table></figure></p>
<h4 id="启动RPC服务器"><a href="#启动RPC服务器" class="headerlink" title="启动RPC服务器"></a>启动RPC服务器</h4><p>Spring Boot 依赖库</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- gRPC --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.devh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-server-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-netty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;grpc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-protobuf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;grpc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-stub<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;grpc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-testing<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;grpc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.api.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>proto-google-common-protos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.protobuf.nano<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-javanano<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protoc-gen-grpc-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实现Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GrpcService</span>(KYCServiceGrpc::<span class="class"><span class="keyword">class</span>)</span></span><br><span class="line">class KYCServiceImpl : KYCServiceGrpc.KYCServiceImplBase() &#123;</span><br><span class="line">    <span class="function">override fun <span class="title">validateKYC</span><span class="params">(request: KYCRequest?, responseObserver: StreamObserver&lt;KYCReply&gt;?)</span> </span>&#123;</span><br><span class="line">        val replyHeaders = ReplyHeaders.newBuilder()</span><br><span class="line">        replyHeaders.version = <span class="string">"v1"</span></span><br><span class="line">        replyHeaders.requestId = <span class="string">"KYC-$&#123;UUID.randomUUID()&#125;"</span></span><br><span class="line"></span><br><span class="line">        val replyBody = ReplyBody.newBuilder()</span><br><span class="line">        replyBody.result = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">        val kycReply = KYCReply.newBuilder()</span><br><span class="line">        kycReply.headers = replyHeaders.build()</span><br><span class="line">        kycReply.body = replyBody.build()</span><br><span class="line"></span><br><span class="line">        responseObserver?.onNext(kycReply.build())</span><br><span class="line">        responseObserver?.onCompleted()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>application.properties 配置信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 默认地址是0.0.0.0:9090</span><br><span class="line">grpc.server.port=</span><br><span class="line">grpc.server.address=</span><br></pre></td></tr></table></figure>
<h4 id="多文件关联生成命令"><a href="#多文件关联生成命令" class="headerlink" title="多文件关联生成命令"></a>多文件关联生成命令</h4><p>int32<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc accounting-common.proto accounting-order-service.proto --java_out=.</span><br></pre></td></tr></table></figure></p>
<h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><p>Error: java.lang.ClassNotFoundException: org/eclipse/jetty/alpn/ALPN<br>Solution:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-tcnative-boringssl-static<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.7.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="doc"><a href="#doc" class="headerlink" title="doc"></a>doc</h4><p>/etc/pacman.conf</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[home_estan_protoc-gen-doc_Arch_Extra]</span><br><span class="line">SigLevel = Never</span><br><span class="line">Server = https://download.opensuse.org/repositories/home:/estan:/protoc-gen-doc/Arch_Extra/$arch</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syu</span><br><span class="line">pacman -S home_estan_protoc-gen-doc_Arch_Extra/protoc-gen-doc</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --plugin=protoc-gen-doc=./protoc-gen-doc --proto_path=./protos/ --doc_out=./doc --doc_opt=html,index.html protos/*.proto</span><br></pre></td></tr></table></figure>
<hr>
<p>Link:<a href="https://software.opensuse.org/download.html?project=home%3Aestan%3Aprotoc-gen-doc&amp;package=protoc-gen-doc" target="_blank" rel="noopener">https://software.opensuse.org/download.html?project=home%3Aestan%3Aprotoc-gen-doc&amp;package=protoc-gen-doc</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/16/Server/SpringBoot/Apollo/configuration/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/16/Server/SpringBoot/Apollo/configuration/" itemprop="url">Apollo</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-16T14:48:18+08:00">
                2018-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/Spring-Boot/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Boot</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/Spring-Boot/Apollo/" itemprop="url" rel="index">
                    <span itemprop="name">Apollo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="docker-compose-部署"><a href="#docker-compose-部署" class="headerlink" title="docker-compose 部署"></a>docker-compose 部署</h3><h4 id="Config-Server"><a href="#Config-Server" class="headerlink" title="Config Server"></a>Config Server</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: $&#123;hostname:localhost&#125;</span><br><span class="line">    preferIpAddress: true</span><br><span class="line">    ip-address: 35.187.226.72 //    格外添加这一行，在Eurake注册时，使用外网IP</span><br><span class="line">    //  这个地址影响到client访问配置中心获取配置信息</span><br><span class="line">    //  如果不设置这个注册地址，SpringBoot通过外网地址去读取配置中心的信息</span><br><span class="line">  server:</span><br><span class="line">    peerEurekaNodesUpdateIntervalMs: 60000</span><br><span class="line">    enableSelfPreservation: false</span><br><span class="line">  client:</span><br><span class="line">    serviceUrl:</span><br><span class="line">      defaultZone: http://$&#123;eureka.instance.hostname&#125;:8080/eureka/</span><br><span class="line">    healthcheck:</span><br><span class="line">      enabled: true</span><br><span class="line">    eurekaServiceUrlPollIntervalSeconds: 60</span><br><span class="line"></span><br><span class="line">endpoints:</span><br><span class="line">  health:</span><br><span class="line">    sensitive: false</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  security:</span><br><span class="line">    enabled: false</span><br><span class="line">  health:</span><br><span class="line">    status:</span><br><span class="line">      order: DOWN, OUT_OF_SERVICE, UNKNOWN, UP</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sulangsss.github.io/2018/01/16/Server/SpringBoot/Annotation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sulang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sulang blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/16/Server/SpringBoot/Annotation/" itemprop="url">Spring Boot Annotation</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-16T14:48:18+08:00">
                2018-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/Spring-Boot/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Boot</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/Spring-Boot/annoation/" itemprop="url" rel="index">
                    <span itemprop="name">annoation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><h4 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h4><p>等价 @Configuration，@EnableAutoConfiguration和@ComponentScan</p>
<h4 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h4><p>参数webEnvironment有四种配置</p>
<ul>
<li><p>MOCK<br>Creates a WebApplicationContext with a mock servlet environment or a regular ApplicationContext if servlet APIs are not on the classpath.</p>
</li>
<li><p>RANDOM_PORT<br>Creates an EmbeddedWebApplicationContext and sets a server.port=0 Environment property (which usually triggers listening on a random port). Often used in conjunction with a LocalServerPort injected field on the test.</p>
</li>
<li><p>DEFINED_PORT<br>Creates an EmbeddedWebApplicationContext without defining any server.port=0 Environment property.<br>（application.properties配置端口或者默认端口8080）</p>
</li>
<li><p>NONE<br>Creates an ApplicationContext and sets SpringApplication.setWebEnvironment(boolean) to false.</p>
</li>
</ul>
<h4 id="SpringRunner"><a href="#SpringRunner" class="headerlink" title="@SpringRunner"></a>@SpringRunner</h4><p>SpringRunner是SpringJUnit4ClassRunner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRunner</span> <span class="keyword">extends</span> <span class="title">SpringJUnit4ClassRunner</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h4><p>@Transactional(propagation=Propagation.REQUIRED)//如果有事务，那么加入事务，没有的话新创建一个</p>
<p>@Transactional(propagation=Propagation.NOT_SUPPORTED)//这个方法不开启事务</p>
<p>@Transactional(propagation=Propagation.REQUIREDS_NEW)//不管是否存在事务，都创建一个新的事务，原来的挂起，新的执行完毕，继续执行老的事务</p>
<p>@Transactional(propagation=Propagation.MANDATORY)//必须在一个已有的事务中执行，否则抛出异常</p>
<p>@Transactional(propagation=Propagation.NEVER)//不能在一个事务中执行，就是当前必须没有事务，否则抛出异常</p>
<p>@Transactional(propagation=Propagation.SUPPORTS)//其他bean调用这个方法，如果在其他bean中声明了事务，就是用事务。没有声明，就不用事务。</p>
<p>@Transactional(propagation=Propagation.NESTED)//如果一个活动的事务存在，则运行在一个嵌套的事务中，如果没有活动的事务，则按照REQUIRED属性执行，它使用一个单独的事务。这个书屋拥有多个回滚的保存点，内部事务的回滚不会对外部事务造成影响，它只对DataSource TransactionManager事务管理器起效。</p>
<p>@Transactional(propagation=Propagation.REQUIRED,readOnly=true)//只读，不能更新，删除</p>
<p>@Transactional(propagation=Propagation.REQUIRED,timeout=30)//超时30秒</p>
<p>@Transactional(propagation=Propagation.REQUIRED,isolation=Isolation.DEFAULT)//数据库隔离级别</p>
<h4 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h4><h4 id="ConditionalOnProperty"><a href="#ConditionalOnProperty" class="headerlink" title="@ConditionalOnProperty"></a>@ConditionalOnProperty</h4><p>这个注解能够控制某个configuration是否生效。</p>
<p>具体操作是通过其两个属性name以及havingValue来实现的，其中name用来从application.properties中读取某个属性值，如果该值为空，<br>则返回false;如果值不为空，则将该值与havingValue指定的值进行比较，如果一样则返回true;否则返回false。如果返回值为false，则该<br>configuration不生效；为true则生效。</p>
<p>单元测试里面控制方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestPropertySource</span>(properties = <span class="string">"key=value"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Autowire"><a href="#Autowire" class="headerlink" title="@Autowire"></a>@Autowire</h4><ol>
<li>有参构造使用@Value(“default value”)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disruptor</span>(</span></span><br><span class="line"><span class="class">    @<span class="title">Value</span>(<span class="title">DisruptorConfig</span>.<span class="title">bufferSize</span>.<span class="title">toString</span>())</span></span><br><span class="line">    bufferSize: Int,</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"true"</span>)</span><br><span class="line">    initEventHandle: Boolean</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>多个bean，使用@Qualifier</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/31/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/50/">50</a><a class="extend next" rel="next" href="/page/33/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="sulang">
          
            <p class="site-author-name" itemprop="name">sulang</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">497</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">226</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">558</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sulang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
